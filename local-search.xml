<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ·±åº¦è§£æ SQL é¢„å¤„ç†è¯­å¥ï¼ˆPrepared Statementsï¼‰ï¼šæ€§èƒ½ä¸ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="/2025/10/24/database/%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90%20SQL%20%E9%A2%84%E5%A4%84%E7%90%86%20Prepared%20Statements%20%E5%8E%9F%E7%90%86/"/>
    <url>/2025/10/24/database/%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90%20SQL%20%E9%A2%84%E5%A4%84%E7%90%86%20Prepared%20Statements%20%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·±åº¦è§£æ-SQL-é¢„å¤„ç†è¯­å¥ï¼ˆPrepared-Statementsï¼‰ï¼šæ€§èƒ½ä¸ç”Ÿå‘½å‘¨æœŸ"><a href="#æ·±åº¦è§£æ-SQL-é¢„å¤„ç†è¯­å¥ï¼ˆPrepared-Statementsï¼‰ï¼šæ€§èƒ½ä¸ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ·±åº¦è§£æ SQL é¢„å¤„ç†è¯­å¥ï¼ˆPrepared Statementsï¼‰ï¼šæ€§èƒ½ä¸ç”Ÿå‘½å‘¨æœŸ"></a>æ·±åº¦è§£æ SQL é¢„å¤„ç†è¯­å¥ï¼ˆPrepared Statementsï¼‰ï¼šæ€§èƒ½ä¸ç”Ÿå‘½å‘¨æœŸ</h1><p>åœ¨ä»»ä½•ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ­£ç¡®ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆPrepared Statementsï¼‰æ˜¯å®ç°é«˜æ€§èƒ½æ•°æ®åº“æ“ä½œçš„å…³é”®ã€‚æœ¬æ–‡å°†ä¸ºæ‚¨æ•´ç†é¢„å¤„ç†è¯­å¥çš„æ ¸å¿ƒæœºåˆ¶ã€æ‰¹é‡æ“ä½œçš„åŒºåˆ«ä»¥åŠå…¶åœ¨è¿æ¥æ± ç¯å¢ƒä¸‹çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h2 id="1-é¢„å¤„ç†è¯­å¥çš„æ ¸å¿ƒä»·å€¼ï¼šé¢„ç¼–è¯‘ä¸å®‰å…¨"><a href="#1-é¢„å¤„ç†è¯­å¥çš„æ ¸å¿ƒä»·å€¼ï¼šé¢„ç¼–è¯‘ä¸å®‰å…¨" class="headerlink" title="1. é¢„å¤„ç†è¯­å¥çš„æ ¸å¿ƒä»·å€¼ï¼šé¢„ç¼–è¯‘ä¸å®‰å…¨"></a>1. é¢„å¤„ç†è¯­å¥çš„æ ¸å¿ƒä»·å€¼ï¼šé¢„ç¼–è¯‘ä¸å®‰å…¨</h2><p>é¢„å¤„ç†è¯­å¥é€šè¿‡å°† SQL æ–‡æœ¬ä¸å‚æ•°å€¼åˆ†ç¦»ï¼Œå®ç°äº†ä¸¤å¤§æ ¸å¿ƒä¼˜åŠ¿ï¼š</p><h3 id="A-æ€§èƒ½ä¼˜åŒ–ï¼ˆé¢„ç¼–è¯‘ï¼‰"><a href="#A-æ€§èƒ½ä¼˜åŒ–ï¼ˆé¢„ç¼–è¯‘ï¼‰" class="headerlink" title="A. æ€§èƒ½ä¼˜åŒ–ï¼ˆé¢„ç¼–è¯‘ï¼‰"></a>A. æ€§èƒ½ä¼˜åŒ–ï¼ˆé¢„ç¼–è¯‘ï¼‰</h3><p>å½“è¿æ¥åº“é¦–æ¬¡å‘æ•°æ®åº“å‘é€ä¸€ä¸ªé¢„å¤„ç†è¯­å¥æ—¶ï¼Œä¼šè§¦å‘ä»¥ä¸‹æµç¨‹ï¼š</p><ul><li><strong>æ•°æ®åº“è¡Œä¸ºï¼š</strong> æ•°æ®åº“æœåŠ¡å™¨å¯¹ SQL æ–‡æœ¬è¿›è¡Œè§£æã€éªŒè¯ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªé«˜æ•ˆçš„<strong>æ‰§è¡Œè®¡åˆ’ï¼ˆExecution Planï¼‰</strong>ã€‚</li><li><strong>ç¼“å­˜ä¸å¥æŸ„ï¼š</strong> æ•°æ®åº“å°†è¿™ä¸ªæ‰§è¡Œè®¡åˆ’ç¼“å­˜èµ·æ¥ï¼Œå¹¶ä¸ºè¯¥è¿æ¥è¿”å›ä¸€ä¸ª**å¥æŸ„ï¼ˆHandleï¼‰**æˆ–å¼•ç”¨ã€‚</li><li><strong>åç»­æ‰§è¡Œï¼š</strong> åœ¨åç»­æ‰§è¡Œä¸­ï¼Œè¿æ¥åº“åªéœ€å‘é€è¿™ä¸ªå¥æŸ„å’Œå…·ä½“çš„<strong>å‚æ•°å€¼</strong>ï¼Œæ•°æ®åº“å³å¯ç›´æ¥æ‰§è¡Œï¼Œè·³è¿‡äº†é‡å¤çš„æ˜‚è´µè§£æå’Œè®¡åˆ’ç”Ÿæˆæ­¥éª¤ã€‚</li></ul><h3 id="B-å‚æ•°ç»‘å®šï¼ˆç»‘å®šå˜é‡ï¼‰ä¸ç±»å‹æ”¯æŒ"><a href="#B-å‚æ•°ç»‘å®šï¼ˆç»‘å®šå˜é‡ï¼‰ä¸ç±»å‹æ”¯æŒ" class="headerlink" title="B. å‚æ•°ç»‘å®šï¼ˆç»‘å®šå˜é‡ï¼‰ä¸ç±»å‹æ”¯æŒ"></a>B. å‚æ•°ç»‘å®šï¼ˆç»‘å®šå˜é‡ï¼‰ä¸ç±»å‹æ”¯æŒ</h3><p>é¢„å¤„ç†è¯­å¥ä½¿ç”¨<strong>å ä½ç¬¦</strong>ï¼ˆé€šå¸¸æ˜¯ <code>?</code> æˆ– <code>$1, $2, ...</code>ï¼‰æ¥ä»£æ›¿ SQL è¯­å¥ä¸­çš„å®é™…å€¼ï¼Œè¿™äº›å ä½ç¬¦è¢«ç§°ä¸º<strong>ç»‘å®šå˜é‡</strong>ã€‚</p><h4 id="ç¤ºä¾‹ï¼šå‚æ•°ç»‘å®š"><a href="#ç¤ºä¾‹ï¼šå‚æ•°ç»‘å®š" class="headerlink" title="ç¤ºä¾‹ï¼šå‚æ•°ç»‘å®š"></a><strong>ç¤ºä¾‹ï¼šå‚æ•°ç»‘å®š</strong></h4><p>å‡è®¾æˆ‘ä»¬è¦æ‰§è¡Œä»¥ä¸‹æ’å…¥æ“ä½œï¼š</p><table><thead><tr><th><strong>åŸå§‹ SQL (ä¸å®‰å…¨&#x2F;ä½æ•ˆ)</strong></th><th><strong>é¢„å¤„ç†è¯­å¥ SQL (ä½¿ç”¨å ä½ç¬¦)</strong></th></tr></thead><tbody><tr><td><code>INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 30)</code></td><td><code>INSERT INTO users (name, age) VALUES (?, ?)</code></td></tr></tbody></table><p>åœ¨ä»£ç ä¸­ï¼Œè¿æ¥åº“ä¼šå°†å ä½ç¬¦ä¸åº”ç”¨ç¨‹åºå˜é‡è¿›è¡Œç»‘å®šï¼š</p><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å‡è®¾ä½¿ç”¨ Java/Kotlin é£æ ¼çš„è¿æ¥åº“</span><br><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> connection.prepareStatement(<br>    <span class="hljs-string">&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;</span><br>);<br><br><span class="hljs-comment">// ç»‘å®šç¬¬ä¸€ä¸ªå‚æ•° (String -&gt; VARCHAR)</span><br>ps.setString(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Bob&quot;</span>); <br><span class="hljs-comment">// ç»‘å®šç¬¬äºŒä¸ªå‚æ•° (Integer -&gt; INT)</span><br>ps.setInt(<span class="hljs-number">2</span>, <span class="hljs-number">25</span>);     <br><span class="hljs-comment">// æ‰§è¡Œæ“ä½œ</span><br>ps.execute(); <br></code></pre></td></tr></table></figure><h4 id="å‚æ•°ç±»å‹æ”¯æŒï¼š"><a href="#å‚æ•°ç±»å‹æ”¯æŒï¼š" class="headerlink" title="å‚æ•°ç±»å‹æ”¯æŒï¼š"></a><strong>å‚æ•°ç±»å‹æ”¯æŒï¼š</strong></h4><p>ä¸»æµçš„ SQL è¿æ¥åº“å’Œæ•°æ®åº“é©±åŠ¨æ”¯æŒå°†å‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€ç±»å‹æ˜ å°„åˆ°ç›¸åº”çš„æ•°æ®åº“ç±»å‹ï¼Œå¸¸è§çš„æ”¯æŒç±»å‹åŒ…æ‹¬ï¼š</p><table><thead><tr><th><strong>ç¼–ç¨‹è¯­è¨€ç±»å‹ (ç¤ºä¾‹)</strong></th><th><strong>å¯¹åº”çš„æ•°æ®åº“ç±»å‹ (ç¤ºä¾‹)</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td><strong>æ•°å€¼</strong> (<code>Int</code>, <code>Long</code>, <code>Double</code>, <code>BigDecimal</code>)</td><td><code>INTEGER</code>, <code>BIGINT</code>, <code>NUMERIC</code>, <code>DECIMAL</code></td><td>ç”¨äºç²¾ç¡®æˆ–éç²¾ç¡®çš„æ•°å€¼æ“ä½œã€‚</td></tr><tr><td><strong>å­—ç¬¦ä¸²</strong> (<code>String</code>)</td><td><code>VARCHAR</code>, <code>TEXT</code>, <code>CHAR</code></td><td>ç”¨äºæ–‡æœ¬æ•°æ®ã€‚</td></tr><tr><td><strong>æ—¥æœŸ&#x2F;æ—¶é—´</strong> (<code>LocalDate</code>, <code>Instant</code>)</td><td><code>DATE</code>, <code>TIME</code>, <code>TIMESTAMP</code></td><td>ç”¨äºå­˜å‚¨æ—¶é—´ç‚¹ã€æ—¥æœŸæˆ–æ—¶é—´é—´éš”ã€‚</td></tr><tr><td><strong>äºŒè¿›åˆ¶</strong> (<code>byte[]</code>, <code>ByteBuffer</code>)</td><td><code>BLOB</code>, <code>BYTEA</code></td><td>ç”¨äºå­˜å‚¨æ–‡ä»¶ã€å›¾ç‰‡ç­‰äºŒè¿›åˆ¶å¤§å¯¹è±¡ã€‚</td></tr><tr><td><strong>å¸ƒå°”å€¼</strong> (<code>Boolean</code>)</td><td><code>BOOLEAN</code> æˆ–æ˜ å°„åˆ° <code>TINYINT</code></td><td>ç”¨äºé€»è¾‘çœŸ&#x2F;å‡åˆ¤æ–­ã€‚</td></tr><tr><td><strong>æ•°ç»„&#x2F;é›†åˆ</strong> (<code>List</code>, <code>Array</code>)</td><td>ä»…éƒ¨åˆ†æ•°æ®åº“ï¼ˆå¦‚ PostgreSQLï¼‰æ”¯æŒ <code>ARRAY</code> ç±»å‹ã€‚</td><td>ç”¨äºä¼ é€’é›†åˆæ•°æ®ã€‚</td></tr><tr><td><strong>ç©ºå€¼</strong> (<code>null</code>)</td><td><code>NULL</code></td><td>é€šè¿‡è°ƒç”¨ <code>setNull()</code> æˆ–ç»‘å®š <code>null</code> å¯¹è±¡å®ç°ã€‚</td></tr></tbody></table><h4 id="é‡è¦é™åˆ¶ï¼šç»‘å®šå˜é‡çš„ç”¨é€”"><a href="#é‡è¦é™åˆ¶ï¼šç»‘å®šå˜é‡çš„ç”¨é€”" class="headerlink" title="é‡è¦é™åˆ¶ï¼šç»‘å®šå˜é‡çš„ç”¨é€”"></a><strong>é‡è¦é™åˆ¶ï¼šç»‘å®šå˜é‡çš„ç”¨é€”</strong></h4><p>ç»‘å®šå˜é‡<strong>åªèƒ½</strong>ç”¨äºæ›¿æ¢ SQL è¯­å¥ä¸­çš„<strong>æ•°æ®å€¼ï¼ˆValueï¼‰</strong>ã€‚å®ƒä»¬<strong>ä¸èƒ½</strong>ç”¨äºæ›¿æ¢ä»¥ä¸‹ SQL å…ƒç´ ï¼š</p><ol><li><strong>SQL å…³é”®å­—æˆ–å‡½æ•°ï¼š</strong> ä¾‹å¦‚ï¼Œä¸èƒ½ä½¿ç”¨ <code>?</code> æ¥æ›¿ä»£ <code>SELECT * FROM table WHERE column = ?</code> ä¸­çš„ <code>column</code> åç§°ï¼Œä¹Ÿä¸èƒ½æ›¿ä»£ <code>DEFAULT</code> å…³é”®å­—æˆ– <code>NOW()</code> ç­‰å‡½æ•°ã€‚</li></ol><ul><li>é”™è¯¯ç¤ºä¾‹ï¼š<code>INSERT INTO users (name, created_at) VALUES (?, ?)</code>ï¼Œå¹¶è¯•å›¾ç»‘å®š <code>DEFAULT</code> æˆ– <code>NOW()</code> åˆ°ç¬¬äºŒä¸ªé—®å·ã€‚<strong>è¿™ä¸ä¼šæˆåŠŸã€‚</strong></li></ul><ol start="2"><li><strong>è¡¨åã€åˆ—åæˆ– SQL ç»“æ„ï¼š</strong> è¯­å¥çš„ç»“æ„å¿…é¡»åœ¨é¢„ç¼–è¯‘æ—¶å®Œå…¨å›ºå®šã€‚</li></ol><p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong> è¿æ¥åº“è´Ÿè´£å°†æ‚¨åº”ç”¨ä¸­çš„æ•°æ®ç±»å‹æ­£ç¡®åœ°è½¬æ¢ä¸ºæ•°æ®åº“æ‰€éœ€çš„æ ¼å¼ï¼Œå¹¶åœ¨åº•å±‚é€šè¿‡<strong>äºŒè¿›åˆ¶åè®®</strong>ä¼ è¾“ï¼Œè¿™é€šå¸¸æ¯”ä¼ è¾“æ–‡æœ¬å­—ç¬¦ä¸²æ›´é«˜æ•ˆã€‚</p><h3 id="C-å®‰å…¨æ€§ï¼ˆé˜²æ­¢-SQL-æ³¨å…¥ï¼‰"><a href="#C-å®‰å…¨æ€§ï¼ˆé˜²æ­¢-SQL-æ³¨å…¥ï¼‰" class="headerlink" title="C. å®‰å…¨æ€§ï¼ˆé˜²æ­¢ SQL æ³¨å…¥ï¼‰"></a>C. å®‰å…¨æ€§ï¼ˆé˜²æ­¢ SQL æ³¨å…¥ï¼‰</h3><p>é¢„å¤„ç†è¯­å¥å¼ºåˆ¶å°† SQL ç»“æ„å’Œæ•°æ®å€¼åˆ†ç¦»ï¼Œå‚æ•°å€¼åœ¨å‘é€åˆ°æ•°æ®åº“æ—¶ä¸ä¼šä½œä¸ºå¯æ‰§è¡Œçš„ SQL ä»£ç çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä»æ ¹æœ¬ä¸Šæœç»äº†æœ€å¸¸è§çš„ <strong>SQL æ³¨å…¥</strong>æ”»å‡»ã€‚</p><h2 id="2-æ‰¹é‡æ“ä½œçš„æ•ˆç‡ï¼šæ‰¹é‡æ‰§è¡Œ-vs-å•æ¬¡æ‰§è¡Œ"><a href="#2-æ‰¹é‡æ“ä½œçš„æ•ˆç‡ï¼šæ‰¹é‡æ‰§è¡Œ-vs-å•æ¬¡æ‰§è¡Œ" class="headerlink" title="2. æ‰¹é‡æ“ä½œçš„æ•ˆç‡ï¼šæ‰¹é‡æ‰§è¡Œ vs å•æ¬¡æ‰§è¡Œ"></a>2. æ‰¹é‡æ“ä½œçš„æ•ˆç‡ï¼šæ‰¹é‡æ‰§è¡Œ vs å•æ¬¡æ‰§è¡Œ</h2><p>ç°ä»£è¿æ¥åº“é€šå¸¸æä¾›ä¸¤ç§æ‰§è¡Œç›¸åŒè¯­å¥çš„æ–¹æ³•ï¼š</p><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>ç”¨é€”</strong></th><th><strong>å‚æ•°æ•°é‡</strong></th><th><strong>ç½‘ç»œæ•ˆç‡</strong></th><th><strong>æ€§èƒ½æ¨è</strong></th></tr></thead><tbody><tr><td><strong>æ‰¹é‡æ‰§è¡Œï¼ˆBatch Executeï¼‰</strong></td><td>æ‰¹é‡æ“ä½œï¼Œå¤šç»„å‚æ•°</td><td>$N$ ç»„å‚æ•°</td><td>é«˜ï¼ˆä¸€æ¬¡æˆ–æå°‘æ¬¡ç½‘ç»œå¾€è¿”ï¼‰</td><td><strong>å¤šè¡Œæ’å…¥&#x2F;æ›´æ–°</strong></td></tr><tr><td><strong>å•æ¬¡æ‰§è¡Œï¼ˆSingle Executeï¼‰</strong></td><td>å•æ¬¡æ“ä½œï¼Œä¸€ç»„å‚æ•°</td><td>1 ç»„å‚æ•°</td><td>ä½ï¼ˆä¸€æ¬¡æ“ä½œä¸€æ¬¡å¾€è¿”ï¼‰</td><td><strong>å•è¡Œæ’å…¥&#x2F;æ›´æ–°</strong></td></tr></tbody></table><p><strong>å…³é”®ç‚¹ï¼š</strong></p><ul><li>å¦‚æœéœ€è¦æ‰§è¡Œ $N$ ä¸ªæ“ä½œï¼ˆä¾‹å¦‚æ’å…¥ $N$ è¡Œæ•°æ®ï¼‰ï¼Œåº”å°†æ‰€æœ‰å‚æ•°æ‰“åŒ…æˆä¸€ä¸ª<strong>æ‰¹é‡æ‰§è¡Œ</strong>è¯·æ±‚ã€‚è¿™è¿œä¼˜äº $N$ æ¬¡å¾ªç¯è°ƒç”¨å•æ¬¡æ‰§è¡Œï¼Œå› ä¸ºå®ƒå¤§å¹…å‡å°‘äº†ç½‘ç»œå»¶è¿Ÿå’Œæ•°æ®åº“å¤„ç†äº‹åŠ¡çš„æ¬¡æ•°ã€‚</li><li>å¯¹äºåªæ‰§è¡Œä¸€æ¬¡çš„æ“ä½œï¼Œåº”ä½¿ç”¨æ¸…æ™°æ˜ç¡®çš„å•æ¬¡æ‰§è¡Œæ–¹æ³•ã€‚</li></ul><h2 id="3-é¢„å¤„ç†è¯­å¥çš„ç”Ÿå‘½å‘¨æœŸå’Œè¿æ¥æ± é‡ç”¨"><a href="#3-é¢„å¤„ç†è¯­å¥çš„ç”Ÿå‘½å‘¨æœŸå’Œè¿æ¥æ± é‡ç”¨" class="headerlink" title="3. é¢„å¤„ç†è¯­å¥çš„ç”Ÿå‘½å‘¨æœŸå’Œè¿æ¥æ± é‡ç”¨"></a>3. é¢„å¤„ç†è¯­å¥çš„ç”Ÿå‘½å‘¨æœŸå’Œè¿æ¥æ± é‡ç”¨</h2><p>é¢„å¤„ç†è¯­å¥çš„æœ‰æ•ˆæ€§èŒƒå›´æ˜¯ç†è§£å…¶æ€§èƒ½ä¼˜åŠ¿çš„å…³é”®ã€‚</p><h3 id="æœ‰æ•ˆèŒƒå›´ï¼šå•æ¬¡æ•°æ®åº“è¿æ¥-ä¼šè¯"><a href="#æœ‰æ•ˆèŒƒå›´ï¼šå•æ¬¡æ•°æ®åº“è¿æ¥-ä¼šè¯" class="headerlink" title="æœ‰æ•ˆèŒƒå›´ï¼šå•æ¬¡æ•°æ®åº“è¿æ¥&#x2F;ä¼šè¯"></a>æœ‰æ•ˆèŒƒå›´ï¼š<strong>å•æ¬¡æ•°æ®åº“è¿æ¥&#x2F;ä¼šè¯</strong></h3><ul><li><strong>ç»‘å®šæœºåˆ¶ï¼š</strong> é¢„ç¼–è¯‘åçš„æ‰§è¡Œè®¡åˆ’é€šå¸¸æ˜¯ç»‘å®šåœ¨åˆ›å»ºå®ƒçš„é‚£ä¸ª<strong>æ•°æ®åº“è¿æ¥</strong>æ‰€å¯¹åº”çš„æ•°æ®åº“<strong>ä¼šè¯</strong>ä¸Šçš„ã€‚</li><li><strong>å¤±æ•ˆæ¡ä»¶ï¼š</strong> ä¸€æ—¦è¯¥è¿æ¥è¢«<strong>å…³é—­</strong>ï¼ˆæˆ–ä¸æ•°æ®åº“æ–­å¼€ï¼‰ï¼Œæ•°æ®åº“ä¼šæ¸…é™¤è¯¥ä¼šè¯å…³è”çš„æ‰§è¡Œè®¡åˆ’ã€‚</li></ul><h3 id="è¿æ¥æ± ï¼ˆConnection-Poolï¼‰ç¯å¢ƒä¸‹çš„é‡ç”¨ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼šè½¯è§£æï¼‰"><a href="#è¿æ¥æ± ï¼ˆConnection-Poolï¼‰ç¯å¢ƒä¸‹çš„é‡ç”¨ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼šè½¯è§£æï¼‰" class="headerlink" title="è¿æ¥æ± ï¼ˆConnection Poolï¼‰ç¯å¢ƒä¸‹çš„é‡ç”¨ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼šè½¯è§£æï¼‰"></a>è¿æ¥æ± ï¼ˆConnection Poolï¼‰ç¯å¢ƒä¸‹çš„é‡ç”¨ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼šè½¯è§£æï¼‰</h3><p>è¿æ¥æ± æ˜¯é¢„å¤„ç†è¯­å¥æ€§èƒ½æœ€å¤§åŒ–çš„åœºæ™¯ï¼š</p><ol><li><strong>è¿æ¥å¤ç”¨ä¸ç¼“å­˜ï¼ˆåº”ç”¨å±‚ï¼‰ï¼š</strong></li></ol><ul><li>è®¸å¤šé«˜æ€§èƒ½ <strong>SQL è¿æ¥åº“</strong>ï¼ˆå¦‚è¿æ¥æ± æˆ–é©±åŠ¨å±‚ï¼‰åœ¨åº”ç”¨å±‚ç»´æŠ¤ç€ä¸€ä¸ª<strong>é¢„å¤„ç†è¯­å¥ç¼“å­˜</strong>ã€‚</li><li>å½“ä¸€ä¸ªè¿æ¥ä»æ± ä¸­å–å‡ºæ—¶ï¼Œå¦‚æœå®ƒéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥å·²ç»åœ¨è¯¥è¿æ¥ä¸Šè¢«é¢„ç¼–è¯‘è¿‡ï¼Œ<strong>è¿æ¥åº“å¯ä»¥ç›´æ¥ä»åº”ç”¨å±‚çš„ç¼“å­˜ä¸­è·å–å·²æœ‰çš„å¥æŸ„</strong>ï¼Œå¹¶è·³è¿‡å‘æ•°æ®åº“å‘é€å®Œæ•´çš„â€œé¢„ç¼–è¯‘è¯·æ±‚â€ã€‚è¿™æå¤§åœ°å‡å°‘äº†ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚</li></ul><ol start="2"><li><strong>è½¯è§£æï¼ˆSoft Parseï¼‰ä¸ä¼šè¯çŠ¶æ€ï¼ˆæ•°æ®åº“å±‚ï¼‰ï¼š</strong></li></ol><ul><li>å½“è¿æ¥è¿”å›æ± ä¸­æ—¶ï¼Œå®ƒä¸æ•°æ®åº“çš„ç‰©ç†è¿æ¥å’Œä¼šè¯ä¿æŒå¼€æ”¾ã€‚æ•°æ®åº“æœåŠ¡å™¨ä¸ºè¯¥è¿æ¥ç»´æŠ¤çš„ä¼šè¯çŠ¶æ€ï¼ˆåŒ…æ‹¬å·²é¢„ç¼–è¯‘çš„ SQLï¼‰å¾—ä»¥ä¿ç•™ã€‚</li><li>å½“è¿æ¥è¢«å†æ¬¡ä½¿ç”¨æ—¶ï¼Œå³ä½¿å®¢æˆ·ç«¯éœ€è¦å†æ¬¡å‘é€é¢„ç¼–è¯‘è¯·æ±‚ï¼ˆå³åº”ç”¨å±‚ç¼“å­˜å¤±æ•ˆï¼‰ï¼Œæ•°æ®åº“æœåŠ¡å™¨ä¹Ÿèƒ½å¤Ÿè¯†åˆ«å‡ºè¿™æ˜¯æ¥è‡ª<strong>åŒä¸€ä¸ªä¼šè¯</strong>çš„ç›¸åŒè¯­å¥ã€‚</li><li>æ•°æ®åº“ä¼šç›´æ¥é‡ç”¨ç¼“å­˜çš„æ‰§è¡Œè®¡åˆ’ï¼Œè·³è¿‡æ˜‚è´µçš„ SQL <strong>è§£æã€éªŒè¯ã€ä¼˜åŒ–</strong>ï¼ˆç¡¬è§£æï¼‰æ­¥éª¤ï¼Œä»…æ‰§è¡Œ<strong>è½¯è§£æ</strong>ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong> åœ¨è¿æ¥æ± ç¯å¢ƒä¸­ï¼Œé¢„å¤„ç†è¯­å¥é€šè¿‡<strong>åº”ç”¨å±‚çš„å¥æŸ„ç¼“å­˜</strong>ï¼ˆå‡å°‘ç½‘ç»œå¾€è¿”ï¼‰å’Œæ•°æ®åº“å±‚çš„<strong>æ‰§è¡Œè®¡åˆ’é‡ç”¨</strong>ï¼ˆå®ç°è½¯è§£æï¼‰ï¼Œå…±åŒå®ç°äº†è·¨è¯·æ±‚çš„é«˜æ•ˆæ‰§è¡Œã€‚å› æ­¤ï¼Œåœ¨ä»»ä½•é«˜æ€§èƒ½åº”ç”¨ä¸­ï¼Œ<strong>å§‹ç»ˆ</strong>å»ºè®®ä½¿ç”¨é¢„å¤„ç†è¯­å¥æ¥æ‰§è¡Œ DMLï¼ˆå¢åˆ æ”¹ï¼‰å’Œ Select æŸ¥è¯¢æ“ä½œï¼Œä»¥ç¡®ä¿é«˜æ•ˆçš„æ•°æ®åº“èµ„æºåˆ©ç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>RDBMS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…³ç³»å‹æ•°æ®åº“</tag>
      
      <tag>RDBMS</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³ç³»å‹æ•°æ®åº“å¤–é”®çš„ä¸€äº›è§è§£</title>
    <link href="/2025/10/22/database/%E5%A4%96%E9%94%AE%E8%A7%81%E8%A7%A3/"/>
    <url>/2025/10/22/database/%E5%A4%96%E9%94%AE%E8%A7%81%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="9ee7de1de9eb01d35bccf61cda6c0d7e41fe813eb765bff852d524e5df8e95a3">4630436162ade97ba2718b7d0c4b3b63cb3a3f659c5ca08b4bca0f5845928186c343f7a7bd2665e468d6b0b56d2098398e6989b156c0d5623a7cea67a1ed7e95e9b40bd86b0ea890faa5c508850306a3bbcb9452c01cdc784d7878dd2f8fd846cec3c55d4298aaeba08445d67c408ea79954ed295c594db57114fb00c4e113e6160b2c4402dc94915877ffa8de12437ea5e86a88f7be7e7de6bd1768a7918467bfebf26776e90e83b1f5ddae70d6d2bf0bd4364bc9e30c9beb7f7e75a138bba230f813889c826134c7f2474a3e2901da8ad642b359ce9aca01126259df56c988fe968aef75a7f4ca366fddd45c69109b1a7637aa9a0ee4b5c46e1570992a2bc2c2eae7a7e6044cc2973e5aa18c2577b25d470229be6afd84f0a68df1efb589fbb4669af0ed4dff6b434058493ebae7f0ed180702e90c48509c363120f0c75acd3a48abb0ceaeaa7e097a5eefe4076f45ea63a20684e3521bed64f7a6d94bbe6eccece8da7e9fedd6e844f1912853f92060af81f573f11e00997c0be0a49c1302af7a2807688a751f1be316af433ca6227a04cef1f73e0bd15afa6322263e4de32cfb0279f467a4a3247d1f7dbbc6c3b60ffe46cc2792f68a630dddb3b87db009b68bbbcc2ab4c2b4452d9b0e9e21370edf1bf5313e47855c1302e26613b3caa1c8023eeabe9a7002424635342af24f2f406054392f361f4cca55ceef1eb8071c6251b84c46cf96f13fb44f084c269030275c1617f7c7083d17f8b0bc937bd32c8cc4dd6f176efa7133b54a4212c7c9f479af5894048184e9a343f19427a56e0406da51a462b14553fc6547cc4375ea53be4ed01990b5a34b946ad9c205579e3ed8594efaab2ea4432a011e9a4c252bc854353c6629a88272924451679e012249390fb5627e049dcbaff9c9560ac0897877a2e7d57998a6d2537f2cbe7cabbafa13c881dda7d423fa7e9929612bc23354076896f27be50dbf7ca83a5d1221745b8df26a98adab6873ca06fc2e91dfe899185c9c5ac8d956c7ffddbc21249eaf7531d7e3a7988bc584a047bc92b57ee63f8dc27653ba08a6e189099375c859c1f4ec3db82135b5f59fd53ebace07b178b172f64d81c29793d068deafbc1a5cc885d7b08063b5e3eacf7456a864c445b1f7eadb575ae38a82d34c1bb71b49aaa3edaf17492a3d78f10fd88acb4fdd36d62c92d2cbb0856d160cd34486d941423979b6628886614c33fd7f0fd8a9a97857bdd007e6cbf3928200ef9925abd3203a014064c88072a38d27f255a17d3f9ed9c003a964c30bec77380391bc108232da908cbde19bf55a1fa10ca9cdb837157b59b30746f63dd2987e3b080d9fd177a9f3efca5348ac60daaaeeb9f964236371f0b9e09ef71323d0a4f65f5bd18824193915edc651d7bd41160e54ee3d4434fda552108b2156de681e27bd8fa83e1b0027701b2f76a023fad4e4a7fc9d1608faf26f9c5b952dde802817a6af0b32500cebcd12322a0f097ed5c0e752f4a0ebc4ff21a2ae05b0748da745fe3a1ba624ce2842713ce3b641a7bc1c94cd185c60ddf9c8848f877e923377fd23d5da9ef0014af45a521c61fcc87d35fbb51d83ba67912bca5c67cb92591e5c6e984100e04430596dfbf0860fd2bb559a56592ff34bc0ece29a8b8cd5df220bb05702e525474f832890e4c92b4eec076545e21766ab927b35b01b1306ec242fa6816975e820c6946d7e2b88c27b99df4ce01b3290ea0914d217647e89e9e18f43e5c663aa66fe9b0842c0ef72dd6ff9e482dc2af13d58ef58748c62dc28fbcdd667f26a35097a89bab7fe60106fc87353e63742df7b595d0fcba74cf6a49f999d524c6d1d6e39fec9f45f83aaac3d0a96a102690ddc41a1f7c0914a3d31ccc417bbf48e0aafe8ef129745f74a7b8326a02eeb20342df0fff15cb6ee9a90935c970f74fd24cc212c25c51181fc0a0be11e09f6266fe11428fddb6da11c0e6d071027bc175f04e10cff278dcb60f85a25a3aee15fd94e43345131a960f4cbc1e708df1738c8e774cf4452144b52f48d3ba898783fea6aaf9321d8d9f4ba9d23d05662a3a149efd5d3dc2447671db3a315e26e026658a5cb1dbf3a196b533abb97996dcc3f952592393e94d021ca4b2121d15a1b6bf45b7cbeb194d1c5a97c246ffd86406f7b7e7b13c33261ebf3a961d4c501048ea5181e240fefa42f5d39e0846bef15dda69bd30ab86d4b48fe2c84eebfe3c2786f842bb10e84a0d60ce43e0484d931363516af20bcd93d799b902abbf6990c47419cb6debf226e3953761c8059b575e69461238ae5aed6c19cf0ccc66dbb4c910e117f1bd133f5c547bc6706ce8d7b063fd6e02151b9b282144152b8d486eb6aebbc07211289501aad7a2e8e2ae858883d0e9e5ac5b5c90b2e89600bf9cb19f677b7f08eac524375c4a375f1c704e28effc74c92ccb17236b18e90149c9434758e9c43369ed6db9d0c3f4efb2e053e9ed141575356f871a6e83e57deeb4e91396acdf20e68351714684a55b6e363b75c28161462bf5a07964047c704ba0425a49f2dfcc352ea5b539cb26c09e0d57c44641dee9b207e9c436bcbc949c88ef39206c031eeb634c9c5cbe48ab89ce41984b2b9888157b0185c6988de443565009f16fed6e62d22157216dc20119a562a1eb5543a931a79fc73ee0a64cc6950f08931f7f5db9246ae0daa008a6d5b9bf8b16197625f9c46f6016176f3b6e2b343fa8470f5e124e82107451565566a11138e1baf82422599b94356c01a485c7795e57f98e317e898949f595e9f514102b4e17994482c02e8515b7019b6a5d06a77246f4d38f6ca0ffa7434f012c9f66fc5de27ae57a28a54095e09dcdfe1865e9ce1e42b82c9986af1ef0d2f942c24163e13fb2af90bfb60da4e570adad7823c2ee05965e022d0659e7a3dc928a8472f6dba3dbc8e0fc284e44292a9cb1decf0b7489e07932a526853e5a47029c0c4526383f5e6cb7461c0eaa9e022a487d01101776fdf8fc83605688077f58c2e34abdb7ef1f31fceea4817aa56c8bfcdf91ed6e14dfbeb66ac064150956fdfe75c1b4a9e0be8101a675f14ea8154e3411873fbc94f841b7d0d109f426780c794b0fca21cdd991abec4cbb01bc3d89ecb7ce267a3f195c8f46da12ed1fb10b13a036ee47f0375fcc9daa7695fc3840634eee6abd8f78be5252d0463a105fc441af8f3b3842251fb18165f527a49bdc788cd73f42c732f6304c6400062c24cb08f1044ec8d2785f5260251e17ede7770766538d9fd0c42e8b436a4c91eae9ca608564f8802a8ab937230fc91315e0e8b05934e7c9d8f26795062c6a6d8cec0b6a5f290a399c243ceff4c935011783ea3541e0d0be6638875cde33db6a4615c8a172085329761e992a47f99ff288b121d63cc6e6759e903d1f415ba6fa291f337d60614b8297070626d28bb9083c1346232bab442fff11a112f71e018fa3ce78b0d8555cc6eb256e8fb4c05f1a160df0d5fb6d7876c467abbe9d943c3e591c1fc7254d4a7608a20aa4bf4b61621d8544a089bb14703e2fccaaab60d6c1ec0d85258834ecd25d4a2bc008f8c3d90640246ff194c6308a7b242c16d4e1eb819f47f342de610f97c4b5aae8ea2d321df2e934b283a95c728d963ca32fa753b8ce9911de520cc1a895406ab3d21b7446454a0620f1f32e92d95af8894b3c53ad59fa3fecba026513e49e70ea3fe8dfed4bd675f4be92cf0b71fe180d41ab312efc11158b3b77b5c4906c31e65211fadcd1e62279b0d0139f3f10cbb1f4bdddea0f8ad6e3201c53d2beb09ebc80661d17225adab95695e4bead864b0a6af8fe03d1c46058fe7e1ba06b44d758e6950cd99c3ea71b2f156b592a7ddae44eb86a51d0f6cc32374588fac0644217d82044b0abb3e4dcbb1c2bf5e8c7268640696e39816db679e30de531847ffda731fde8d0f21287a5be8f0bb411ef9c6236113e8a9bf66579916e53c7fd36d841caa6a72b44d96c3267b4fa4d95f207a424e3e760209cdc75a4a72e49d60e82f28d8f6484b9787e5e4df3beddb5dfe8cb9193a552ae210c551c006bb2789da9360e953fc725e77b20fa5c8e9cfd73c045e9a94c40c5869eb754276b488dd2080b51b313d34f0ec6aac146f0f36e93f75045de2ed81b641bbb40b371a1a7bf9bed6834da5e187ff229d33106578d6e12193c846f6c8babaa8c03a9dedf6ed0dae268d1061dad0a6d2a31066c6e1e02b27a9d1394924f1aa45a4a0f22aed6b9b27f96727b036bbf93784416e3e60821f1cf4d15a1d5be4c303cccdf02fe41d849798863f4e2fe4f2dfab8268596e461e51973190c848e057b0266ec30e74282568bfbc2a92cba5b7d8b144ec9be7921cbf09d1f0b65d20c1ed6703e697586ba41248744eacb69a51685200c61ca5bc7cf35f6d4333b4200b5947bb223f201d26cdd66223ee8aea5152800187f99a9d6f705250cd4656e2450fd03bac527a4f35e2a032986c86950df9b30b5a3fb65c88c1c408bc3245492fece0b0725a70294b221cde05e3cb5a8edcf5606805b77b75090c7080b343892ef230e060cde525bbdfd4c9379d307daf62eabcea405f7f644eaf6ea2a15c8919cf43d84f543c59f66809ae27025e3c46b41dcd31d6272a33785908975818e65c849c52ee06b4561951da55cb851a39e487a36b843b6d5bba9b138acbe5305aa343f42b6894478c9f5120d04d1606da98e694848e7f5fc29be7f8c5a9540322ae8b656400132458fbf54c75457f66e5d79785c5d3068970f7ebf0381023ab773a11b8c82a231f26185ba774e82ad25a00f444ebd9c2945e00a6e48e7e5cf087c2aec9d6c8ecf29537186e2277fb6a6faa76770bd48885e51e1ffb8b1836831a8dec9fee20983c611438846aa09e1cbf1c29e61d8d4643cde7be183c7e5940575ce047d3bf9c57c3efccce3336736b01d05016288980a1833f29cd82ec9b41a81d9bf1f77415d369b4606e7c5e7a0d65863c43da47b917116ba77723bea7831441ba8cb0d579dabd06f3f3c0989bfe6e870f7eb087284f300ccd23975ee42d3c75ba19ecd37ca1bc42ba5f097c8b3974b6bab1bdc0930d9b8c743ce1609be350bb9ff4bf466de65e47e4d92692fa9563e4d7f5aa135db373a01bd048f930815d04df8478aced02c7e9ddad064356260be2e9d1f33f5161015f675a776611d55047ea3bdac4f8a00753a94c1904eddaefd45aaad590a684da233f4dd939ac7bf686f778ead96673686e7ad676c9eb45d2749a74a105e286c25d710533c9015c0b16888e4fe546ae73f71858fabd10e33c14dd501fe011f6233a083c175b4c4e5e763a9ff0b2432b5d08c0de2e2481f6db8650f0fe1cf423048e96d5e87000d99b98d82c8d75315d5b00888b349267c31007ebc30994d6bfb2abcf25bd1656647eb894abda6f2d02732d00991c833dbbd2cfd91c48482af408594c98ce377d96209257a0532f0bb8d921be75f377ef25e6707024d79d056c036c8bce2b3e18a2e7090df2d024c93919c2c736051f8ac52aeb192e46a659bee87e6e50613a0f12b7b1c6bdd7125ec1db33924ece34f40ee1b268989ba05447423e7a01dddfa993e3f34fbe17a52c2ef6b25df02afaea030e64cf712e3cb31082b6829b25c2c1525cf5807087e725577af67a3c56653398497c4ed4c5407a3a7011f2a27985a18491cc6d57120dc6af0efedcc9e32318065db32d289a2b31da0408f03f8345b77e04b30f4290ee1aaf9fe73e26b2e66cde7ad25167d0456fa517f72c19b0080c8f3121fdc93e592688c00ab6606e012a6a691f262d8abee6e98f2b583a53ea01b4bfe50a4e55c8718be9e04a55500f31db6f1bc2cc1a077285a7a07e761fbfd1c2374071cd6a473763372bfa4295a9b6436a96da0772d17763968da9ec5f3d23939a4064605d28d15d94498c7bd5931e4d0abd19c66e9c03055205add60e4aa86739133d051bb41ecd3bc22fbcbf11222f54fd1c65cb7ce8446e5a89c34f505f7f87fa2ea5254a9ec2ad1bfd54adc1b3e94a27c53489016d900682d1534c0093f1bca3d74f84346fd4f030c7c93311bdccc1f52c2f75976c4950c32528afeb51df8763362f4e89f93eebcd9d8e13f88ce9974a3ecbc2aa07f3948bb9cbe9368627cab1b6dcbbb41ad571bc044286de312ec449941ff0e50d934b8a64236ec8753fef81c2f4e7e6f5a356710ed54f6548012cf96a8dcd10bf39b41fcdfd702b5d38a8e6da0dc87cbd971731c2f1a5907ba11a8089c147e4019842a219ca3604a8a511de1a95410077062304a338e72519be466e0568f0a126ca185527da80ee410b9cd1bbc1d9b4c95deebfde396f3f937d51c5028ce9c33a535d8e1a2769e6137c369f13018b71cacd414691430b9b6ab2c1bb4172235711da3fe9c7dce3ebee0e82c0cb59f2e14ac8f3fe977dcb247ddf79439ac4110c60bb9ce5697505a82ecfb482f6e788dd6edd6159d39724311377c03f68aeeea00fd5d295c51dd0a73b565aac77aaf20b700976e94a222ae74805a56cd327720495edde0d0d01e7a552eff76339676176a3cf00cabf97376e06157c292059870194c206d7f5250c01980632269af54ee1aee7323703c93f86bf22edc1a2e46342873255021d3930b04ffd13d2aa27038d038d5bf95804e05d628fe79ecdc11d81c64847b8c882d436461a9f8cf4a00c99ba4e7b892a76af1ec38a899ecffe09d36c6e31ff09a3e097220228298fabd13bee2c4ec6e2697103c5862a4503a73862f192dc0326e3fd069e299bac51a87ce459ad05c8cddd6f343d6a5466a3b36aff125b30c0259bd6576846dcce31ee56a559a13e180e4e552fb24ef0793ead4fe1cad0cdadbd862201341feb46003703bed42c0d79f40497e2b9f832d409d4dad17f8a73c4abd7ebd694589a47f3c689d36b68fdb392de67c2f664069cc0b793d004b53d7000a7aaa041d0a2159d26361d3ae405183032053c24aaea34504a2f927a8f415adbd3c16cb137bc9f83e6835cf6baa83c05e0b8af94f65b7250a29cf4d7b27a3eb9da97a091e8fdcc7651c3811135b4c99650f14f2161995c85e5b6b03f518c3eb09c4d9d0b384caa21ce0f6c5122a0a9458d7984628152f732e16e5366c42a4544590e6ae713fdaaaea141040e42147eb3bddadc7d865f80e42b6d428a32ee8bc066dde457df7fd16f70440b62cd671a0f356671993c9de18dc3167408c4727f773871d5ecc75f7badff3484c6b40f96df5cfb9515c3ad61ddbea31e20890a5c8df4b0c600b1a90f67efd94cacbe99615727c6df67af4d36a115fdcf187cfc5c137b8324750205cb0b0b05fc29bd3c041d118a78041769736d9b0e94fbb28b9290ec90c484a109dd76d021d9cb47d6e4051c1e29fb0537a110eaf22aa0956eb76bc202c293652063181869b04c35f4a8369da3854c293c554779318bb7dc24d256d8ebb07c1ad24e08711ee352f2490060240ce510dd2ae33d4feb363c6c626d482185b8ec11a31a2da37411761c6ca66a064816bc7ce409815c3e33bcf02bad6da017b89e6372e2aaf5a3f3e64321861075075392fb6d3cf81e76be9cc1614a7ff3afc14b046df7b09cf3f322be23dfd8937b04619f32bb4632130851651460fdca761c290c675d64c04d86c777878759d7a55922d77e6f973515e9c1e8179d978b10c69c10a5c106c988ff5a3aaf1c15edd2e6524ed2e524906e87afe8441e28843c5bbc1cc8b72fce458d3984b83f76020023b68aa3b7c52a628522fd0c1cacbe34f7ea2862ceddfb4bda7cfe0cd4cafa9c142d40aea573da56363256dde8988d4c75bfee9843fd40932eca80cc3d222b1130a7e4d6e8780464956e521fc4d8b7875ff0da97618ae8771167e30b79cefc6160e16ebe0e6beb7a59f133f38bc3eafe16f47c226b27e4a8b606d7433cfcc2ae9e241d86e72daa67b83cffe7d60535064bc3848dd15939566c41710195b5bf35d4b33c7cec287e9afd1443cc8595577fcc1526c22a6672c86e6aacc3000c62f09f4c79dc63fccb618a62b40cded8748c2dfcf9db3e9a5f40c3a35c1ace067b77f27be409e1d2e4ccc1b4b6956f3e686dabdf8ac9c49f1e4c0ccc9d309356fe8457d83a4b88e5f4e25eca5a336b13200a713372bfb30ea0ad24ae7c7646f8d632d60c2b38a678620b0962f6a3bfba8ccf2c92356957c25bedd5fb53c2bf128100fa4bc3437f79eaf9d5ca3c7787e2897c786bfe47f5b9726c229388af4e2efc717592e72050403dcc065ee9f01c0b1b75af23b6a7a80a0ca3392a2d5f3eeecc03850fc013c3107604119954b405237e307286690d01823c77e9ac451559c0d30224c46cc6eba174c8c033265ac509f6102f73f92679dd196958c47993c45824b0c40f11d8a8d262229d2cb7fb1be1f9bf4ca70cad40118e9ff044a7a5fa4e7159efb1cd0098857f415723701c5d1bcf0df038f33c4dbc9361aa4274828125d73c7565f13a1fefa4445c96c9e51930a9058a339f0b967734e5f12aad501ae877afb7ce8477d9c8e29030ecf054beb934c5b07e5680b465432417c59e1f59b7760e5db196a52199ebd2b683e3014fc92c44c1f80e0214f2fca7600ff044d0a155cbe7ccdde20184f8293ea61bc50302724cf6c08759ad79b0d27172fe3351557120da4bb10810af61d99f7d971995c3a51123d339d3268abad1c578989d999b0409237899ef43feb1da81f75f226c67b5a2e5f56991c7814d8c06f3b9abf07bee8add90245645205e550da76d4ccd4fbc113fbeea2bc4a8b230e7daac36c93ab2ec20cbfb8576133c8b3ac7b2b6a8633945fea031855490635adca63ccd86144d3609e2ce8a7eadd0a63f1b48d0246ddd1133b6de19ade411b27f026030d2e34da4d1686c726d2c11560928b7ef2684e91f6d77fbf4483ce8567775f5388ebef76d116d9b44228a4155b45714d1ccba698534ee72c4ca40957fb50ff6182468d745dfb10969826c66481e09531a1d809c9b00a839783bb3ab835f703edc174647d9d20bf46da1db53c208fa67d869c987bf9b882a1dcec2b51c43c5f5218b78ef5393e247e83c2548fb2f19129796d26822ca9c10b0776ad99e8fca55baacfe66c5c2b5606f5b85f5063d7c97006f4fe2c05f0cf07093dbbaa280bc064f040c048aef30390b223df0911ab6264088c5494f4a03f2909dac76a7353d0ff1967a06c42ea0bd924894c291d3bba4058c6ae3a2117fd88bc5a50e0bd5e95250fb81d33ffb94fe4257f0c1b532cabb35e9b9067550dbc2bb721b8ea5c0fd390bfacd847ac43108017d2419c7c509ae5caf68c397133b232ea7a6f40dff889ff1beaad0f996dfb9f4871115c35616934eccb2c95bfb1fc0c18b320ddd71813a407258a7c6b21b22ce2b9b34bdcfcc1f37cdbcf4b0a37363cc1b42ce59c1a5ed90796c2d5bcf3ebba7b5f2553e554e5d9448adfc1807f60f749e20eab6ef34d24136b62e7a710da395f581a7174a10478c6752dc500923d84084a41d888ce4295109d4c3b65d4d35b2ce5839543563925ea487108b58cbbe0edb774fa912d17f4b207172a293f85c50c3647f34d645d843deeb1d8a131836379a84976421f50acdd14c85b820c7b268a04e8ddfc98c750bc4489bea7b2143faaa9bb6837ffa440efa115286f9ab161f5e37fcb73a0641113319bc10dad63ebcc3d9e1c56387c806d4f48f8b0c89049b46ba79988cedc7e8863f61dfcf922c970151928d09e384ecd3c92ee75192f107843bfee7479c6533c70e85d228f31ccaef90ceb0787cde54f3528625b97110b6e8c1f5e90f7304e740854e5c4cebaeed11797b72af85cc180fd8a4c414353993a258b2f9f71e0af05aae016a7227c7e77900f9a32a3370ad804251f5e0752364d649b8858dca39121cc41adfe3d3f3a0da645f2e5e28449f5e23be3cb12587d6f5a7104826bf0f130e164ced009bc7f148cd244b7d9fd122a4cf128c0f148182ca9c329acf5e798b7a253a79082b19df91c70f1b3c5552694366ee8136e8d307d96ef8924f46febe37ebfde23d1b0e4674e1fe65351efa5c394437f6fc068666dcd5dbda21ee1596b27ee5b6d8945e4d8dddaf667e297898f75fe6b6c4bb4af1b48378cb64225dd63cdfa79bc4b3e0af621f2b8453f2b18956dc624623559d4db92d60e273d8b4e5c152c8bd010815537c88b0711861d1704493d2b15878732cfd48d556486b8d5703d1a44710647605fc869828aa80c840ea</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>RDBMS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…³ç³»å‹æ•°æ®åº“</tag>
      
      <tag>RDBMS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle é¡¹ç›®ä¸­ MapStruct é…ç½®æŒ‡å—</title>
    <link href="/2025/10/21/mapstruct/Gradle%20%E9%A1%B9%E7%9B%AE%20MapStruct%20%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/"/>
    <url>/2025/10/21/mapstruct/Gradle%20%E9%A1%B9%E7%9B%AE%20MapStruct%20%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h1 id="Gradle-é¡¹ç›®ä¸­-MapStruct-é…ç½®æŒ‡å—ï¼šJava-ä¸-Kotlin-å®Œæ•´å®è·µ"><a href="#Gradle-é¡¹ç›®ä¸­-MapStruct-é…ç½®æŒ‡å—ï¼šJava-ä¸-Kotlin-å®Œæ•´å®è·µ" class="headerlink" title="Gradle é¡¹ç›®ä¸­ MapStruct é…ç½®æŒ‡å—ï¼šJava ä¸ Kotlin å®Œæ•´å®è·µ"></a>Gradle é¡¹ç›®ä¸­ MapStruct é…ç½®æŒ‡å—ï¼šJava ä¸ Kotlin å®Œæ•´å®è·µ</h1><h2 id="ä»€ä¹ˆæ˜¯-MapStructï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-MapStructï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ MapStructï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ MapStructï¼Ÿ</h2><p>MapStruct æ˜¯ä¸€ä¸ª<strong>ä»£ç ç”Ÿæˆå™¨</strong>ï¼Œå®ƒåŸºäº<strong>çº¦å®šä¼˜äºé…ç½®</strong>çš„åŸåˆ™ï¼Œæå¤§åœ°ç®€åŒ–äº† Java Bean ç±»å‹ä¹‹é—´çš„æ˜ å°„å®ç°ã€‚é€šè¿‡å®šä¹‰ Mapper æ¥å£ï¼ŒMapStruct åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆæ˜ å°„å®ç°ä»£ç ï¼Œè¿™ç§æ–¹å¼æ—¢ä¿è¯äº†ç±»å‹å®‰å…¨ï¼Œåˆé¿å…äº†æ‰‹åŠ¨ç¼–å†™ç¹çæ˜ å°„ä»£ç çš„ç—›è‹¦ã€‚</p><h3 id="MapStruct-çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š"><a href="#MapStruct-çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š" class="headerlink" title="MapStruct çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š"></a>MapStruct çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</h3><ul><li><strong>ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç </strong> - æ— è¿è¡Œæ—¶æ€§èƒ½æŸè€—</li><li><strong>ç±»å‹å®‰å…¨</strong> - ç¼–è¯‘æ—¶æ£€æŸ¥æ˜ å°„é”™è¯¯</li><li><strong>æ˜“äºè°ƒè¯•</strong> - ç”Ÿæˆçš„ä»£ç å¯è¯»æ€§å¼º</li><li><strong>é«˜åº¦å¯é…ç½®</strong> - æ”¯æŒå¤æ‚æ˜ å°„åœºæ™¯</li></ul><h2 id="æ–‡ç« æ¦‚è¿°"><a href="#æ–‡ç« æ¦‚è¿°" class="headerlink" title="æ–‡ç« æ¦‚è¿°"></a>æ–‡ç« æ¦‚è¿°</h2><p>æœ¬æ–‡å°†å…¨é¢ä»‹ç»åœ¨ Gradle é¡¹ç›®ä¸­é…ç½® MapStruct çš„å®Œæ•´æ–¹æ¡ˆï¼Œæ¶µç›–ï¼š</p><ol><li><strong>Java é¡¹ç›®é…ç½®</strong> - ä½¿ç”¨ annotationProcessor çš„åŸºæœ¬å’Œè¿›é˜¶é…ç½®</li><li><strong>Kotlin é¡¹ç›®é…ç½®</strong> - ä½¿ç”¨ kapt çš„è¯¦ç»†è®¾ç½®å’Œå¸¸è§é—®é¢˜è§£å†³</li><li><strong>å®ç”¨æŠ€å·§</strong> - ç»„ä»¶æ¨¡å‹é…ç½®ã€æ˜ å°„ç­–ç•¥ä¼˜åŒ–ç­‰å®æˆ˜ç»éªŒ</li><li><strong>æ•…éšœæ’æŸ¥</strong> - è§£å†³ä»£ç æœªç”Ÿæˆã€æ€§èƒ½ä¼˜åŒ–ç­‰å¸¸è§é—®é¢˜</li></ol><p>æ— è®ºä½ æ˜¯çº¯ Java é¡¹ç›®ã€çº¯ Kotlin é¡¹ç›®è¿˜æ˜¯æ··åˆè¯­è¨€é¡¹ç›®ï¼Œæœ¬æ–‡éƒ½å°†ä¸ºä½ æä¾›å¯é çš„é…ç½®æ–¹æ¡ˆã€‚</p><hr><h2 id="ğŸ”§-Java-é¡¹ç›®é…ç½®"><a href="#ğŸ”§-Java-é¡¹ç›®é…ç½®" class="headerlink" title="ğŸ”§ Java é¡¹ç›®é…ç½®"></a>ğŸ”§ Java é¡¹ç›®é…ç½®</h2><p>åœ¨ Java é¡¹ç›®ä¸­ï¼Œä¸»è¦ä½¿ç”¨ <code>annotationProcessor</code> æ¥å¼•å…¥ MapStruct å¤„ç†å™¨ã€‚</p><h3 id="1-åŸºæœ¬ä¾èµ–é…ç½®"><a href="#1-åŸºæœ¬ä¾èµ–é…ç½®" class="headerlink" title="1. åŸºæœ¬ä¾èµ–é…ç½®"></a>1. åŸºæœ¬ä¾èµ–é…ç½®</h3><p>åœ¨ <code>build.gradle</code> ä¸­æ·»åŠ ä¾èµ–ï¼š</p><p>gradle</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs clean">plugins &#123;<br>    id <span class="hljs-string">&#x27;java&#x27;</span><br>&#125;<br><br>dependencies &#123;<br>    <span class="hljs-keyword">implementation</span> <span class="hljs-string">&#x27;org.mapstruct:mapstruct:1.5.5.Final&#x27;</span><br>    annotationProcessor <span class="hljs-string">&#x27;org.mapstruct:mapstruct-processor:1.5.5.Final&#x27;</span><br>    <br>    <span class="hljs-comment">// å¦‚æœä½¿ç”¨ Spring</span><br>    <span class="hljs-keyword">implementation</span> <span class="hljs-string">&#x27;org.springframework.boot:spring-boot-starter:2.7.0&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-ç»„ä»¶æ¨¡å‹è®¾ç½®"><a href="#2-ç»„ä»¶æ¨¡å‹è®¾ç½®" class="headerlink" title="2. ç»„ä»¶æ¨¡å‹è®¾ç½®"></a>2. ç»„ä»¶æ¨¡å‹è®¾ç½®</h3><p>å¦‚æœä½ æƒ³å°†æ˜ å°„å™¨å®ä¾‹ä½œä¸º Spring Bean æ³¨å…¥ï¼Œå¯ä»¥é€šè¿‡ <code>compilerArgs</code> è®¾ç½®ç»„ä»¶æ¨¡å‹ï¼š</p><p>gradle</p><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-keyword">compileJava</span> &#123;<br>    <span class="hljs-literal">options</span>.compilerArgs += [<br>        <span class="hljs-string">&quot;-Amapstruct.defaultComponentModel=spring&quot;</span>,<br>        <span class="hljs-string">&quot;-Amapstruct.unmappedTargetPolicy=IGNORE&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-å®Œæ•´-Java-é…ç½®ç¤ºä¾‹"><a href="#3-å®Œæ•´-Java-é…ç½®ç¤ºä¾‹" class="headerlink" title="3. å®Œæ•´ Java é…ç½®ç¤ºä¾‹"></a>3. å®Œæ•´ Java é…ç½®ç¤ºä¾‹</h3><p>gradle</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">plugins &#123;<br>    <span class="hljs-built_in">id</span> <span class="hljs-string">&#x27;java&#x27;</span><br>    <span class="hljs-built_in">id</span> <span class="hljs-string">&#x27;org.springframework.boot&#x27;</span> version <span class="hljs-string">&#x27;2.7.0&#x27;</span><br>&#125;<br><br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;org.mapstruct:mapstruct:1.5.5.Final&#x27;</span><br>    annotationProcessor <span class="hljs-string">&#x27;org.mapstruct:mapstruct-processor:1.5.5.Final&#x27;</span><br>    testAnnotationProcessor <span class="hljs-string">&#x27;org.mapstruct:mapstruct-processor:1.5.5.Final&#x27;</span><br>    <br>    implementation <span class="hljs-string">&#x27;org.springframework.boot:spring-boot-starter&#x27;</span><br>&#125;<br><br>compileJava &#123;<br>    options.compilerArgs += [<br>        <span class="hljs-string">&quot;-Amapstruct.defaultComponentModel=spring&quot;</span>,<br>        <span class="hljs-string">&quot;-Amapstruct.unmappedTargetPolicy=WARN&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="âš™ï¸-Kotlin-é¡¹ç›®é…ç½®"><a href="#âš™ï¸-Kotlin-é¡¹ç›®é…ç½®" class="headerlink" title="âš™ï¸ Kotlin é¡¹ç›®é…ç½®"></a>âš™ï¸ Kotlin é¡¹ç›®é…ç½®</h2><p>åœ¨ Kotlin é¡¹ç›®ä¸­ï¼Œç”±äº <code>annotationProcessor</code> å¯¹ Kotlin ä»£ç ä¸ç”Ÿæ•ˆï¼Œéœ€è¦ä½¿ç”¨ <strong>kapt</strong> (Kotlin Annotation Processing Tool)ã€‚</p><h3 id="1-åº”ç”¨-kapt-æ’ä»¶"><a href="#1-åº”ç”¨-kapt-æ’ä»¶" class="headerlink" title="1. åº”ç”¨ kapt æ’ä»¶"></a>1. åº”ç”¨ kapt æ’ä»¶</h3><p>ç¡®ä¿åœ¨ <code>build.gradle.kts</code> ä¸­åº”ç”¨äº† kapt æ’ä»¶ï¼š</p><p>kotlin</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs d">plugins &#123;<br>    kotlin(<span class="hljs-string">&quot;jvm&quot;</span>) <span class="hljs-keyword">version</span> <span class="hljs-string">&quot;1.9.0&quot;</span><br>    kotlin(<span class="hljs-string">&quot;kapt&quot;</span>) <span class="hljs-keyword">version</span> <span class="hljs-string">&quot;1.9.0&quot;</span>  <span class="hljs-comment">// å…³é”®ï¼škapt æ’ä»¶</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-æ·»åŠ ä¾èµ–å’Œé…ç½®"><a href="#2-æ·»åŠ ä¾èµ–å’Œé…ç½®" class="headerlink" title="2. æ·»åŠ ä¾èµ–å’Œé…ç½®"></a>2. æ·»åŠ ä¾èµ–å’Œé…ç½®</h3><p>kotlin</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dependencies &#123;<br>    <span class="hljs-built_in">implementation</span>(<span class="hljs-string">&quot;org.mapstruct:mapstruct:1.5.5.Final&quot;</span>)<br>    <span class="hljs-built_in">kapt</span>(<span class="hljs-string">&quot;org.mapstruct:mapstruct-processor:1.5.5.Final&quot;</span>)<br>    <br>    <span class="hljs-comment">// å¦‚æœä½¿ç”¨ Spring</span><br>    <span class="hljs-built_in">implementation</span>(<span class="hljs-string">&quot;org.springframework.boot:spring-boot-starter:2.7.0&quot;</span>)<br>&#125;<br><br>kapt &#123;<br>    correctErrorTypes = true<br>    arguments &#123;<br>        <span class="hljs-built_in">arg</span>(<span class="hljs-string">&quot;mapstruct.defaultComponentModel&quot;</span>, <span class="hljs-string">&quot;spring&quot;</span>)<br>        <span class="hljs-built_in">arg</span>(<span class="hljs-string">&quot;mapstruct.unmappedTargetPolicy&quot;</span>, <span class="hljs-string">&quot;IGNORE&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-é…ç½®å‚æ•°è¯¦è§£"><a href="#3-é…ç½®å‚æ•°è¯¦è§£" class="headerlink" title="3. é…ç½®å‚æ•°è¯¦è§£"></a>3. é…ç½®å‚æ•°è¯¦è§£</h3><ul><li><strong>correctErrorTypes &#x3D; true</strong> - é˜²æ­¢ kapt å°†ç”Ÿæˆçš„ç±»è¯†åˆ«ä¸ºä¸å­˜åœ¨çš„ç±»å‹</li><li><strong>mapstruct.defaultComponentModel</strong> - è®¾ç½®ç”Ÿæˆçš„ Mapper ç»„ä»¶æ¨¡å‹<ul><li><code>spring</code> - ä½œä¸º Spring Bean</li><li><code>cdi</code> - ä½œä¸º CDI Bean</li><li><code>jsr330</code> - ä½¿ç”¨ <code>@Named</code> æ³¨è§£</li></ul></li><li><strong>mapstruct.unmappedTargetPolicy</strong> - æœªæ˜ å°„å­—æ®µå¤„ç†ç­–ç•¥<ul><li><code>IGNORE</code> - å¿½ç•¥</li><li><code>WARN</code> - è­¦å‘Š</li><li><code>ERROR</code> - ç¼–è¯‘é”™è¯¯</li></ul></li></ul><h3 id="4-å®Œæ•´-Kotlin-é…ç½®ç¤ºä¾‹"><a href="#4-å®Œæ•´-Kotlin-é…ç½®ç¤ºä¾‹" class="headerlink" title="4. å®Œæ•´ Kotlin é…ç½®ç¤ºä¾‹"></a>4. å®Œæ•´ Kotlin é…ç½®ç¤ºä¾‹</h3><p>kotlin</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs stylus">plugins &#123;<br>    <span class="hljs-built_in">kotlin</span>(<span class="hljs-string">&quot;jvm&quot;</span>) version <span class="hljs-string">&quot;1.9.0&quot;</span><br>    <span class="hljs-built_in">kotlin</span>(<span class="hljs-string">&quot;kapt&quot;</span>) version <span class="hljs-string">&quot;1.9.0&quot;</span><br>    <span class="hljs-built_in">id</span>(<span class="hljs-string">&quot;org.springframework.boot&quot;</span>) version <span class="hljs-string">&quot;2.7.0&quot;</span><br>&#125;<br><br>dependencies &#123;<br>    <span class="hljs-built_in">implementation</span>(<span class="hljs-string">&quot;org.mapstruct:mapstruct:1.5.5.Final&quot;</span>)<br>    <span class="hljs-built_in">kapt</span>(<span class="hljs-string">&quot;org.mapstruct:mapstruct-processor:1.5.5.Final&quot;</span>)<br>    <span class="hljs-built_in">implementation</span>(<span class="hljs-string">&quot;org.springframework.boot:spring-boot-starter&quot;</span>)<br>&#125;<br><br>kapt &#123;<br>    correctErrorTypes = true<br>    keepJavacAnnotationProcessors = true<br>    arguments &#123;<br>        <span class="hljs-built_in">arg</span>(<span class="hljs-string">&quot;mapstruct.defaultComponentModel&quot;</span>, <span class="hljs-string">&quot;spring&quot;</span>)<br>        <span class="hljs-built_in">arg</span>(<span class="hljs-string">&quot;mapstruct.unmappedTargetPolicy&quot;</span>, <span class="hljs-string">&quot;WARN&quot;</span>)<br>        <span class="hljs-built_in">arg</span>(<span class="hljs-string">&quot;mapstruct.verbose&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ğŸ¯-Mapper-æ¥å£ç¤ºä¾‹"><a href="#ğŸ¯-Mapper-æ¥å£ç¤ºä¾‹" class="headerlink" title="ğŸ¯ Mapper æ¥å£ç¤ºä¾‹"></a>ğŸ¯ Mapper æ¥å£ç¤ºä¾‹</h2><h3 id="Java-Mapper-ç¤ºä¾‹"><a href="#Java-Mapper-ç¤ºä¾‹" class="headerlink" title="Java Mapper ç¤ºä¾‹"></a>Java Mapper ç¤ºä¾‹</h3><p>java</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pf">@Mapper(componentModel = <span class="hljs-string">&quot;spring&quot;</span>)<br>public interface UserMapper &#123;<br>    <br>    @Mapping(source = <span class="hljs-string">&quot;username&quot;</span>, target = <span class="hljs-string">&quot;name&quot;</span>)<br>    @Mapping(source = <span class="hljs-string">&quot;createdAt&quot;</span>, target = <span class="hljs-string">&quot;registrationDate&quot;</span>)<br>    UserD<span class="hljs-keyword">to</span> <span class="hljs-keyword">to</span>D<span class="hljs-keyword">to</span>(User <span class="hljs-keyword">user</span>);<br>    <br>    User <span class="hljs-keyword">to</span>Entity(UserD<span class="hljs-keyword">to</span> dto);<br>    <br>    List<span class="hljs-variable">&lt;UserDto&gt;</span> <span class="hljs-keyword">to</span>D<span class="hljs-keyword">to</span>List(List<span class="hljs-variable">&lt;User&gt;</span> users);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Kotlin-Mapper-ç¤ºä¾‹"><a href="#Kotlin-Mapper-ç¤ºä¾‹" class="headerlink" title="Kotlin Mapper ç¤ºä¾‹"></a>Kotlin Mapper ç¤ºä¾‹</h3><p>kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Mapper(componentModel = <span class="hljs-string">&quot;spring&quot;</span>)</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <br>    <span class="hljs-meta">@Mapping(source = <span class="hljs-string">&quot;username&quot;</span>, target = <span class="hljs-string">&quot;name&quot;</span>)</span><br>    <span class="hljs-meta">@Mapping(source = <span class="hljs-string">&quot;createdAt&quot;</span>, target = <span class="hljs-string">&quot;registrationDate&quot;</span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toDto</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>: UserDto<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toEntity</span><span class="hljs-params">(dto: <span class="hljs-type">UserDto</span>)</span></span>: User<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toDtoList</span><span class="hljs-params">(users: <span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt;)</span></span>: List&lt;UserDto&gt;<br>&#125;<br><br><span class="hljs-comment">// æ•°æ®ç±»å®šä¹‰</span><br><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<br>    <span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Long</span>,<br>    <span class="hljs-keyword">val</span> username: String,<br>    <span class="hljs-keyword">val</span> email: String,<br>    <span class="hljs-keyword">val</span> createdAt: java.time.Instant<br>)<br><br><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDto</span>(<br>    <span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Long</span>,<br>    <span class="hljs-keyword">val</span> name: String,<br>    <span class="hljs-keyword">val</span> email: String,<br>    <span class="hljs-keyword">val</span> registrationDate: java.time.Instant<br>)<br></code></pre></td></tr></table></figure><h2 id="ğŸš¨-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#ğŸš¨-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ğŸš¨ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>ğŸš¨ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-MapStruct-æœªç”Ÿæˆä»£ç "><a href="#1-MapStruct-æœªç”Ÿæˆä»£ç " class="headerlink" title="1. MapStruct æœªç”Ÿæˆä»£ç "></a>1. MapStruct æœªç”Ÿæˆä»£ç </h3><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¸…ç†å¹¶é‡æ–°æ„å»º</span><br>./gradlew clean build<br><br><span class="hljs-comment"># æˆ–è€…åªè¿è¡Œæ³¨è§£å¤„ç†ä»»åŠ¡</span><br>./gradlew kaptKotlin  <span class="hljs-comment"># Kotlin é¡¹ç›®</span><br>./gradlew compileJava  <span class="hljs-comment"># Java é¡¹ç›®</span><br></code></pre></td></tr></table></figure><h3 id="2-IDE-ä¸­æ— æ³•è¯†åˆ«ç”Ÿæˆçš„ä»£ç "><a href="#2-IDE-ä¸­æ— æ³•è¯†åˆ«ç”Ÿæˆçš„ä»£ç " class="headerlink" title="2. IDE ä¸­æ— æ³•è¯†åˆ«ç”Ÿæˆçš„ä»£ç "></a>2. IDE ä¸­æ— æ³•è¯†åˆ«ç”Ÿæˆçš„ä»£ç </h3><p><strong>IntelliJ IDEA è®¾ç½®ï¼š</strong></p><ul><li><strong>Settings</strong> â†’ <strong>Build, Execution, Deployment</strong> â†’ <strong>Compiler</strong> â†’ <strong>Annotation Processors</strong></li><li>å‹¾é€‰ <strong>Enable annotation processing</strong></li><li>æˆ–è€…å§”æ‰˜ç»™ Gradleï¼š<strong>Settings</strong> â†’ <strong>Build Tools</strong> â†’ <strong>Gradle</strong> â†’ <strong>Runner</strong></li><li>å‹¾é€‰ <strong>Delegate IDE build&#x2F;run actions to Gradle</strong></li></ul><h3 id="3-ä¸-Lombok-ä¸€èµ·ä½¿ç”¨"><a href="#3-ä¸-Lombok-ä¸€èµ·ä½¿ç”¨" class="headerlink" title="3. ä¸ Lombok ä¸€èµ·ä½¿ç”¨"></a>3. ä¸ Lombok ä¸€èµ·ä½¿ç”¨</h3><p>å¯¹äº Java é¡¹ç›®ï¼Œéœ€è¦ç¡®ä¿ Lombok åœ¨ MapStruct ä¹‹å‰å¤„ç†ï¼š</p><p>gradle</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">dependencies &#123;<br>    <span class="hljs-attribute">compileOnly &#x27;org.projectlombok</span>:lombok:1.18.24&#x27;<br>    annotationProcessor &#x27;org<span class="hljs-variable">.projectlombok</span>:lombok:1.18.24&#x27;<br>    implementation &#x27;org<span class="hljs-variable">.mapstruct</span>:mapstruct:1.5.5<span class="hljs-variable">.Final</span>&#x27;<br>    annotationProcessor &#x27;org<span class="hljs-variable">.mapstruct</span>:mapstruct-processor:1.5.5<span class="hljs-variable">.Final</span>&#x27;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-æ€§èƒ½ä¼˜åŒ–é…ç½®"><a href="#4-æ€§èƒ½ä¼˜åŒ–é…ç½®" class="headerlink" title="4. æ€§èƒ½ä¼˜åŒ–é…ç½®"></a>4. æ€§èƒ½ä¼˜åŒ–é…ç½®</h3><p>åœ¨ <code>gradle.properties</code> ä¸­æ·»åŠ ï¼š</p><p>properties</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># å¯ç”¨å¢é‡æ³¨è§£å¤„ç†</span><br><span class="hljs-attr">kapt.incremental.apt</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># ä½¿ç”¨ Worker API å¹¶è¡Œæ‰§è¡Œ</span><br><span class="hljs-attr">kapt.use.worker.api</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># å¯ç”¨ç¼–è¯‘è§„é¿</span><br><span class="hljs-attr">kapt.include.compile.classpath</span>=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="ğŸ’¡-å®ç”¨æŠ€å·§"><a href="#ğŸ’¡-å®ç”¨æŠ€å·§" class="headerlink" title="ğŸ’¡ å®ç”¨æŠ€å·§"></a>ğŸ’¡ å®ç”¨æŠ€å·§</h2><h3 id="1-è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•"><a href="#1-è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•" class="headerlink" title="1. è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•"></a>1. è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•</h3><p>kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Mapper(componentModel = <span class="hljs-string">&quot;spring&quot;</span>)</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toDto</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>: UserDto<br>    <br>    <span class="hljs-comment">// è‡ªå®šä¹‰æ˜ å°„é€»è¾‘</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toDetailedDto</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>: UserDetailedDto &#123;<br>        <span class="hljs-keyword">return</span> UserDetailedDto(<br>            id = user.id,<br>            displayName = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;user.firstName&#125;</span> <span class="hljs-subst">$&#123;user.lastName&#125;</span>&quot;</span>,<br>            email = user.email<br>        )<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œå¤æ‚æ˜ å°„"><a href="#2-ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œå¤æ‚æ˜ å°„" class="headerlink" title="2. ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œå¤æ‚æ˜ å°„"></a>2. ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œå¤æ‚æ˜ å°„</h3><p>java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper(componentModel = &quot;spring&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductMapper</span> &#123;<br>    <br>    <span class="hljs-meta">@Mapping(target = &quot;priceWithTax&quot;, </span><br><span class="hljs-meta">             expression = &quot;java(product.getPrice().multiply(BigDecimal.valueOf(1.19)))&quot;)</span><br>    ProductDto <span class="hljs-title function_">toDto</span><span class="hljs-params">(Product product)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-æ³¨å…¥å…¶ä»–æœåŠ¡åˆ°-Mapper"><a href="#3-æ³¨å…¥å…¶ä»–æœåŠ¡åˆ°-Mapper" class="headerlink" title="3. æ³¨å…¥å…¶ä»–æœåŠ¡åˆ° Mapper"></a>3. æ³¨å…¥å…¶ä»–æœåŠ¡åˆ° Mapper</h3><p>kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Mapper(componentModel = <span class="hljs-string">&quot;spring&quot;</span>)</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> passwordEncoder: PasswordEncoder<br>    <br>    <span class="hljs-meta">@Mapping(target = <span class="hljs-string">&quot;passwordHash&quot;</span>, ignore = true)</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toEntity</span><span class="hljs-params">(dto: <span class="hljs-type">CreateUserDto</span>)</span></span>: UserEntity<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toEntityWithPassword</span><span class="hljs-params">(dto: <span class="hljs-type">CreateUserDto</span>)</span></span>: UserEntity &#123;<br>        <span class="hljs-keyword">val</span> user = toEntity(dto)<br>        user.passwordHash = passwordEncoder.encode(dto.password)<br>        <span class="hljs-keyword">return</span> user<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ğŸ”„-æ··åˆé¡¹ç›®é…ç½®"><a href="#ğŸ”„-æ··åˆé¡¹ç›®é…ç½®" class="headerlink" title="ğŸ”„ æ··åˆé¡¹ç›®é…ç½®"></a>ğŸ”„ æ··åˆé¡¹ç›®é…ç½®</h2><p>å¯¹äºåŒæ—¶åŒ…å« Java å’Œ Kotlin ä»£ç çš„é¡¹ç›®ï¼š</p><p>kotlin</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs stylus">plugins &#123;<br>    <span class="hljs-built_in">kotlin</span>(<span class="hljs-string">&quot;jvm&quot;</span>) version <span class="hljs-string">&quot;1.9.0&quot;</span><br>    <span class="hljs-built_in">kotlin</span>(<span class="hljs-string">&quot;kapt&quot;</span>) version <span class="hljs-string">&quot;1.9.0&quot;</span><br>    <span class="hljs-built_in">id</span>(<span class="hljs-string">&quot;java&quot;</span>)<br>&#125;<br><br>dependencies &#123;<br>    <span class="hljs-built_in">implementation</span>(<span class="hljs-string">&quot;org.mapstruct:mapstruct:1.5.5.Final&quot;</span>)<br>    <br>    <span class="hljs-comment">// å¤„ç† Java ä»£ç </span><br>    <span class="hljs-built_in">annotationProcessor</span>(<span class="hljs-string">&quot;org.mapstruct:mapstruct-processor:1.5.5.Final&quot;</span>)<br>    <br>    <span class="hljs-comment">// å¤„ç† Kotlin ä»£ç   </span><br>    <span class="hljs-built_in">kapt</span>(<span class="hljs-string">&quot;org.mapstruct:mapstruct-processor:1.5.5.Final&quot;</span>)<br>&#125;<br><br>kapt &#123;<br>    arguments &#123;<br>        <span class="hljs-built_in">arg</span>(<span class="hljs-string">&quot;mapstruct.defaultComponentModel&quot;</span>, <span class="hljs-string">&quot;spring&quot;</span>)<br>    &#125;<br>&#125;<br><br>tasks<span class="hljs-selector-class">.compileJava</span> &#123;<br>    options<span class="hljs-selector-class">.compilerArgs</span><span class="hljs-selector-class">.addAll</span>(<span class="hljs-built_in">listOf</span>(<br>        <span class="hljs-string">&quot;-Amapstruct.defaultComponentModel=spring&quot;</span><br>    ))<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="âœ…-éªŒè¯é…ç½®"><a href="#âœ…-éªŒè¯é…ç½®" class="headerlink" title="âœ… éªŒè¯é…ç½®"></a>âœ… éªŒè¯é…ç½®</h2><p>åˆ›å»ºæµ‹è¯•éªŒè¯æ˜ å°„å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p><p>kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserMapperTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> userMapper: UserMapper<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testUserMapping</span><span class="hljs-params">()</span></span> &#123;<br>        <span class="hljs-keyword">val</span> user = User(<br>            id = <span class="hljs-number">1L</span>,<br>            username = <span class="hljs-string">&quot;john_doe&quot;</span>, <br>            email = <span class="hljs-string">&quot;john@example.com&quot;</span>,<br>            createdAt = Instant.now()<br>        )<br>        <br>        <span class="hljs-keyword">val</span> dto = userMapper.toDto(user)<br>        <br>        assertThat(dto.name).isEqualTo(user.username)<br>        assertThat(dto.registrationDate).isEqualTo(user.createdAt)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ğŸ’-æ€»ç»“"><a href="#ğŸ’-æ€»ç»“" class="headerlink" title="ğŸ’ æ€»ç»“"></a>ğŸ’ æ€»ç»“</h2><p>é€šè¿‡æœ¬æ–‡çš„é…ç½®æŒ‡å—ï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š</p><ul><li>âœ… åœ¨ Java é¡¹ç›®ä¸­æ­£ç¡®é…ç½® MapStruct</li><li>âœ… åœ¨ Kotlin é¡¹ç›®ä¸­è§£å†³ kapt é…ç½®é—®é¢˜</li><li>âœ… æ ¹æ®éœ€æ±‚é…ç½®åˆé€‚çš„ç»„ä»¶æ¨¡å‹å’Œæ˜ å°„ç­–ç•¥</li><li>âœ… è§£å†³å¸¸è§çš„ä»£ç ç”Ÿæˆé—®é¢˜</li><li>âœ… ä¼˜åŒ–æ„å»ºæ€§èƒ½</li></ul><p>è®°ä½å…³é”®ç‚¹ï¼š<strong>Java é¡¹ç›®ç”¨ annotationProcessorï¼ŒKotlin é¡¹ç›®ç”¨ kapt</strong>ï¼Œè¿™æ˜¯å¤§å¤šæ•°é…ç½®é—®é¢˜çš„æ ¹æºã€‚åˆç†ä½¿ç”¨ç»„ä»¶æ¨¡å‹å’Œæ˜ å°„ç­–ç•¥ï¼Œå¯ä»¥å¤§å¤§æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚</p><p>MapStruct çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒçš„ç¼–è¯‘æ—¶ä»£ç ç”Ÿæˆï¼Œæ—¢ä¿è¯äº†æ€§èƒ½åˆæä¾›äº†ç±»å‹å®‰å…¨ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ åœ¨é¡¹ç›®ä¸­é¡ºåˆ©ä½¿ç”¨ MapStructï¼</p>]]></content>
    
    
    <categories>
      
      <category>Gradle</category>
      
      <category>MapStruct</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Gradle</tag>
      
      <tag>MapStruct</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JOOQ å¸¸ç”¨æ“ä½œ</title>
    <link href="/2025/10/17/jooq/JOOQ%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <url>/2025/10/17/jooq/JOOQ%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>JOOQ å¸¸ç”¨æ“ä½œ</p><h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// åˆå§‹åŒ–ä¸å¸¦è¿æ¥çš„ä¸Šä¸‹æ–‡æ“ä½œ</span><br><span class="hljs-keyword">val</span> dslContext = DSL.using(<br>    SQLDialect.MYSQL,<br>    Settings()<br>        <span class="hljs-comment">// SQLæ¸²æŸ“åº“åã€‚ç¦ç”¨åº“å</span><br>        .withRenderSchema(<span class="hljs-literal">false</span>)<br>        <span class="hljs-comment">// SQLæ¸²æŸ“è¡¨åã€‚å½“å­—æ®µä¸æ˜ç¡®ï¼Œå†æ·»åŠ è¡¨å</span><br>        .withRenderTable(RenderTable.WHEN_AMBIGUOUS_COLUMNS)<br>)<br>        <br><span class="hljs-comment">// æŸ¥è¯¢sql</span><br><span class="hljs-keyword">val</span> select = dslContext<br>    .select()<br>    .from(User.USER)<br>    .<span class="hljs-keyword">where</span>()<br>    <span class="hljs-comment">// å¯ä»¥æ·»åŠ æ›´å¤šæŸ¥è¯¢æ¡ä»¶</span><br>    .limit(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)<br><br><span class="hljs-comment">// æ¸²æŸ“sql</span><br><span class="hljs-keyword">val</span> sql0 = dslContext.render(select)<br><span class="hljs-keyword">val</span> sql1 = dslContext.renderInlined(select)<br><br><br><span class="hljs-comment">// record æ˜ å°„</span><br><span class="hljs-keyword">val</span> userRecord = dslContext.newRecord(User.USER)<br><span class="hljs-comment">// map to record</span><br>userRecord.from(mapOf(<span class="hljs-string">&quot;id&quot;</span> to <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span> to <span class="hljs-string">&quot;name&quot;</span>))<br><span class="hljs-comment">// record to map</span><br><span class="hljs-keyword">val</span> map = userRecord.intoMap()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JOOQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JOOQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ Gradle Kotlin DSL é…ç½® jOOQ ä»£ç ç”Ÿæˆï¼ˆQuarkus &amp; Kotlinï¼‰</title>
    <link href="/2025/10/16/jooq/Gradle%20Kotlin%20%E9%85%8D%E7%BD%AE%20JOOQ%20%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/"/>
    <url>/2025/10/16/jooq/Gradle%20Kotlin%20%E9%85%8D%E7%BD%AE%20JOOQ%20%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ¬æ–‡æ¡£è®°å½•äº†åœ¨ä¸€ä¸ªåŸºäº <strong>Quarkus</strong> å’Œ <strong>Kotlin</strong> çš„é¡¹ç›®ä¸­ä½¿ç”¨ <strong>Gradle Kotlin DSL</strong> é…ç½® **jOOQ ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰**çš„æ­¥éª¤å’Œå…³é”®é…ç½®é¡¹ã€‚jOOQ ä»£ç ç”Ÿæˆèƒ½å¤Ÿå°†æ•°æ®åº“ Schema è½¬æ¢ä¸ºç±»å‹å®‰å…¨çš„ Kotlin&#x2F;Java ä»£ç ï¼Œæå¤§åœ°æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚</p><h2 id="1-æ ¸å¿ƒä¾èµ–å’Œæ’ä»¶é…ç½®"><a href="#1-æ ¸å¿ƒä¾èµ–å’Œæ’ä»¶é…ç½®" class="headerlink" title="1. æ ¸å¿ƒä¾èµ–å’Œæ’ä»¶é…ç½®"></a>1. æ ¸å¿ƒä¾èµ–å’Œæ’ä»¶é…ç½®</h2><p>åœ¨ <code>build.gradle.kts</code> æ–‡ä»¶ä¸­ï¼Œéœ€è¦å¼•å…¥ jOOQ Gradle æ’ä»¶ã€Quarkus ä¾èµ–ä»¥åŠ jOOQ Codegen æ‰€éœ€çš„ JDBC é©±åŠ¨ã€‚</p><h3 id="1-1-æ’ä»¶"><a href="#1-1-æ’ä»¶" class="headerlink" title="1.1 æ’ä»¶"></a>1.1 æ’ä»¶</h3><p>Kotlin</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">plugins</span> &#123;<br>    kotlin(<span class="hljs-string">&quot;jvm&quot;</span>) version <span class="hljs-string">&quot;2.2.20&quot;</span><br>    <span class="hljs-built_in">id</span>(<span class="hljs-string">&quot;io.quarkus&quot;</span>)<br><br>    <span class="hljs-comment">// jOOQ Codegen Gradle æ’ä»¶ã€‚gradlePluginPortal() æŸ¥ä¸åˆ°ï¼Œå¯èƒ½å‘å¸ƒåˆ° mavenCentral()</span><br>    <span class="hljs-built_in">id</span>(<span class="hljs-string">&quot;org.jooq.jooq-codegen-gradle&quot;</span>) version <span class="hljs-string">&quot;3.19.23&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-2-ä¾èµ–é…ç½®"><a href="#1-2-ä¾èµ–é…ç½®" class="headerlink" title="1.2 ä¾èµ–é…ç½®"></a>1.2 ä¾èµ–é…ç½®</h3><p><strong>å…³é”®ç‚¹ï¼š</strong> jOOQ ä»£ç ç”Ÿæˆæ‰€éœ€çš„ä¾èµ–ï¼ˆ<code>jooq-codegen</code> å’Œ JDBC é©±åŠ¨ï¼‰éœ€è¦æ·»åŠ åˆ° <code>jooqCodegen</code> é…ç½®ä¸­ï¼Œè€Œä¸æ˜¯å¸¸è§„çš„ <code>implementation</code>ã€‚</p><p>Kotlin</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs scss">dependencies &#123;<br>    <span class="hljs-comment">// ... Quarkus è¿è¡Œä¾èµ–ï¼Œç”Ÿæˆå¯ä¸æ·»åŠ  ...</span><br>    <span class="hljs-built_in">implementation</span>(&quot;io.quarkus:quarkus-jdbc-mysql&quot;)<br>    <span class="hljs-built_in">implementation</span>(&quot;io.quarkiverse.jooq:quarkus-jooq:<span class="hljs-number">2.1</span>.<span class="hljs-number">0</span>&quot;) <span class="hljs-comment">// Quarkus jOOQ é›†æˆ</span><br><br>    <span class="hljs-comment">// ----------------------------------------------------</span><br>    <span class="hljs-comment">// jOOQ ä»£ç ç”Ÿæˆ (Codegen) ä¾èµ–</span><br>    <span class="hljs-comment">// ----------------------------------------------------</span><br>    <span class="hljs-built_in">jooqCodegen</span>(&quot;org.jooq:jooq-codegen:<span class="hljs-number">3.19</span>.<span class="hljs-number">23</span>&quot;)<br>    <span class="hljs-built_in">jooqCodegen</span>(&quot;org.jooq:jooq-meta:<span class="hljs-number">3.19</span>.<span class="hljs-number">23</span>&quot;)<br>    <span class="hljs-comment">// **å…³é”®ï¼šç”¨äºä»£ç ç”Ÿæˆçš„ MySQL JDBC é©±åŠ¨**</span><br>    <span class="hljs-built_in">jooqCodegen</span>(&quot;com.mysql:mysql-connector-j:<span class="hljs-number">8.3</span>.<span class="hljs-number">0</span>&quot;)<br>    <span class="hljs-comment">// ... å…¶ä»–ä¾èµ– ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-jOOQ-ä»£ç ç”Ÿæˆé…ç½®-jooq-å—"><a href="#2-jOOQ-ä»£ç ç”Ÿæˆé…ç½®-jooq-å—" class="headerlink" title="2. jOOQ ä»£ç ç”Ÿæˆé…ç½® (jooq å—)"></a>2. jOOQ ä»£ç ç”Ÿæˆé…ç½® (<code>jooq</code> å—)</h2><p>ä½¿ç”¨ <code>jooq</code> å—æ¥å®šä¹‰ä»£ç ç”Ÿæˆå™¨çš„è¯¦ç»†é…ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶ä¼šåˆ›å»ºä¸€ä¸ªåä¸º <code>jooqCodegenMain</code> çš„ä»»åŠ¡ã€‚</p><p>Kotlin</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">jooq</span> &#123;<br>    <span class="hljs-keyword">configuration</span> &#123;<br>        <span class="hljs-comment">// JDBC è¿æ¥é…ç½®</span><br>        <span class="hljs-keyword">jdbc</span> &#123;<br>            driver <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><br>            <span class="hljs-comment">// æ³¨æ„ï¼šå®Œæ•´çš„è¿æ¥ URLï¼ŒåŒ…å«å¿…è¦çš„æ—¶åŒºå’Œç¼–ç å‚æ•°</span><br>            url <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:mysql://localhost:4407/dev-xxx?useUnicode=true&amp;characterEncoding=UTF-8&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=Asia/Shanghai&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&quot;</span><br>            user <span class="hljs-operator">=</span> <span class="hljs-string">&quot;root&quot;</span><br>            password <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span><br>        &#125;<br><br>        <span class="hljs-comment">// ä»£ç ç”Ÿæˆå™¨é…ç½®</span><br>        <span class="hljs-keyword">generator</span> &#123;<br>            <span class="hljs-comment">// **å…³é”®ï¼šä½¿ç”¨ KotlinGenerator æ¥ç”Ÿæˆ Kotlin ä»£ç **</span><br>            name <span class="hljs-operator">=</span> <span class="hljs-string">&quot;org.jooq.codegen.KotlinGenerator&quot;</span><br><br>            <span class="hljs-keyword">database</span> &#123;<br>                name <span class="hljs-operator">=</span> <span class="hljs-string">&quot;org.jooq.meta.mysql.MySQLDatabase&quot;</span><br>                <br>                <span class="hljs-comment">// è¦ç”Ÿæˆä»£ç çš„æ¨¡å¼ (Schema)ã€‚MYSQL ä¸ºæ•°æ®åº“åç§°</span><br>                inputSchema <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dev-xxx&quot;</span><br>                <br>                <span class="hljs-comment">// åŒ…å«çš„è¡¨ã€è§†å›¾ç­‰å¯¹è±¡çš„æ­£åˆ™è¡¨è¾¾å¼ (.* è¡¨ç¤ºåŒ…å«æ‰€æœ‰)</span><br>                <span class="hljs-comment">//includes = &quot;.*&quot;</span><br>                includes <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user|account&quot;</span><br>                <br>                <span class="hljs-comment">// æ’é™¤çš„å¯¹è±¡ï¼Œå¯é€‰</span><br>                excludes <span class="hljs-operator">=</span> <span class="hljs-string">&quot;flyway_schema_history&quot;</span><br>                <br>                <span class="hljs-comment">// å¯é€‰ï¼šå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚å°†æ•°æ®åº“çš„ JSONB åˆ—è½¬æ¢ä¸º Java çš„ String æˆ–è‡ªå®šä¹‰ç±»å‹</span><br>                <span class="hljs-comment">// forcedTypes &#123;</span><br>                <span class="hljs-comment">//     forcedType &#123;</span><br>                <span class="hljs-comment">//         name = &quot;json&quot;</span><br>                <span class="hljs-comment">//         includeTypes = &quot;JSONB?&quot;</span><br>                <span class="hljs-comment">//         userType = &quot;java.lang.String&quot;</span><br>                <span class="hljs-comment">//     &#125;</span><br>                <span class="hljs-comment">// &#125;</span><br><br>                <span class="hljs-comment">// å¯é€‰ï¼šç¦ç”¨ jOOQ å¯¹æ‰€æœ‰æ— ç¬¦å·æ•´æ•°çš„ç‰¹æ®Šå¤„ç†</span><br>                <span class="hljs-comment">// å¦‚æœè®¾ç½®ä¸º false, jOOQ ä¼šä½¿ç”¨ JDBC é»˜è®¤ç±»å‹ (é€šå¸¸æ˜¯ Long æˆ– Integer)</span><br>                <span class="hljs-comment">// æ¨èåŒæ—¶ä½¿ç”¨ forcedTypes æ¥ç¡®ä¿ç±»å‹çš„ä¸€è‡´æ€§</span><br>                unsignedTypes <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>            &#125;<br><br>            <span class="hljs-comment">// ç”Ÿæˆå†…å®¹é…ç½® (Generate)ï¼ˆé€‰é…ï¼‰</span><br>            <span class="hljs-keyword">generate</span> &#123;<br>                <span class="hljs-comment">// å¯ç”¨ç”Ÿæˆ Kotlin æ•°æ®ç±»ä½œä¸º POJO</span><br>                isPojos <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>                isPojosAsKotlinDataClasses <span class="hljs-operator">=</span> <span class="hljs-literal">true</span> <br>                isPojosEqualsAndHashCode <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>                isPojosToString <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br><br>                <span class="hljs-comment">// ç”Ÿæˆ DAO ç±» (Data Access Objects)</span><br>                isDaos <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>                isSpringDao <span class="hljs-operator">=</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// å¯ç”¨ Spring/Quarkus å…¼å®¹çš„ DAO</span><br><br>                <span class="hljs-comment">// ç”Ÿæˆ jOOQ Record ç±»</span><br>                isRecords <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br><br>                <span class="hljs-comment">// æ·»åŠ æ³¨è§£ï¼Œå¦‚ @Generated, @NotNull</span><br>                isGeneratedAnnotation <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>                isNullableAnnotation <span class="hljs-operator">=</span> <span class="hljs-literal">true</span> <br>            &#125;<br>            <br>            <span class="hljs-comment">// ç›®æ ‡é…ç½® (Target)</span><br>            <span class="hljs-keyword">target</span> &#123;<br>                <span class="hljs-comment">// ç”Ÿæˆçš„ Java ç±»çš„åŒ…å</span><br>                packageName <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.example.jooq.generated&quot;</span><br>                <span class="hljs-comment">// ç”Ÿæˆçš„ä»£ç è¾“å‡ºç›®å½•</span><br>                directory <span class="hljs-operator">=</span> <span class="hljs-string">&quot;build/generated-src/jooq/main&quot;</span><br>            &#125;<br><br>            <span class="hljs-comment">// ç­–ç•¥é…ç½®ï¼Œå¯é€‰ï¼Œç”¨äºè‡ªå®šä¹‰ç±»åã€æ–¹æ³•åç­‰</span><br>            <span class="hljs-comment">//strategy &#123;</span><br>            <span class="hljs-comment">//    name = &quot;org.jooq.codegen.DefaultGeneratorStrategy&quot;</span><br>            <span class="hljs-comment">//&#125;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-æºç é›†å’Œä»»åŠ¡ä¾èµ–é…ç½®"><a href="#3-æºç é›†å’Œä»»åŠ¡ä¾èµ–é…ç½®" class="headerlink" title="3. æºç é›†å’Œä»»åŠ¡ä¾èµ–é…ç½®"></a>3. æºç é›†å’Œä»»åŠ¡ä¾èµ–é…ç½®</h2><p>ç”Ÿæˆçš„ä»£ç å¿…é¡»è¢« Gradle è¯†åˆ«å¹¶åŠ å…¥åˆ°ç¼–è¯‘è·¯å¾„ä¸­ã€‚åŒæ—¶ï¼Œè¦ç¡®ä¿ä»£ç ç”Ÿæˆä»»åŠ¡åœ¨ç¼–è¯‘ä¹‹å‰è¿è¡Œã€‚</p><h3 id="3-1-æ·»åŠ æºç ç›®å½•"><a href="#3-1-æ·»åŠ æºç ç›®å½•" class="headerlink" title="3.1 æ·»åŠ æºç ç›®å½•"></a>3.1 æ·»åŠ æºç ç›®å½•</h3><p>å°† jOOQ ç”Ÿæˆçš„ç›®å½•æ·»åŠ åˆ° <code>main</code> æºç é›†çš„ Kotlin è·¯å¾„ã€‚</p><p>Kotlin</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">sourceSets</span> &#123;<br>    <span class="hljs-keyword">main</span> &#123;<br>        <span class="hljs-keyword">kotlin</span> &#123;<br>            <span class="hljs-comment">// å°†ç”Ÿæˆçš„ä»£ç è¾“å‡ºç›®å½•æ·»åŠ åˆ° Source Set</span><br>            srcDir(<span class="hljs-string">&quot;build/generated-src/jooq/main&quot;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-2-ä»»åŠ¡ä¾èµ–"><a href="#3-2-ä»»åŠ¡ä¾èµ–" class="headerlink" title="3.2 ä»»åŠ¡ä¾èµ–"></a>3.2 ä»»åŠ¡ä¾èµ–</h3><p>ç¡®ä¿åœ¨ Kotlin ç¼–è¯‘ (<code>KotlinCompile</code>) å’Œ Quarkus æ„å»º (<code>quarkusBuild</code>) ä¹‹å‰ï¼Œå¼ºåˆ¶è¿è¡Œ jOOQ ä»£ç ç”Ÿæˆä»»åŠ¡ï¼ˆé»˜è®¤ä»»åŠ¡åä¸º <code>jooqCodegen</code> æˆ– <code>jooqCodegenMain</code>ï¼‰ã€‚</p><p>Kotlin</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable"><span class="hljs-class">tasks</span>.withType</span>&lt;<span class="hljs-variable">KotlinCompile</span>&gt;().configureEach &#123;<br>    <span class="hljs-comment">// ç¡®ä¿ç¼–è¯‘å‰ jOOQ ä»£ç å·²ç”Ÿæˆ</span><br>    <span class="hljs-function"><span class="hljs-title">dependsOn</span>(<span class="hljs-variable"><span class="hljs-class">tasks</span>.named</span>(<span class="hljs-string">&quot;jooqCodegen&quot;</span>))</span><br>&#125;<br><br><span class="hljs-variable"><span class="hljs-class">tasks</span>.named</span>(<span class="hljs-string">&quot;quarkusBuild&quot;</span>) &#123;<br>    <span class="hljs-comment">// ç¡®ä¿æ„å»ºå‰ jOOQ ä»£ç å·²ç”Ÿæˆ</span><br>    <span class="hljs-function"><span class="hljs-title">dependsOn</span>(<span class="hljs-variable"><span class="hljs-class">tasks</span>.named</span>(<span class="hljs-string">&quot;jooqCodegen&quot;</span>))</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-è¿è¡Œä»£ç ç”Ÿæˆ"><a href="#4-è¿è¡Œä»£ç ç”Ÿæˆ" class="headerlink" title="4. è¿è¡Œä»£ç ç”Ÿæˆ"></a>4. è¿è¡Œä»£ç ç”Ÿæˆ</h2><p>é…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ Gradle ä»»åŠ¡æ¥æ‰§è¡Œä»£ç ç”Ÿæˆï¼š</p><p>Bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">./gradlew jooqCodegen<br><span class="hljs-comment"># æˆ–</span><br>./gradlew jooqCodegenMain<br></code></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸåï¼Œç”Ÿæˆçš„ Kotlin ä»£ç ï¼ˆåŒ…æ‹¬ Records, POJOs, DAOs, Tables ç­‰ï¼‰å°†ä½äº <code>build/generated-src/jooq/main</code> ç›®å½•ä¸‹ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.jooq.org/doc/latest/manual/code-generation/codegen-execution/codegen-gradle/">JOOQ - Running the code generator with Gradle</a></p>]]></content>
    
    
    <categories>
      
      <category>JOOQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Gradle</tag>
      
      <tag>Kotlin</tag>
      
      <tag>Quarkus</tag>
      
      <tag>JOOQ</tag>
      
      <tag>ä»£ç ç”Ÿæˆ</tag>
      
      <tag>codegen</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰¹é‡æ“ä½œæ€§èƒ½ä¼˜åŒ– rewriteBatchedStatements ç‰¹æ€§</title>
    <link href="/2022/03/28/database/%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%9ArewriteBatchedStatements%20%E7%89%B9%E6%80%A7/"/>
    <url>/2022/03/28/database/%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%9ArewriteBatchedStatements%20%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="JDBC-æ‰¹é‡æ“ä½œæ€§èƒ½ä¼˜åŒ–-rewriteBatchedStatements-ç‰¹æ€§æ€»ç»“"><a href="#JDBC-æ‰¹é‡æ“ä½œæ€§èƒ½ä¼˜åŒ–-rewriteBatchedStatements-ç‰¹æ€§æ€»ç»“" class="headerlink" title="JDBC æ‰¹é‡æ“ä½œæ€§èƒ½ä¼˜åŒ– rewriteBatchedStatements ç‰¹æ€§æ€»ç»“"></a>JDBC æ‰¹é‡æ“ä½œæ€§èƒ½ä¼˜åŒ– rewriteBatchedStatements ç‰¹æ€§æ€»ç»“</h1><p><code>rewriteBatchedStatements</code> æ˜¯ $ \text{MySQL} $ $ \text{JDBC} $ é©±åŠ¨ ($ \text{Connector&#x2F;J} $) æä¾›çš„ä¸€ä¸ª<strong>éæ ‡å‡†</strong>ä½†æå…¶é‡è¦çš„è¿æ¥å‚æ•°ã€‚å®ƒé€šè¿‡åœ¨åº”ç”¨å±‚é‡å†™ $ \text{SQL} $ è¯­å¥ï¼Œæ¥æ˜¾è‘—å‡å°‘ç½‘ç»œå¾€è¿”å’Œæ•°æ®åº“ç«¯çš„ $ \text{SQL} $ è§£ææ¬¡æ•°ï¼Œä»è€Œå¤§å¹…æé«˜æ‰¹é‡ $ \text{DML} $ æ“ä½œçš„æ€§èƒ½ã€‚</p><h3 id="ä¸€ã€æ ¸å¿ƒä½œç”¨åŸç†ï¼šå‡å°‘ç½‘ç»œå¾€è¿”å’Œ-text-SQL-æ‰§è¡Œæ¬¡æ•°"><a href="#ä¸€ã€æ ¸å¿ƒä½œç”¨åŸç†ï¼šå‡å°‘ç½‘ç»œå¾€è¿”å’Œ-text-SQL-æ‰§è¡Œæ¬¡æ•°" class="headerlink" title="ä¸€ã€æ ¸å¿ƒä½œç”¨åŸç†ï¼šå‡å°‘ç½‘ç»œå¾€è¿”å’Œ $ \text{SQL} $ æ‰§è¡Œæ¬¡æ•°"></a>ä¸€ã€æ ¸å¿ƒä½œç”¨åŸç†ï¼šå‡å°‘ç½‘ç»œå¾€è¿”å’Œ $ \text{SQL} $ æ‰§è¡Œæ¬¡æ•°</h3><p>åœ¨é»˜è®¤ $ \text{JDBC} $ æ‰¹å¤„ç†ä¸­ï¼Œå³ä½¿ä½¿ç”¨äº† <code>addBatch()</code> å’Œ <code>executeBatch()</code>ï¼Œæ•°æ®åº“æœåŠ¡å™¨ä»å¯èƒ½å°† $ N $ æ¡è¯­å¥è§†ä¸º $ N $ ä¸ªç‹¬ç«‹çš„æ‰§è¡Œè¯·æ±‚ã€‚å¯ç”¨ <code>rewriteBatchedStatements=true</code> åï¼Œé©±åŠ¨ç¨‹åºä¼šè¿›è¡Œä»¥ä¸‹ä¼˜åŒ–ï¼š</p><h4 id="1-å¯¹-text-INSERT-è¯­å¥çš„ä¼˜åŒ–ï¼ˆæ•ˆæœæœ€ä½³ï¼‰"><a href="#1-å¯¹-text-INSERT-è¯­å¥çš„ä¼˜åŒ–ï¼ˆæ•ˆæœæœ€ä½³ï¼‰" class="headerlink" title="1. å¯¹ $ \text{INSERT} $ è¯­å¥çš„ä¼˜åŒ–ï¼ˆæ•ˆæœæœ€ä½³ï¼‰"></a>1. å¯¹ $ \text{INSERT} $ è¯­å¥çš„ä¼˜åŒ–ï¼ˆæ•ˆæœæœ€ä½³ï¼‰</h4><p>è¿™æ˜¯è¯¥ç‰¹æ€§çš„<strong>æœ€å¤§ä¼˜åŠ¿</strong>ã€‚é©±åŠ¨ç¨‹åºä¼šå°†å¤šæ¡ç‹¬ç«‹çš„ $ \text{INSERT} $ è¯­å¥é‡å†™æˆä¸€æ¡åŒ…å«å¤šç»„ <code>VALUES</code> çš„<strong>å•æ¡ <strong>$ \text{SQL} $</strong> è¯­å¥</strong>ã€‚</p><table><thead><tr><th align="left">å®¢æˆ·ç«¯ $ \text{Batch} $ ä»£ç ï¼ˆé€»è¾‘ä¸Šï¼‰</th><th align="left">å¼€å¯é‡å†™åæ•°æ®åº“å®é™…æ¥æ”¶çš„ $ \text{SQL} $</th><th align="left">æ€§èƒ½æå‡æ¥æº</th></tr></thead><tbody><tr><td align="left"><code>INSERT INTO T VALUES(?);</code> ($ \times N $)</td><td align="left"><code>INSERT INTO T VALUES(?), (?), (?), ...;</code> (ä¸€æ¡ $ \text{SQL} $ è¯­å¥)</td><td align="left"><strong>æé«˜ã€‚</strong> æ•°æ®åº“åªéœ€<strong>è§£æå’Œæ‰§è¡Œä¸€æ¬¡</strong>ï¼Œæ•ˆç‡æ˜¯é»˜è®¤æ‰¹å¤„ç†çš„æ•°å€ã€‚</td></tr></tbody></table><h4 id="2-å¯¹-text-UPDATE-å’Œ-text-DELETE-è¯­å¥çš„ä¼˜åŒ–"><a href="#2-å¯¹-text-UPDATE-å’Œ-text-DELETE-è¯­å¥çš„ä¼˜åŒ–" class="headerlink" title="2. å¯¹ $ \text{UPDATE} $ å’Œ $ \text{DELETE} $ è¯­å¥çš„ä¼˜åŒ–"></a>2. å¯¹ $ \text{UPDATE} $ å’Œ $ \text{DELETE} $ è¯­å¥çš„ä¼˜åŒ–</h4><p>é©±åŠ¨ç¨‹åºé€šå¸¸<strong>ä¸ä¼š</strong>å¯¹ $ \text{UPDATE} $ å’Œ $ \text{DELETE} $ è¯­å¥è¿›è¡Œå¤šå€¼è¯­å¥é‡å†™ã€‚ä½†å®ƒä¼šé€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š</p><ul><li><strong>å¤šæŸ¥è¯¢åˆå¹¶ï¼ˆ</strong>$ \text{Multi-Query} $<strong>ï¼‰ï¼š</strong> é©±åŠ¨ç¨‹åºå°† $ N $ æ¡ $ \text{UPDATE} $ æˆ– $ \text{DELETE} $ è¯­å¥ç”¨åˆ†å·ï¼ˆ<code>;</code>ï¼‰è¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ª<strong>å¤šæŸ¥è¯¢å­—ç¬¦ä¸²</strong>ï¼Œåœ¨å•æ¬¡ç½‘ç»œå¾€è¿”ä¸­å‘é€ç»™æ•°æ®åº“ã€‚</li><li><strong>æ€§èƒ½æå‡ï¼š</strong> æå‡ä¸»è¦æ¥è‡ªå°† $ N $ æ¬¡ç½‘ç»œå¾€è¿”ï¼ˆ$ \text{Round Trips} $ï¼‰å‡å°‘åˆ° $ 1 $ æ¬¡ï¼ˆæˆ–å°‘æ•°å‡ æ¬¡ï¼‰ã€‚æ•°æ®åº“ç«¯ä»ç„¶ä¼šä¾æ¬¡æ‰§è¡Œ $ N $ æ¡è¯­å¥ã€‚</li></ul><h3 id="äºŒã€ä½¿ç”¨æ³¨æ„äº‹é¡¹å’Œæ½œåœ¨é£é™©"><a href="#äºŒã€ä½¿ç”¨æ³¨æ„äº‹é¡¹å’Œæ½œåœ¨é£é™©" class="headerlink" title="äºŒã€ä½¿ç”¨æ³¨æ„äº‹é¡¹å’Œæ½œåœ¨é£é™©"></a>äºŒã€ä½¿ç”¨æ³¨æ„äº‹é¡¹å’Œæ½œåœ¨é£é™©</h3><table><thead><tr><th align="left">æ–¹é¢</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><strong>æ¨èæ€§</strong></td><td align="left"><strong>å¼ºçƒˆæ¨è</strong>åœ¨æ‰€æœ‰æ‰¹é‡ $ \text{INSERT} $ã€$ \text{UPDATE} $ å’Œ $ \text{DELETE} $ åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</td></tr><tr><td align="left"><strong>é”™è¯¯å¤„ç†</strong></td><td align="left">å¯ç”¨è¯¥ç‰¹æ€§åï¼Œæ‰¹å¤„ç†ä¸­çš„ä»»ä½•ä¸€æ¡ $ \text{SQL} $ å¤±è´¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´<strong>åç»­çš„è¯­å¥å…¨éƒ¨åœæ­¢æ‰§è¡Œ</strong>ã€‚ $ \text{executeBatch()} $ è¿”å›çš„å—å½±å“è¡Œæ•°æ•°ç»„å¯èƒ½ä¸ç²¾ç¡®ã€‚</td></tr><tr><td align="left"><code>Statement</code></td><td align="left">è™½ç„¶å¯¹ <code>Statement</code> å¯¹è±¡ä¹Ÿæœ‰æ•ˆï¼Œä½†å¯èƒ½ä¼šå¼•å…¥ $ \text{SQL} $ æ³¨å…¥é£é™©ã€‚<strong>æ¨èæ­é… <strong>$ \text{PreparedStatement} $</strong> ä½¿ç”¨ã€‚</strong></td></tr><tr><td align="left"><strong>æœ€ä½³å®è·µ</strong></td><td align="left"><strong>å¯¹äºæ‰¹é‡ <strong>$ \text{DELETE} $</strong>ï¼š</strong> æ‰‹åŠ¨å°†å¤šä¸ª $ \text{ID} $ åˆå¹¶æˆä¸€æ¡å¸¦æœ‰ $ \text{IN} $ å­å¥çš„ $ \text{SQL} $ è¯­å¥ï¼Œæ€§èƒ½é€šå¸¸æ¯”ä¾èµ– <code>rewriteBatchedStatements</code> æ›´é«˜ã€‚</td></tr></tbody></table><h3 id="ä¸‰ã€ä¸»æµæ•°æ®åº“å¯¹æ‰¹é‡æ“ä½œçš„æ”¯æŒæ¦‚è§ˆ"><a href="#ä¸‰ã€ä¸»æµæ•°æ®åº“å¯¹æ‰¹é‡æ“ä½œçš„æ”¯æŒæ¦‚è§ˆ" class="headerlink" title="ä¸‰ã€ä¸»æµæ•°æ®åº“å¯¹æ‰¹é‡æ“ä½œçš„æ”¯æŒæ¦‚è§ˆ"></a>ä¸‰ã€ä¸»æµæ•°æ®åº“å¯¹æ‰¹é‡æ“ä½œçš„æ”¯æŒæ¦‚è§ˆ</h3><table><thead><tr><th align="left">æ•°æ®åº“</th><th align="left">$ \text{JDBC} $ æ‰¹é‡ä¼˜åŒ–æœºåˆ¶</th><th align="left">æ˜¯å¦æœ‰ç±»ä¼¼ $ \text{rewriteBatchedStatements} $ çš„é©±åŠ¨å‚æ•°</th></tr></thead><tbody><tr><td align="left">$ \text{MySQL} $</td><td align="left">$ \text{JDBC} $ æ‰¹å¤„ç† + $ \text{SQL} $ é‡å†™</td><td align="left"><strong>æœ‰ï¼š</strong> <code>rewriteBatchedStatements=true</code></td></tr><tr><td align="left">$ \text{PostgreSQL} $</td><td align="left">$ \text{JDBC} $ æ‰¹å¤„ç† + $ \text{Extended Query Protocol} $</td><td align="left"><strong>æœ‰ï¼š</strong> <code>reWriteBatchedInserts=true</code></td></tr><tr><td align="left">$ \text{Oracle} $</td><td align="left">$ \text{JDBC} $ æ‰¹å¤„ç†ï¼ˆæ ‡å‡†ï¼‰</td><td align="left"><strong>æ— ã€‚</strong> ä¾èµ– $ \text{JDBC} $ æ ‡å‡†æ‰¹å¤„ç†ï¼Œé©±åŠ¨å†…éƒ¨è¿›è¡Œé«˜æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚</td></tr><tr><td align="left">$ \text{SQL Server} $</td><td align="left">$ \text{JDBC} $ æ‰¹å¤„ç†ï¼ˆæ ‡å‡†ï¼‰</td><td align="left"><strong>æ— ã€‚</strong> å¯ä½¿ç”¨ $ \text{Bulk Copy} $ æœºåˆ¶è¿›è¡Œé«˜æ•ˆæ‰¹é‡å¯¼å…¥ã€‚</td></tr></tbody></table><p><strong>æ€»ç»“ï¼š</strong></p><p><code>rewriteBatchedStatements</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä¼˜åŒ–å·¥å…·ï¼Œå°¤å…¶å¯¹äº $ \text{MySQL} $ çš„æ‰¹é‡ $ \text{INSERT} $ æ€§èƒ½æå‡æ˜¯é©å‘½æ€§çš„ã€‚åœ¨é…ç½® $ \text{JDBC} $ è¿æ¥æ—¶ï¼Œåº”å½“å§‹ç»ˆè€ƒè™‘å¼€å¯æ­¤å‚æ•°ï¼ˆæˆ– $ \text{PostgreSQL} $ çš„ç±»ä¼¼å‚æ•°ï¼‰æ¥å……åˆ†åˆ©ç”¨æ‰¹å¤„ç†å¸¦æ¥çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>RDBMS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…³ç³»å‹æ•°æ®åº“</tag>
      
      <tag>RDBMS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®‰è£… Redis</title>
    <link href="/2019/10/03/docker/Docker-%E5%AE%89%E8%A3%85-Redis/"/>
    <url>/2019/10/03/docker/Docker-%E5%AE%89%E8%A3%85-Redis/</url>
    
    <content type="html"><![CDATA[<p>Docker å®‰è£… Redis æ•™ç¨‹</p><span id="more"></span><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>Centos 7 ï¼ŒSELinux å¯åŠ¨</p><p>Docker 19.03.1</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>å¯åŠ¨å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run \<br>-p 6379:6379 \<br>--name redis \<br>-d redis \<br>redis-server<br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰è·¯å¾„ï¼Œä¿å­˜æ•°æ®å’Œé…ç½®æ–‡ä»¶ï¼Œ<a href="../../static/redis/redis.conf">redis.conf</a> è¯·æå‰å¤åˆ¶åˆ° <code>/program/redis/conf</code>ï¼ˆæ³¨æ„ï¼š<code>$PWD</code>è¡¨ç¤ºå½“å‰ç›®å½•ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run \<br>-p 6379:6379 \<br>-v /program/redis/data:/data:Z \<br>-v /program/redis/conf:/usr/local/etc/redis:Z \<br>--name redis \<br>-d redis \<br>redis-server /usr/local/etc/redis/redis.conf<br></code></pre></td></tr></table></figure><p>é˜²ç«å¢™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --zone=public --add-port=6379/tcp --permanent<br>firewall-cmd --reload<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®‰è£… Nacos</title>
    <link href="/2019/09/18/docker/Docker-%E5%AE%89%E8%A3%85-Nacos/"/>
    <url>/2019/09/18/docker/Docker-%E5%AE%89%E8%A3%85-Nacos/</url>
    
    <content type="html"><![CDATA[<p><a href="https://nacos.io/zh-cn/">Nacos</a> æ˜¯é˜¿é‡Œçš„ä¸€ä¸ªå¼€æºä¸­é—´ä»¶ï¼Œç”¨äºæœåŠ¡çš„æ³¨å†Œä»¥åŠå‘ç°ï¼Œé…ç½®å’ŒæœåŠ¡ç®¡ç†ã€‚</p><span id="more"></span><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>CentOS release 7.4.1708</p><p>Docker 19.03.1</p><p>Docker Compose 1.24.1</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><ol><li><p>å®‰è£…<code>Git</code></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> git -y<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£… <code>Docker</code>ï¼Œ<a href="https://docs.docker.com/install/linux/docker-ce/centos/">å®˜ç½‘</a>ï¼Œ<a href="https://holylcd.gitee.io/2019/01/30/5fd50d278d504636b6d32603d5018429.html">ä¸ªäººæ•™ç¨‹</a></p></li><li><p>å…‹éš†é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> --depth 1 https://github.com/nacos-group/nacos-docker.git<br></code></pre></td></tr></table></figure></li><li><p>Standalone Derby</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose -f example/standalone-derby.yaml up<br></code></pre></td></tr></table></figure></li><li><p>Standalone Mysql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose -f example/standalone-mysql.yaml up<br></code></pre></td></tr></table></figure></li><li><p>Cluster</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose -f example/cluster-hostname.yaml up <br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢æœåŠ¡çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps -a<br></code></pre></td></tr></table></figure></li></ol><h1 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --zone=public --add-port=8848/tcp --permanent<br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://hub.docker.com/r/nacos/nacos-server">Nacos</a></p>]]></content>
    
    
    <categories>
      
      <category>Nacos</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring Cloud Alibaba</tag>
      
      <tag>Nacos</tag>
      
      <tag>Spring Cloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¿®æ”¹SSHç«¯å£ ç¦ç”¨rootç™»å½•</title>
    <link href="/2019/09/17/linux/centos/%E4%BF%AE%E6%94%B9SSH%E7%AB%AF%E5%8F%A3-%E7%A6%81%E7%94%A8root%E7%99%BB%E5%BD%95/"/>
    <url>/2019/09/17/linux/centos/%E4%BF%AE%E6%94%B9SSH%E7%AB%AF%E5%8F%A3-%E7%A6%81%E7%94%A8root%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>Linux æ–°æœºä¿®æ”¹ SSH ç«¯å£ï¼Œç¦ç”¨ root ç™»å½•</p><span id="more"></span><h1 id="å¯ç”¨-SELinux"><a href="#å¯ç”¨-SELinux" class="headerlink" title="å¯ç”¨ SELinux"></a>å¯ç”¨ SELinux</h1><p>æ£€æŸ¥çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sestatus<br></code></pre></td></tr></table></figure><p>å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install selinux-policy-targeted<br></code></pre></td></tr></table></figure><p>å¼€å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/selinux/config<br>æˆ–<br>setenforce 1<br></code></pre></td></tr></table></figure><p>è®¾ç½®SELinuxä¸‹æ¬¡é‡å¯ä»ç„¶ä¿æŒå¼€å¯ï¼Œã€é‡è¦ã€‘å¦åˆ™æ— æ³•æ­£å¸¸å¯åŠ¨ç³»ç»Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> /.autorelabel<br></code></pre></td></tr></table></figure><p>é‡å¯</p><h1 id="ä¿®æ”¹SSHç«¯å£"><a href="#ä¿®æ”¹SSHç«¯å£" class="headerlink" title="ä¿®æ”¹SSHç«¯å£"></a>ä¿®æ”¹SSHç«¯å£</h1><p>ä¿®æ”¹ sshd é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/ssh/sshd_config<br></code></pre></td></tr></table></figure><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vhdl"><span class="hljs-keyword">Port</span> <span class="hljs-number">22</span> //æ—§ <span class="hljs-keyword">Port</span>ï¼Œå…ˆä¿ç•™ï¼Œé˜²æ­¢ç¿»è½¦å¯¼è‡´æ— æ³•è¿œç¨‹ç™»å½•<br><span class="hljs-keyword">Port</span> <span class="hljs-number">2222</span> //æ–° <span class="hljs-keyword">Port</span><br></code></pre></td></tr></table></figure><p>å¼€æ”¾ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨é˜²ç«å¢™</span><br>systemctl start firewalld<br><span class="hljs-comment"># æ·»åŠ å¼€æ”¾ç«¯å£</span><br>firewall-cmd --zone=public --add-port=2222/tcp --permanent<br><span class="hljs-comment"># é‡è½½ç«¯å£é…ç½®</span><br>firewall-cmd --reload<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ SSH ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">semanage port -l | grep ssh<br></code></pre></td></tr></table></figure><p>æ·»åŠ  SSH ç«¯å£ï¼Œä¹‹åå¯ä»¥å†æ¬¡æŸ¥çœ‹ç«¯å£ï¼Œç¡®è®¤æ˜¯å¦æ·»åŠ æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">semanage port -a -t ssh_port_t -p tcp 2222<br></code></pre></td></tr></table></figure><p>å¦‚æœå‡ºç° semanage command not foundï¼Œè¯·æ‰§è¡Œ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum provides /usr/sbin/semanage<br>æˆ–è€…<br>yum whatprovides /usr/sbin/semanage<br>yum -y install policycoreutils-python<br></code></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart sshd<br></code></pre></td></tr></table></figure><p>æ—§çš„è¿œç¨‹è¿æ¥ä¸ä¼šç¦»çº¿ï¼Œå¯ä»¥å…ˆä¿ç•™çª—å£ï¼Œæ–°å¼€çª—å£æµ‹è¯• SSH ç«¯å£æ˜¯å¦æ­£å¸¸</p><p>æœåŠ¡æ­£å¸¸ä¹‹åï¼Œå›å¤´æ³¨é‡Š <code>/etc/ssh/sshd_config</code> çš„ 22 Port</p><h1 id="ç¦ç”¨-root-è¿œç¨‹ç™»å½•"><a href="#ç¦ç”¨-root-è¿œç¨‹ç™»å½•" class="headerlink" title="ç¦ç”¨ root è¿œç¨‹ç™»å½•"></a>ç¦ç”¨ root è¿œç¨‹ç™»å½•</h1><p>ä¿®æ”¹é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/ssh/sshd_config<br></code></pre></td></tr></table></figure><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">#PermitRootLogin <span class="hljs-keyword">yes</span>  #å»æ‰æ³¨é‡Šï¼Œ<span class="hljs-keyword">yes</span>-å…è®¸ç™»å½•ï¼Œ<span class="hljs-keyword">no</span>-ä¸å…è®¸ç™»å½•<br></code></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart sshd<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CentOS</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CentOS</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Cache Rediså®ç° (Spring Boot + Redis)</title>
    <link href="/2019/09/12/spring-boot/Spring-Cache-Redis%E5%AE%9E%E7%8E%B0-Spring-Boot-Redis/"/>
    <url>/2019/09/12/spring-boot/Spring-Cache-Redis%E5%AE%9E%E7%8E%B0-Spring-Boot-Redis/</url>
    
    <content type="html"><![CDATA[<p>åŸºäºSpring Data Redisã€Spring Cacheå®ç°åç«¯ç¼“å­˜ï¼Œæé«˜å¹¶å‘ã€‚å¯å®ç° <code>@Cacheable</code>æœ‰æ•ˆæœŸã€å›ºå®šæ—¶é—´è¿‡æœŸã€‚</p><span id="more"></span><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>Spring Boot 2.1.7.RELEASE</p><h1 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h1><ol><li><p>å·²ç»å¼€å¯ Spring Cache</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableCaching</span><br></code></pre></td></tr></table></figure></li></ol><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><ol><li>è‡ªå®šä¹‰ redis ç¼“å­˜ç®¡ç†</li><li><code>@Cacheable</code> æŒ‡å®šç¼“å­˜ç®¡ç†</li></ol><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><ol><li><p>è‡ªå®šä¹‰ redis ç¼“å­˜ç®¡ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean(&quot;customCacheManager&quot;)</span><br>   <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">commonCacheManager</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;<br>       <span class="hljs-comment">// è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸ5åˆ†é’Ÿ</span><br>       <span class="hljs-type">RedisCacheConfiguration</span> <span class="hljs-variable">redisCacheConfiguration</span> <span class="hljs-operator">=</span> RedisCacheConfiguration<br>               .defaultCacheConfig()<br>               .entryTtl(Duration.ofMinutes(<span class="hljs-number">5L</span>));<br>       <span class="hljs-keyword">return</span> RedisCacheManager<br>               .builder(RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory))<br>               .cacheDefaults(redisCacheConfiguration).build();<br>   &#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@Cacheable</code> æŒ‡å®šç¼“å­˜ç®¡ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(</span><br><span class="hljs-meta">    value = &quot;redis:key:xxx&quot;,</span><br><span class="hljs-meta">    cacheManager = &quot;customCacheManager&quot;</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@RequestMapping(value = &quot;index&quot;, method = RequestMethod.GET)</span><br><span class="hljs-keyword">public</span> ResponseEntity&lt;IndexVO&gt; <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>    ...<br></code></pre></td></tr></table></figure></li><li><p>@CacheEvict ä¸»åŠ¨æ¸…ç†ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CacheEvict(</span><br><span class="hljs-meta">    value = &quot;redis:key:xxx&quot;,</span><br><span class="hljs-meta">    cacheManager = &quot;customCacheManager&quot;</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@RequestMapping(value = &quot;index/clear&quot;, method = RequestMethod.GET)</span><br><span class="hljs-keyword">public</span> ResponseEntity <span class="hljs-title function_">clearIndex</span><span class="hljs-params">()</span> &#123;<br>    ...<br></code></pre></td></tr></table></figure></li></ol><h1 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h1><p><a href="https://gitee.com/holylcd/spring-boot-quick">æ¡ˆä¾‹</a>è¿˜æœ‰å…¶ä»–é›†æˆï¼Œæœ¬ç« è¯»è€…å¯ä»¥ç›´æ¥é˜…è¯»ä¸€ä¸‹ä»£ç ï¼ˆè·ªæ±‚ Starâ€¦â€¦ï¼‰</p><ol><li><p>ç¼“å­˜ç®¡ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">org.holy.spring.boot.quick.config.redis.RedisConfig#commonCacheManager<br></code></pre></td></tr></table></figure></li><li><p>@Cacheableæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">org.holy.spring.boot.quick.controller.v1.IndexController#banner<br></code></pre></td></tr></table></figure></li><li><p>@CacheEvictæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">org.holy.spring.boot.quick.controller.v1.IndexController#clearBanner<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>Spring Boot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
      <tag>Spring Boot</tag>
      
      <tag>Cache</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¥å£æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ-å°å¹ºé¸¡</title>
    <link href="/2019/09/12/api-doc/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%B0%8F%E5%B9%BA%E9%B8%A1/"/>
    <url>/2019/09/12/api-doc/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%B0%8F%E5%B9%BA%E9%B8%A1/</url>
    
    <content type="html"><![CDATA[<p>å°å¹ºé¸¡åœ¨çº¿æ–‡æ¡£ç®¡ç†ï¼Œæ”¯æŒåœ¨çº¿æµ‹è¯•ï¼Œæ”¯æŒjson,txt,xml,html,js,æµ,å’Œ WebSocket</p><p>å‰åç«¯åˆ†ç¦»å¼€å‘ç¯å¢ƒä¸‹ï¼Œå‰ç«¯å¼€å‘äººå‘˜å’Œåç«¯å¼€å‘äººå‘˜ä¸»è¦é€šè¿‡æ¥å£æ–‡æ¡£å¯¹æ¥ï¼Œè§„èŒƒçš„ã€å¥½ç”¨çš„æ¥å£æ–‡æ¡£ç®¡ç†ç³»ç»Ÿèƒ½å¤Ÿå¤§å¤§æé«˜å¼€å‘äººå‘˜æ•ˆç‡ã€‚æœ¬ç« ä¸»è¦ä»‹ç»ã€Šå°å¹ºé¸¡åœ¨çº¿æ–‡æ¡£ç®¡ç†ã€‹ï¼Œæ”¯æŒåœ¨çº¿æµ‹è¯•ï¼Œæ”¯æŒjson,txt,xml,html,js,æµ,å’Œ WebSocketã€‚ä¸ªäººè§‰å¾—è¿™æ˜¯ä¸€æ¬¾éå¸¸æ£’çš„æ¥å£ç®¡ç†ç³»ç»Ÿã€‚ç³»ç»Ÿå¼€å‘è€…è¿˜æä¾›äº†ï¼Œè¯»è€…å¯ä»¥çœ‹ä¸‹æ•ˆæœå“¦<a href="http://www.xiaoyaoji.cn/doc/1n6N0lgsSmW">æ¼”ç¤ºç³»ç»Ÿ</a></p><span id="more"></span><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><ol><li>å¯è®¾ç½®ä¸åŒç¯å¢ƒï¼Œæ–¹ä¾¿åˆ‡æ¢å¼€å‘ã€æµ‹è¯•ç¯å¢ƒ</li><li>å¯è®¾ç½®å…¨å±€è¯·æ±‚å¤´ã€å“åº”å¤´ã€è¯·æ±‚ä½“ã€å“åº”ä½“ï¼Œæ»¡è¶³å¤šç§åœºæ™¯</li><li>å¯åœ¨çº¿æµ‹è¯•</li></ol><h1 id="æ­å»º"><a href="#æ­å»º" class="headerlink" title="æ­å»º"></a>æ­å»º</h1><p><strong>ç¯å¢ƒ</strong></p><p>Linux</p><p>Tomcat</p><p><strong>æ­å»º</strong></p><p>ä¸‹è½½æºç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://gitee.com/zhoujingjie/apiManager.git<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®åº“ï¼Œæ•°æ®åº“è„šæœ¬ä½äºé¡¹ç›® <code>./doc/xiaoyaoji.sql</code>ï¼Œè‡ªè¡Œå»ºåº“å³å¯</p><p>æ‰“åŒ…ï¼Œé¡¹ç›®è·Ÿç›®å½•æ‰§è¡ŒmavenæŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn package<br></code></pre></td></tr></table></figure><p>å¤åˆ¶ <code>xiaoyaoji-web/target/xiaoyaoji-2.1.7.war</code>è‡³tomcatæœåŠ¡å™¨<code>webapps</code>ç›®å½•ï¼Œæ”¹å <code>ROOT.war</code></p><p>è§£å‹ <code>ROOT.war</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -zxvf ./ROOT.war<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹æ•°æ®åº“é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim ./ROOT/WEB-INF/classes/platform.properties<br></code></pre></td></tr></table></figure><p>å¡«å†™æ­£ç¡®çš„æ•°æ®åº“åœ°å€ã€åç§°ã€ç™»å½•è´¦å·ã€å¯†ç å³å¯ï¼Œå…¶ä»–é…ç½®å¯åæœŸè‡ªè¡Œäº†è§£</p><p>å¯åŠ¨ Tomcatï¼Œä¸ºç®€å•è¯´æ˜é—®é¢˜ï¼Œè¿™é‡Œç›´æ¥å¯åŠ¨ Tomcatï¼Œå¯¹å¤–çº¿ä¸ŠæœåŠ¡è¯·ä¸è¦è¿™æ ·å¯åŠ¨é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sh ./bin/startup.sh<br></code></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆï¼</p><p><strong>Google chrome æ’ä»¶</strong></p><ol><li><p>å¯ç¿»å¢™çš„åŒå­¦ï¼Œç›´æ¥åˆ°åº”ç”¨å•†åº—å®‰è£…å³å¯ <code>å°å¹ºé¸¡</code></p></li><li><p>ä¸èƒ½ç¿»å¢™çš„åŒå­¦ï¼Œè¿™é‡Œæä¾›ä¸€ç§ç›®å‰ï¼ˆ2019&#x2F;09&#x2F;12ï¼‰å¯è¡Œçš„åŠæ³•</p><p>å¼€å‘è€…æä¾›çš„æ’ä»¶æºç ä½äºé¡¹ç›® <code>./æµè§ˆå™¨æ’ä»¶/</code></p><p>æ‰“å¼€ chrome-æ‹“å±•ç¨‹åºï¼Œå³ä¸Šè§’å¼€å¯å¼€å‘è€…æ¨¡å¼</p><p>åŠ è½½å·²è§£å‹çš„æ‹“å±•ç¨‹åºï¼Œé€‰æ‹©æ–‡ä»¶å¤¹ <code>./æµè§ˆå™¨æ’ä»¶</code>ï¼Œç°åœ¨å¯ä»¥çœ‹åˆ°æ’ä»¶å·²ç»æˆåŠŸåŠ è½½è‡³ chromeï¼</p></li></ol><p><strong>ä½¿ç”¨</strong></p><ol><li>å…¨éƒ¨è®¿å®¢éƒ½å¯ä»¥æ³¨å†Œè´¦å·</li><li>é‚£ä¸ªè´¦å·åˆ›å»ºçš„é¡¹ç›®ï¼Œåˆ›å»ºäººå³ç®¡ç†å‘˜ï¼Œå¯ä»¥å°†å…¶ä»–ç”¨æˆ·æ‹‰åˆ°é¡¹ç›®é‡Œ</li></ol>]]></content>
    
    
    <categories>
      
      <category>Doc</category>
      
      <category>API</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Doc</tag>
      
      <tag>API</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Boot éƒ¨ç½²</title>
    <link href="/2019/09/11/spring-boot/Spring-Boot-%E9%83%A8%E7%BD%B2-Linux-%E6%9C%8D%E5%8A%A1%E5%8C%96/"/>
    <url>/2019/09/11/spring-boot/Spring-Boot-%E9%83%A8%E7%BD%B2-Linux-%E6%9C%8D%E5%8A%A1%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>ç®€å•ä»‹ç»ä¸‰ç§Spring Bootåº”ç”¨çš„éƒ¨ç½²æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼šnohubã€Linux æœåŠ¡åŒ–ã€Dockerï¼Œnohubæ–¹å¼å’ŒLinuxæœåŠ¡åŒ–å»ºè®®ç”¨äºå•ä½“åº”ç”¨ï¼Œåˆ†å¸ƒå¼åº”ç”¨å»ºè®®ä½¿ç”¨ Dockerã€‚æ•™ç¨‹å»ºç«‹åœ¨Spring Bootå·²ç»å®Œæˆæ‰“åŒ…å¹¶ä¸”å¯ç”¨æƒ…å†µä¸‹ã€‚</p><span id="more"></span><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>CentOS 7ï¼ŒSELinuxå¼€å¯</p><p>Spring Bootåº”ç”¨ç¨‹åºï¼ˆè·¯å¾„ä¸º<code>/program/app.jar</code>ï¼‰</p><h1 id="nohubå¯åŠ¨"><a href="#nohubå¯åŠ¨" class="headerlink" title="nohubå¯åŠ¨"></a>nohubå¯åŠ¨</h1><p>ç›´æ¥å¯åŠ¨ï¼Œè¿™ç§æ–¹å¼å…¶å®å°±æ˜¯ <code>java -jar</code>ï¼Œåªæ˜¯é€šè¿‡ nohub ä½¿ç¨‹åºèƒ½å¤Ÿä»¥å®ˆæŠ¤è¿›ç¨‹ç»§ç»­è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">nohup</span> java -jar /program/app.jar &amp;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ç¨‹åºè¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps aux|grep report-0.0.1-SNAPSHOT.jar<br></code></pre></td></tr></table></figure><p>åœæ­¢ç¨‹åºè¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">kill</span> -9 xxxxä¸Šé¢æŸ¥è¯¢åˆ°çš„pid<br></code></pre></td></tr></table></figure><h1 id="Linux-æœåŠ¡åŒ–"><a href="#Linux-æœåŠ¡åŒ–" class="headerlink" title="Linux æœåŠ¡åŒ–"></a>Linux æœåŠ¡åŒ–</h1><p>ä¸º Spring Boot åº”ç”¨å»ºç«‹ä¸€ä¸ªç®€å•çš„ Linux æœåŠ¡</p><p>æ–°å¢æœåŠ¡æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/systemd/system/myapp.service<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘å†…å®¹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-comment">#æœåŠ¡æè¿°</span><br><span class="hljs-attr">Description</span>=My Spring Boot Application<br><span class="hljs-attr">After</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=forking<br><span class="hljs-attr">TimeoutStartSec</span>=<span class="hljs-number">0</span><br><span class="hljs-comment">#è¿™é‡Œæ”¹ä¸ºæœºå™¨çš„JVMè·¯å¾„</span><br><span class="hljs-attr">ExecStart</span>=/opt/jdk1.<span class="hljs-number">8.0</span>_191/bin/java -jar /program/app.jar<br><span class="hljs-attr">ExecStop</span>=/opt/jdk1.<span class="hljs-number">8.0</span>_191/bin/java -jar /program/app.jar<br><span class="hljs-comment">#è¿™é‡Œå¯ä»¥ä½¿ç”¨érootç”¨æˆ·ï¼Œè®°å¾—ç»™ç”¨åˆ°çš„è·¯å¾„æˆæƒå“¦</span><br><span class="hljs-comment">#User=root</span><br><span class="hljs-comment">#Group=root</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-comment">#å¤šç”¨æˆ·</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start myapp<br></code></pre></td></tr></table></figure><p>åœæ­¢æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl stop myapp<br></code></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart myapp<br></code></pre></td></tr></table></figure><p>è‡ªå¯æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> myapp<br></code></pre></td></tr></table></figure><p>å…³é—­è‡ªå¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">disable</span> myapp<br></code></pre></td></tr></table></figure><h1 id="Docker-éƒ¨ç½²"><a href="#Docker-éƒ¨ç½²" class="headerlink" title="Docker éƒ¨ç½²"></a>Docker éƒ¨ç½²</h1><ol><li><p><a href="https://holylcd.gitee.io/2019/01/30/5fd50d278d504636b6d32603d5018429.html">Docker å®‰è£…</a></p></li><li><p>å‡†å¤‡é•œåƒ</p><p>æ–°å»º Dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /program/Dockerfile<br></code></pre></td></tr></table></figure><p>è¾¹ç•Œ Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span>-jre-alpine<br><span class="hljs-keyword">VOLUME</span><span class="language-bash"> [<span class="hljs-string">&quot;/tmp&quot;</span>]</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/program/app.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>æ„å»ºé•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build -f ./Dockerfile -t myapp .<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ Spring Boot æœåŠ¡</p><p>ä¸ºäº†ç®€å•è¯´æ˜ Docker éƒ¨ç½²ï¼Œè¿™é‡Œå…ˆä½¿ç”¨ host ç½‘ç»œæ¨¡å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>--net=host \<br>--restart=unless-stopped \<br>--name myapp \<br>-v /etc/localtime:/etc/localtime \<br>-v /program/app.jar:/program/app.jar:ro \<br>myapp<br></code></pre></td></tr></table></figure><p>netï¼šç½‘ç»œæ¨¡å¼</p><p>restartï¼šé‡å¯ç­–ç•¥ã€‚unless-stoppedï¼ŒæœåŠ¡å¼‚å¸¸æ—¶æ€»æ˜¯é‡å¯ï¼Œé™¤éä¸»åŠ¨åœæ­¢</p><p>nameï¼šå®¹å™¨å</p><p>ç¬¬ä¸€ä¸ª-vï¼šåŒæ­¥ç‰©ç†æœºçš„æ—¶é—´è‡³å®¹å™¨</p><p>ç¬¬äºŒä¸ª-vï¼šæ˜ å°„ç‰©ç†æœºæ–‡ä»¶<code>/program/app.jar</code>è‡³å®¹å™¨<code>/program/app.jar</code></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>Spring Boot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>å¾®æœåŠ¡</tag>
      
      <tag>Spring Boot</tag>
      
      <tag>nohub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªé€‰ç»„ä»¶æ­å»ºé‚®ä»¶æœåŠ¡å™¨ CentOS</title>
    <link href="/2019/03/28/Roundcube-WebMail/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/"/>
    <url>/2019/03/28/Roundcube-WebMail/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/</url>
    
    <content type="html"><![CDATA[<p>è‡ªé€‰ç»„ä»¶æ­å»ºé‚®ä»¶æœåŠ¡å™¨ CentOS</p><span id="more"></span><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>CentOS 7</p><h1 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h1><p>Postfix</p><p>Dovecot</p><p>MySQL 5.7</p><p>OpenDKIM</p><p>Nginx</p><p>PHP</p><p>Roundcube WebMail</p><p>Policyd</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>ä»<a href="https://dev.mysql.com/downloads/mysql/">mysql</a>ä¸‹è½½ç¦»çº¿åŒ…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.25-1.el7.x86_64.rpm-bundle.tar<br></code></pre></td></tr></table></figure><p>è§£å‹åŒ…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -zxvf mysql-5.7.xx.rpm-bundle.tar<br></code></pre></td></tr></table></figure><p>åŒ…çš„ä½œç”¨</p><blockquote><p>mysql-community-clientï¼ˆ*å®¢æˆ·ç«¯ç¨‹åºå’Œå·¥å…·ï¼‰<br>mysql-community-serverï¼ˆ*æœåŠ¡å™¨ç¨‹åºå’Œå·¥å…·ï¼‰<br>mysql-community-libsï¼ˆ*LIBåº“ï¼‰<br>mysql-community-libs-compatï¼ˆ*LIBå…±äº«å…¼å®¹åº“ï¼‰<br>mysql-community-commonï¼ˆ*å…¬å…±æ–‡ä»¶ï¼‰<br>mysql-community-develï¼ˆå¼€å‘MySQLå¿…å¤‡çš„å¤´æ–‡ä»¶å’Œåº“ï¼‰<br>mysql-community-embeddedï¼ˆåµŒå…¥å¼åº“ï¼‰<br>mysql-community-embedded-compatï¼ˆåµŒå…¥å¼å…±äº«å…¼å®¹åº“ï¼‰<br>mysql-community-embedded-devï¼ˆåµŒå…¥å¼å¼€å‘åº“ï¼‰<br>mysql-community-testï¼ˆæµ‹è¯•å¥—ä»¶ï¼‰</p></blockquote><p>å®‰è£…éœ€è¦çš„åŒ…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install mysql-community-&#123;server,client,common,libs&#125;-*<br></code></pre></td></tr></table></figure><p>å®‰è£…ç”Ÿæˆæ–‡ä»¶</p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/mysql.jpg" alt="mysql.jpg"></p><p>å¯åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start mysqld<br></code></pre></td></tr></table></figure><p>è®¾ç½®rootå¯†ç </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /var/log/mysqld.log<br></code></pre></td></tr></table></figure><p>SET PASSWORD FOR â€˜rootâ€˜@â€™localhostâ€™ &#x3D; PASSWORD(â€˜123â€™);</p><p>SHOW VARIABLES LIKE â€˜validate_password%â€™;</p><p>validate_password_dictionary_file<br>æ’ä»¶ç”¨äºéªŒè¯å¯†ç å¼ºåº¦çš„å­—å…¸æ–‡ä»¶è·¯å¾„ã€‚</p><p>validate_password_length<br>å¯†ç æœ€å°é•¿åº¦ï¼Œå‚æ•°é»˜è®¤ä¸º8ï¼Œå®ƒæœ‰æœ€å°å€¼çš„é™åˆ¶ï¼Œæœ€å°å€¼ä¸ºï¼švalidate_password_number_count + validate_password_special_char_count + (2 * validate_password_mixed_case_count)</p><p>validate_password_mixed_case_count<br>å¯†ç è‡³å°‘è¦åŒ…å«çš„å°å†™å­—æ¯ä¸ªæ•°å’Œå¤§å†™å­—æ¯ä¸ªæ•°ã€‚</p><p>validate_password_number_count<br>å¯†ç è‡³å°‘è¦åŒ…å«çš„æ•°å­—ä¸ªæ•°ã€‚</p><p>validate_password_policy<br>å¯†ç å¼ºåº¦æ£€æŸ¥ç­‰çº§ï¼Œ0&#x2F;LOWã€1&#x2F;MEDIUMã€2&#x2F;STRONGã€‚æœ‰ä»¥ä¸‹å–å€¼ï¼š<br>Policy                 Tests Performed<br>0 or LOW               Length<br>1 or MEDIUM         Length; numeric, lowercase&#x2F;uppercase, and special characters<br>2 or STRONG        Length; numeric, lowercase&#x2F;uppercase, and special characters; dictionary file<br>é»˜è®¤æ˜¯1ï¼Œå³MEDIUMï¼Œæ‰€ä»¥åˆšå¼€å§‹è®¾ç½®çš„å¯†ç å¿…é¡»ç¬¦åˆé•¿åº¦ï¼Œä¸”å¿…é¡»å«æœ‰æ•°å­—ï¼Œå°å†™æˆ–å¤§å†™å­—æ¯ï¼Œç‰¹æ®Šå­—ç¬¦ã€‚</p><p>validate_password_special_char_count</p><p>å¯†ç è‡³å°‘è¦åŒ…å«çš„ç‰¹æ®Šå­—ç¬¦æ•°ã€‚</p><p>set global validate_password_policy&#x3D;0;</p><p>set global validate_password_mixed_case_count&#x3D;0;</p><p>set global validate_password_number_count&#x3D;3;</p><p>set global validate_password_special_char_count&#x3D;0;</p><p>set global validate_password_length&#x3D;3;</p><h2 id="åˆ›å»ºè™šæ‹Ÿæ•°æ®"><a href="#åˆ›å»ºè™šæ‹Ÿæ•°æ®" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿæ•°æ®"></a>åˆ›å»ºè™šæ‹Ÿæ•°æ®</h2><p>åˆ›å»ºç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE USER &#x27;mail_sys&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;mail_sys&#x27;;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE mail_sys;<br></code></pre></td></tr></table></figure><p>æˆæƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">GRANT SELECT ON mail_sys.* TO &#x27;mail_sys&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;mail_sys&#x27;;<br></code></pre></td></tr></table></figure><p>åˆ·æ–°æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure><p>åˆ‡æ¢æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">USE mail_sys;<br></code></pre></td></tr></table></figure><p>åŸŸåè¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE `domains` ( `id` int(20) NOT NULL auto_increment, `name` varchar(100) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br></code></pre></td></tr></table></figure><p>ç”¨æˆ·è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE `users` ( `id` int(20) NOT NULL auto_increment, `domain_id` int(20) NOT NULL, `password` varchar(200) NOT NULL, `email` varchar(200) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `email` (`email`), FOREIGN KEY (domain_id) REFERENCES domains(id) ON DELETE CASCADE ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br></code></pre></td></tr></table></figure><p>åˆ«åè¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE `aliases` ( `id` int(20) NOT NULL auto_increment, `domain_id` int(20) NOT NULL, `source` varchar(200) NOT NULL, `destination` varchar(200) NOT NULL, PRIMARY KEY (`id`), FOREIGN KEY (domain_id) REFERENCES domains(id) ON DELETE CASCADE ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br></code></pre></td></tr></table></figure><p>æ·»åŠ åŸŸå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO `mail_sys`.`domains` (`id` ,`name`) <br>VALUES (1, &#x27;example.com&#x27;);<br></code></pre></td></tr></table></figure><p>æ·»åŠ ç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO `mail_sys`.`users`<br>    (`id`, `domain_id`, `password` , `email`) VALUES<br>    (&#x27;1&#x27;, &#x27;1&#x27;, ENCRYPT(&#x27;123qwe&#x27;, CONCAT(&#x27;$6$&#x27;, SUBSTRING(SHA(RAND()), -16))), &#x27;admin@example.com&#x27;),<br>    (&#x27;2&#x27;, &#x27;1&#x27;, ENCRYPT(&#x27;123qwe&#x27;, CONCAT(&#x27;$6$&#x27;, SUBSTRING(SHA(RAND()), -16))), &#x27;user1@example.com&#x27;),<br>    (&#x27;3&#x27;, &#x27;1&#x27;, ENCRYPT(&#x27;123qwe&#x27;, CONCAT(&#x27;$6$&#x27;, SUBSTRING(SHA(RAND()), -16))), &#x27;user2@example.com&#x27;);<br></code></pre></td></tr></table></figure><p>æ·»åŠ åˆ«å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO `mail_sys`.`aliases`<br>    (`id`, `domain_id`, `source`, `destination`) VALUES<br>    (&#x27;1&#x27;, &#x27;1&#x27;, &#x27;admin1@example.com&#x27;, &#x27;admin@example.com&#x27;),<br>    (&#x27;2&#x27;, &#x27;1&#x27;, &#x27;user11@example.com&#x27;, &#x27;user1@example.com&#x27;),<br>    (&#x27;3&#x27;, &#x27;1&#x27;, &#x27;user22@example.com&#x27;, &#x27;user2@example.com&#x27;);<br></code></pre></td></tr></table></figure><p>æ£€æŸ¥æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM mail_sys.domains;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM mail_sys.users;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM mail_sys.aliases;<br></code></pre></td></tr></table></figure><h2 id="é‚®ä»¶ç³»ç»Ÿä¸“ç”¨ç”¨æˆ·"><a href="#é‚®ä»¶ç³»ç»Ÿä¸“ç”¨ç”¨æˆ·" class="headerlink" title="é‚®ä»¶ç³»ç»Ÿä¸“ç”¨ç”¨æˆ·"></a>é‚®ä»¶ç³»ç»Ÿä¸“ç”¨ç”¨æˆ·</h2><ol><li>æ‰€æœ‰çš„é‚®ä»¶ç”¨æˆ·éƒ½æ˜ å°„åˆ°ç³»ç»Ÿçš„åŒä¸€ä¸ªçœŸå®çš„ç”¨æˆ·ä¸Šã€‚</li><li>ä¸å»ºè®®ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ mail è´¦æˆ·ã€‚</li></ol><p>åˆ›å»ºä¸“ç”¨ç»„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">groupadd -g 2000 mail_sys<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸“ç”¨ç”¨æˆ·</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd -g mail_sys -u 2000 mail_sys -d /var/spool/mail -s /sbin/nologin<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é‚®ä»¶ç›®å½•æ‰€æœ‰è€…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chown</span> -R mail_sys:mail_sys /var/spool/mail<br></code></pre></td></tr></table></figure><h2 id="ç”Ÿæˆæ•°å­—ç­¾å"><a href="#ç”Ÿæˆæ•°å­—ç­¾å" class="headerlink" title="ç”Ÿæˆæ•°å­—ç­¾å"></a>ç”Ÿæˆæ•°å­—ç­¾å</h2><p>ç§é’¥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl genrsa -des3 -out privkey.pem 2048<br><br></code></pre></td></tr></table></figure><p>è‡ªç­¾è¯ä¹¦</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl req -new -x509 -key privkey.pem -out cacert.pem -days 1095<br><br></code></pre></td></tr></table></figure><h2 id="Postfix"><a href="#Postfix" class="headerlink" title="Postfix"></a>Postfix</h2><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install postfix<br><br></code></pre></td></tr></table></figure><h3 id="å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶"><a href="#å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶" class="headerlink" title="å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶"></a>å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> -r /etc/postfix /etc/postfix.bak<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-main-cf"><a href="#ä¿®æ”¹-main-cf" class="headerlink" title="ä¿®æ”¹ main.cf"></a>ä¿®æ”¹ main.cf</h3><p> è¯¥æ–‡ä»¶é…ç½® Postfix çš„å…¨å±€å‚æ•°ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/postfix/main.cf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>è¯·æŒ‰å®é™…æƒ…å†µä»¥åŠæ³¨é‡Šæç¤º<strong>ä¿®æ”¹ä»¥ä¸‹å†…å®¹</strong>ï¼Œå®Œæˆå»é™¤ # å·å’Œåé¢çš„æ³¨é‡Šï¼Œç„¶åç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh">myhostname = example.com<span class="hljs-comment">#æœ¬æœºåŸŸåï¼Œéœ€è¦ä¿®æ”¹</span><br>alias_maps = <span class="hljs-built_in">hash</span>:/etc/aliases<br>alias_database = <span class="hljs-built_in">hash</span>:/etc/aliases<br>myorigin = /etc/mailname<br>mydestination = localhost<br>relayhost =<br>mynetworks = 127.0.0.0/8<br>mailbox_size_limit = 0<br>recipient_delimiter = +<br>inet_interfaces = all<br>smtpd_banner = <span class="hljs-variable">$myhostname</span> ESMTP <span class="hljs-variable">$mail_name</span><br>biff = no<br>append_dot_mydomain = no<br>readme_directory = no<br>smtpd_tls_cert_file=/etc/pki/tls/certs/cert.pem<span class="hljs-comment"># example.com è¯ä¹¦æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹</span><br>smtpd_tls_key_file=/etc/pki/tls/certs/key.pem<span class="hljs-comment"># example.com è¯ä¹¦ç§é’¥æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹</span><br>smtpd_use_tls=<span class="hljs-built_in">yes</span><br>smtpd_tls_auth_only = no<br>smtpd_tls_security_level = may<br>smtp_tls_security_level = may<br>virtual_transport = lmtp:unix:private/dovecot-lmtp<br>smtpd_sasl_type = dovecot<br>smtpd_sasl_path = private/auth<br>smtpd_sasl_auth_enable = <span class="hljs-built_in">yes</span><br>virtual_mailbox_domains = mysql:/etc/postfix/mysql_mailbox_domains.cf<br>virtual_mailbox_maps = mysql:/etc/postfix/mysql_mailbox_maps.cf<br>virtual_alias_maps = mysql:/etc/postfix/mysql_alias_maps.cf, mysql:/etc/postfix/mysql_email2email.cf<br>smtpd_recipient_restrictions = permit_sasl_authenticated, permit_mynetworks, reject_unauth_destination<br>virtual_uid_maps = static:2000<br>virtual_gid_maps = static:2000<br>message_size_limit = 102400000<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-master-cf"><a href="#ä¿®æ”¹-master-cf" class="headerlink" title="ä¿®æ”¹ master.cf"></a>ä¿®æ”¹ master.cf</h3><p>è¯¥æ–‡ä»¶é…ç½® Postfix ä¸­å„æ¨¡å—çš„å‚æ•°ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/postfix/master.cf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sh">smtp      inet  n       -       n       -       -       smtpd<br>submission inet n       -       n       -       -       smtpd<br>  -o syslog_name=postfix/submission<br>  -o smtpd_tls_security_level=encrypt<br>  -o smtpd_sasl_auth_enable=<span class="hljs-built_in">yes</span><br>  -o smtpd_tls_auth_only=no  <br>  -o smtpd_client_restrictions=permit_sasl_authenticated,reject<br>  -o milter_macro_daemon_name=ORIGINATING<br>pickup    unix  n       -       n       60      1       pickup<br>cleanup   unix  n       -       n       -       0       cleanup<br>qmgr      unix  n       -       n       300     1       qmgr<br>tlsmgr    unix  -       -       n       1000?   1       tlsmgr<br>rewrite   unix  -       -       n       -       -       trivial-rewrite<br>bounce    unix  -       -       n       -       0       bounce<br>defer     unix  -       -       n       -       0       bounce<br>trace     unix  -       -       n       -       0       bounce<br>verify    unix  -       -       n       -       1       verify<br>flush     unix  n       -       n       1000?   0       flush<br>proxymap  unix  -       -       n       -       -       proxymap<br>proxywrite unix -       -       n       -       1       proxymap<br>smtp      unix  -       -       n       -       -       smtp<br>relay     unix  -       -       n       -       -       smtp<br>       -o smtp_helo_timeout=120 -o smtp_connect_timeout=120<br>showq     unix  n       -       n       -       -       showq<br>error     unix  -       -       n       -       -       error<br>retry     unix  -       -       n       -       -       error<br>discard   unix  -       -       n       -       -       discard<br><span class="hljs-built_in">local</span>     unix  -       n       n       -       -       <span class="hljs-built_in">local</span><br>virtual   unix  -       n       n       -       -       virtual<br>lmtp      unix  -       -       n       -       -       lmtp<br>anvil     unix  -       -       n       -       1       anvil<br>scache    unix  -       -       n       -       1       scache<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¸-MySQL-å¯¹æ¥"><a href="#ä¸-MySQL-å¯¹æ¥" class="headerlink" title="ä¸ MySQL å¯¹æ¥"></a>ä¸ MySQL å¯¹æ¥</h3><p><strong>æŒ‡å®šåŸŸåæ•°æ®è¡¨</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/postfix/mysql_mailbox_domains.cf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">user = mail_sys<br>password = mail_sys<br>hosts = localhost<br>dbname = mail_sys<br>query = SELECT 1 FROM domains WHERE name=<span class="hljs-string">&#x27;%s&#x27;</span><br>EOF<br><br></code></pre></td></tr></table></figure><p><strong>æŒ‡å®šç”¨æˆ·æ•°æ®è¡¨</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/postfix/mysql_mailbox_maps.cf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">user = mail_sys<br>password = mail_sys<br>hosts = localhost<br>dbname = mail_sys<br>query = SELECT 1 FROM <span class="hljs-built_in">users</span> WHERE email=<span class="hljs-string">&#x27;%s&#x27;</span><br>EOF<br><br></code></pre></td></tr></table></figure><p><strong>æŒ‡å®šåˆ«åæ•°æ®è¡¨</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/postfix/mysql_alias_maps.cf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">user = mail_sys<br>password = mail_sys<br>hosts = localhost<br>dbname = mail_sys<br>query = SELECT destination FROM aliases WHERE <span class="hljs-built_in">source</span>=<span class="hljs-string">&#x27;%s&#x27;</span><br>EOF<br><br></code></pre></td></tr></table></figure><p><strong>æŒ‡å®šç”¨æˆ·æ”¶ä»¶ç›®æ ‡æ•°æ®è¡¨</strong></p><p>ï¼ˆè¿™ä¸ªæœ‰ç‚¹æ‡µï¼ŒLinode ä¸Šé¢çš„æ•™ç¨‹è¦æ±‚æ·»åŠ è¿™ä¸ªï¼Œæ‡‚çš„å¤§ç¥éº»çƒ¦è§£é‡Šä¸‹ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/postfix/mysql_email2email.cf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">user = mail_sys<br>password = mail_sys<br>hosts = localhost<br>dbname = mail_sys<br>query = SELECT email FROM <span class="hljs-built_in">users</span> WHERE email=<span class="hljs-string">&#x27;%s&#x27;</span><br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•æ•°æ®åº“è¯»å–"><a href="#æµ‹è¯•æ•°æ®åº“è¯»å–" class="headerlink" title="æµ‹è¯•æ•°æ®åº“è¯»å–"></a>æµ‹è¯•æ•°æ®åº“è¯»å–</h3><p>å¯åŠ¨ Postfix æœåŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start postfix<br><br></code></pre></td></tr></table></figure><p>æµ‹è¯•åŸŸåæ•°æ®è¡¨çš„è¯»å–</p><p>ä¸‹é¢çš„ example.com è¯·æ›¿æ¢ä¸ºè‡ªå·±è®¾å®šçš„åŸŸåã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">postmap -q example.com mysql:/etc/postfix/mysql_mailbox_domains.cf<br><br></code></pre></td></tr></table></figure><p>è‹¥è¿”å› 1 ï¼Œåˆ™è¯´æ˜è®¾ç½®æ­£ç¡®ã€‚</p><p>æµ‹è¯•ç”¨æˆ·åæ•°æ®è¡¨çš„è¯»å–</p><p>ä¸‹é¢çš„ <a href="mailto:&#117;&#115;&#101;&#114;&#x31;&#x40;&#x65;&#x78;&#x61;&#109;&#112;&#108;&#101;&#x2e;&#99;&#x6f;&#109;">user1@example.com</a> è¯·æ›¿æ¢ä¸ºè‡ªå·±è®¾å®šçš„ç”¨æˆ·åå…¶ä¸­ä¸€ä¸ªã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">postmap -q user1@example.com mysql:/etc/postfix/mysql_mailbox_maps.cf<br><br></code></pre></td></tr></table></figure><p>è‹¥è¿”å› 1 ï¼Œåˆ™è¯´æ˜è®¾ç½®æ­£ç¡®ã€‚</p><p>æµ‹è¯•åˆ«åæ•°æ®è¡¨çš„è¯»å–ï¼ˆå¯é€‰ï¼‰</p><p>ä¸‹é¢çš„ <a href="mailto:&#117;&#x73;&#x65;&#114;&#x31;&#x31;&#64;&#x65;&#x78;&#x61;&#109;&#x70;&#108;&#x65;&#46;&#99;&#x6f;&#109;">user11@example.com</a> è¯·æ›¿æ¢ä¸ºè‡ªå·±è®¾å®šçš„åˆ«åå…¶ä¸­ä¸€ä¸ªã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">postmap -q user11@example.com mysql:/etc/postfix/mysql_alias_maps.cf<br><br></code></pre></td></tr></table></figure><p>è‹¥è¿”å›åˆ«åæ‰€å¯¹åº”çš„çœŸå®ç”¨æˆ·å ï¼Œåˆ™è¯´æ˜è®¾ç½®æ­£ç¡®ã€‚</p><p>åœæ­¢ Postfix æœåŠ¡</p><p>ç­‰å…¨éƒ¨é…ç½®å®Œæˆåå†å¯åŠ¨ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop postfix<br><br></code></pre></td></tr></table></figure><h3 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="Dovecot"><a href="#Dovecot" class="headerlink" title="Dovecot"></a>Dovecot</h2><h3 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å¸è½½ sendmail</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum remove sendmail<br><br></code></pre></td></tr></table></figure><p>å®‰è£… Dovecot</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install dovecot<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šCentOS 6 éœ€è¦å®‰è£… managesieve</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install dovecot-pigeonhole<br><br></code></pre></td></tr></table></figure><h3 id="å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶-1"><a href="#å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶-1" class="headerlink" title="å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶"></a>å¤‡ä»½åŸç‰ˆé…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> -r /etc/dovecot /etc/dovecot.bak<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-dovecot-conf"><a href="#ä¿®æ”¹-dovecot-conf" class="headerlink" title="ä¿®æ”¹ dovecot.conf"></a>ä¿®æ”¹ dovecot.conf</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½® Dovecot çš„å…¨å±€å‚æ•°ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/dovecot.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">protocols = imap lmtp<br>dict &#123;<br>&#125;<br>!include conf.d/*.conf<br>!include_try local.conf<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-conf-d-10-mail-conf"><a href="#ä¿®æ”¹-conf-d-10-mail-conf" class="headerlink" title="ä¿®æ”¹ conf.d&#x2F;10-mail.conf"></a>ä¿®æ”¹ conf.d&#x2F;10-mail.conf</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½®é‚®ç®±æ–‡ä»¶å­˜å‚¨çš„ä½ç½®å’Œå‘½åç©ºé—´ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/conf.d/10-mail.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">namespace inbox &#123;<br>  inbox = <span class="hljs-built_in">yes</span><br>&#125;<br>first_valid_uid = 1000<br>mbox_write_locks = fcntl<br>mail_location = maildir:/var/spool/mail/%d/%n<br>mail_privileged_group = mail<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-conf-d-15-mailboxes-conf"><a href="#ä¿®æ”¹-conf-d-15-mailboxes-conf" class="headerlink" title="ä¿®æ”¹ conf.d&#x2F;15-mailboxes.conf"></a>ä¿®æ”¹ conf.d&#x2F;15-mailboxes.conf</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½®é‚®ç®±å†…éƒ¨çš„ç›®å½•ç»“æ„ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/conf.d/15-mailboxes.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">namespace inbox &#123;<br>  mailbox Drafts &#123;<br>    auto = create<br>    special_use = \Drafts<br>  &#125;<br>  mailbox Trash &#123;<br>    auto = create<br>    special_use = \Trash<br>  &#125;<br>  mailbox Sent &#123;<br>    auto = create<br>    special_use = \Sent<br>  &#125;<br>&#125;<br>EOF<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„</p><p>dovecot2.3ä»¥ä¸‹æ”¾å…¥ç©ºå†…å®¹å°±å¥½</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">namespace inbox &#123;<br>&#125;<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-conf-d-10-auth-conf"><a href="#ä¿®æ”¹-conf-d-10-auth-conf" class="headerlink" title="ä¿®æ”¹ conf.d&#x2F;10-auth.conf"></a>ä¿®æ”¹ conf.d&#x2F;10-auth.conf</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½®ç”¨æˆ·èº«ä»½è®¤è¯æµç¨‹ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/conf.d/10-auth.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">auth_mechanisms = plain login<br>!include auth-sql.conf.ext<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-conf-d-auth-sql-conf-ext"><a href="#ä¿®æ”¹-conf-d-auth-sql-conf-ext" class="headerlink" title="ä¿®æ”¹ conf.d&#x2F;auth-sql.conf.ext"></a>ä¿®æ”¹ conf.d&#x2F;auth-sql.conf.ext</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½®æ•°æ®åº“è®¤è¯çš„å‚æ•°ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/conf.d/auth-sql.conf.ext &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">passdb &#123;<br>  driver = sql<br>  args = /etc/dovecot/dovecot-sql.conf.ext<br>&#125;<br>userdb &#123;<br>  driver = static<br>  args = uid=mail_sys gid=mail_sys home=/var/spool/mail/%d/%n<br>&#125;<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-dovecot-sql-conf-ext"><a href="#ä¿®æ”¹-dovecot-sql-conf-ext" class="headerlink" title="ä¿®æ”¹ dovecot-sql.conf.ext"></a>ä¿®æ”¹ dovecot-sql.conf.ext</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½®éªŒè¯ç”¨æˆ·åå¯†ç æ‰€ç”¨çš„æ•°æ®è¡¨ä»¥åŠè®¤è¯æ–¹æ³•ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/dovecot-sql.conf.ext &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">driver = mysql<br>connect = host=localhost dbname=mail_sys user=mail_sys password=mail_sys<br>default_pass_scheme = SHA512-CRYPT<br>password_query = SELECT email as user, password FROM <span class="hljs-built_in">users</span> WHERE email=<span class="hljs-string">&#x27;%u&#x27;</span>;<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-conf-d-10-ssl-conf"><a href="#ä¿®æ”¹-conf-d-10-ssl-conf" class="headerlink" title="ä¿®æ”¹ conf.d&#x2F;10-ssl.conf"></a>ä¿®æ”¹ conf.d&#x2F;10-ssl.conf</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½® SSL åŠ å¯†å‚æ•°ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/conf.d/10-ssl.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>è¯·æŒ‰å®é™…æƒ…å†µä»¥åŠæ³¨é‡Šæç¤º<strong>ä¿®æ”¹ä»¥ä¸‹å†…å®¹</strong>ï¼Œå®Œæˆå»é™¤ # å·å’Œåé¢çš„æ³¨é‡Šï¼Œç„¶åç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssl = required<br>ssl_cert = &lt;/etc/pki/tls/certs/cert.pem<span class="hljs-comment"># example.com è¯ä¹¦æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹</span><br>ssl_key = &lt;/etc/pki/tls/certs/key.pem<span class="hljs-comment"># example.com è¯ä¹¦ç§é’¥æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹</span><br>ssl_protocols = !SSLv3<br>ssl_cipher_list = ALL:!LOW:!SSLv3:!EXP:!aNULL<br>ssl_prefer_server_ciphers = no<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-conf-d-10-master-conf"><a href="#ä¿®æ”¹-conf-d-10-master-conf" class="headerlink" title="ä¿®æ”¹ conf.d&#x2F;10-master.conf"></a>ä¿®æ”¹ conf.d&#x2F;10-master.conf</h3><blockquote><p><strong>è¯´æ˜</strong><br>â€¢ è¯¥æ–‡ä»¶é…ç½® Dovecot ä¸­å„æœåŠ¡çš„å‚æ•°ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/dovecot/conf.d/10-master.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs sh">service imap-login &#123;<br>  inet_listener imap &#123;<br>    port = 143<br>  &#125;<br>  inet_listener imaps &#123;<br>    port = 993<br>    ssl = <span class="hljs-built_in">yes</span><br>  &#125;<br>&#125;<br><br>service lmtp &#123;<br>    unix_listener /var/spool/postfix/private/dovecot-lmtp &#123;<br>    mode = 0600<br>    user = postfix<br>    group = postfix<br>  &#125;<br>&#125;<br><br>service imap &#123;<br><br>&#125;<br><br>service auth &#123;<br>  unix_listener /var/spool/postfix/private/auth &#123;<br>    mode = 0666<br>    user = postfix<br>    group = postfix<br>  &#125;<br><br>  unix_listener auth-userdb &#123;<br>    mode = 0600<br>    user = mail_sys<br>  &#125;<br>  user = dovecot<br>&#125;<br><br>service auth-worker &#123;<br>  user = mail_sys<br>&#125;<br><br>service dict &#123;<br>  unix_listener dict &#123;<br>    mode = 0660<br>    user = mail<br>    group = mail<br>  &#125;<br>&#125;<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="æ—¥å¿—-1"><a href="#æ—¥å¿—-1" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">/<span class="hljs-keyword">var</span>/<span class="hljs-built_in">log</span>/maillog<br><br></code></pre></td></tr></table></figure><h2 id="é…ç½®-OpenDKIM"><a href="#é…ç½®-OpenDKIM" class="headerlink" title="é…ç½® OpenDKIM"></a>é…ç½® OpenDKIM</h2><p>å®‰è£…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install opendkim<br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-OpenDKIM-é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹-OpenDKIM-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ OpenDKIM é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ OpenDKIM é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/opendkim.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>è¯·æŒ‰å®é™…æƒ…å†µä»¥åŠæ³¨é‡Šæç¤º<strong>ä¿®æ”¹ä»¥ä¸‹å†…å®¹</strong>ï¼Œå®Œæˆå»é™¤ # å·å’Œåé¢çš„æ³¨é‡Šï¼Œç„¶åç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">Syslog <span class="hljs-built_in">yes</span><br>UMask 002<br>OversignHeaders From<br>Socket inet:8891@127.0.0.1<br>Domain example.com <span class="hljs-comment">#æœ¬æœºåŸŸåï¼Œéœ€è¦ä¿®æ”¹</span><br>KeyFile /etc/opendkim/keys/mail.private<br>Selector mail<br>RequireSafeKeys no<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="ç”Ÿæˆç§é’¥"><a href="#ç”Ÿæˆç§é’¥" class="headerlink" title="ç”Ÿæˆç§é’¥"></a>ç”Ÿæˆç§é’¥</h3><p>ä¸‹é¢çš„ example.com è¯·æ›¿æ¢æˆæ‚¨çš„åŸŸåã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">opendkim-genkey -D /etc/opendkim/keys/ -d example.com -s mail &amp;&amp; chown -R opendkim:opendkim /etc/opendkim/keys/<br><br></code></pre></td></tr></table></figure><h3 id="é…ç½®-Postfix-çš„-main-cf"><a href="#é…ç½®-Postfix-çš„-main-cf" class="headerlink" title="é…ç½® Postfix çš„ main.cf"></a>é…ç½® Postfix çš„ main.cf</h3><p>é…ç½®å‘ä»¶å¢åŠ  DKIM ç­¾åã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/postfix/main.cf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­æŒ‰å›è½¦å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">milter_protocol = 2<br>milter_default_action = accept<br>smtpd_milters = inet:localhost:8891<br>non_smtpd_milters = inet:localhost:8891<br>EOF<br><br></code></pre></td></tr></table></figure><h3 id="å¯åŠ¨æ‰€æœ‰æœåŠ¡"><a href="#å¯åŠ¨æ‰€æœ‰æœåŠ¡" class="headerlink" title="å¯åŠ¨æ‰€æœ‰æœåŠ¡"></a>å¯åŠ¨æ‰€æœ‰æœåŠ¡</h3><p>CentOS 7</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start postfix dovecot opendkim<br><br></code></pre></td></tr></table></figure><p>CentOS 6</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">service postfix <span class="hljs-literal">start</span><br>service dovecot <span class="hljs-literal">start</span><br>service opendkim <span class="hljs-literal">start</span><br><br></code></pre></td></tr></table></figure><p>å¦‚éœ€å¼€æœºå¯åŠ¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><p>CentOS 7</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> postfix dovecot opendkim mariadb<br><br></code></pre></td></tr></table></figure><p>CentOS 6</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">chkconfig postfix on<br>chkconfig dovecot on<br>chkconfig opendkim on<br>chkconfig mariadb on<br><br></code></pre></td></tr></table></figure><h2 id="é…ç½®åŸŸåå‚æ•°"><a href="#é…ç½®åŸŸåå‚æ•°" class="headerlink" title="é…ç½®åŸŸåå‚æ•°"></a>é…ç½®åŸŸåå‚æ•°</h2><h3 id="A-è®°å½•çš„è®¾å®š"><a href="#A-è®°å½•çš„è®¾å®š" class="headerlink" title="A è®°å½•çš„è®¾å®š"></a>A è®°å½•çš„è®¾å®š</h3><p>åœ¨åŸŸåæ§åˆ¶é¢æ¿ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ<strong>ä¸»æœºè®°å½•</strong>å¡« <strong>@</strong> ,<strong>è®°å½•ç±»å‹</strong>é€‰ <strong>A</strong> <strong>è®°å½•å€¼</strong>å¡« <strong>1.1.1.1</strong> ï¼Œå…¶ä»–ä¿æŒé»˜è®¤ï¼Œä¿å­˜å³å¯ã€‚</p><h3 id="MX-è®°å½•çš„è®¾å®š"><a href="#MX-è®°å½•çš„è®¾å®š" class="headerlink" title="MX è®°å½•çš„è®¾å®š"></a>MX è®°å½•çš„è®¾å®š</h3><p>åœ¨åŸŸåæ§åˆ¶é¢æ¿ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ<strong>ä¸»æœºè®°å½•</strong>å¡« <strong>@</strong> ,<strong>è®°å½•ç±»å‹</strong>é€‰ <strong>MX</strong> ,<strong>è®°å½•å€¼</strong>å¡« <strong><a href="http://mail.example.com/">http://mail.example.com</a></strong>ï¼Œå…¶ä»–ä¿æŒé»˜è®¤ï¼›<br>å†æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ<strong>ä¸»æœºè®°å½•</strong>å¡« <strong>mail</strong> ,<strong>è®°å½•ç±»å‹</strong>é€‰ <strong>A</strong> ,<strong>è®°å½•å€¼</strong>å¡« <strong>1.1.1.1</strong>ï¼Œå…¶ä»–ä¿æŒé»˜è®¤ï¼Œä¿å­˜å³å¯ã€‚</p><h3 id="SPF-è®°å½•çš„è®¾å®š"><a href="#SPF-è®°å½•çš„è®¾å®š" class="headerlink" title="SPF è®°å½•çš„è®¾å®š"></a>SPF è®°å½•çš„è®¾å®š</h3><p>åœ¨åŸŸåæ§åˆ¶é¢æ¿ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ<strong>ä¸»æœºè®°å½•</strong>å¡« <strong>@</strong> ,<strong>è®°å½•ç±»å‹</strong>é€‰ <strong>TXT</strong> ,<strong>è®°å½•å€¼</strong>å¡« <strong>v&#x3D;spf1 mx -all</strong>ï¼Œå…¶ä»–ä¿æŒé»˜è®¤ï¼Œä¿å­˜å³å¯ã€‚</p><h3 id="DMARC-è®°å½•çš„è®¾å®š"><a href="#DMARC-è®°å½•çš„è®¾å®š" class="headerlink" title="DMARC è®°å½•çš„è®¾å®š"></a>DMARC è®°å½•çš„è®¾å®š</h3><p>åœ¨åŸŸåæ§åˆ¶é¢æ¿ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ<strong>ä¸»æœºè®°å½•</strong>å¡« <strong>_dmarc</strong> ,<strong>è®°å½•ç±»å‹</strong>é€‰ <strong>TXT</strong> ,<strong>è®°å½•å€¼</strong>å¡« <strong>v&#x3D;DMARC1; p&#x3D;none</strong>ï¼Œå…¶ä»–ä¿æŒé»˜è®¤ï¼Œä¿å­˜å³å¯ã€‚</p><h3 id="DKIM-è®°å½•çš„è®¾å®š"><a href="#DKIM-è®°å½•çš„è®¾å®š" class="headerlink" title="DKIM è®°å½•çš„è®¾å®š"></a>DKIM è®°å½•çš„è®¾å®š</h3><p>ï¼ˆä»¥æˆ‘çš„å¯†é’¥æ–‡ä»¶ä¸ºä¾‹ï¼‰<br>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/opendkim/keys/mail.txt <br><br></code></pre></td></tr></table></figure><p>ä¼šå‡ºç°ä»¥ä¸‹ç»“æœ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">mail._domainkeyINTXT( <span class="hljs-string">&quot;v=DKIM1; k=rsa; &quot;</span><br>  <span class="hljs-string">&quot;p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDU5nkxbS36hOa2FCJqotvahTbxb83CvLt5XqV4WAPzJQmfaA1eHyvOz9XiZgE8vWRgP2jJFlL+J4yEroB3YV/8EBjAM8lFTi31DVgRsoHMwH6f3GuLAfcuVofymDfRxHxPzIlm7rgzfWwrGcPrIzt64NLuZG4yusTWp8MTfWZxvQIDAQAB&quot;</span> )  ; ----- DKIM key default <span class="hljs-keyword">for</span> example.com<br><br></code></pre></td></tr></table></figure><p>æŠŠæ‹¬å·å†…çš„å€¼å¤åˆ¶å‡ºæ¥ï¼Œå»æ‰æ‰€æœ‰å¼•å·å¹¶æ•´ç†æˆä¸€è¡Œï¼Œå½¢å¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDU5nkxbS36hOa2FCJqotvahTbxb83CvLt5XqV4WAPzJQmfaA1eHyvOz9XiZgE8vWRgP2jJFlL+J4yEroB3YV/8EBjAM8lFTi31DVgRsoHMwH6f3GuLAfcuVofymDfRxHxPzIlm7rgzfWwrGcPrIzt64NLuZG4yusTWp8MTfWZxvQIDAQAB<br><br></code></pre></td></tr></table></figure><p>åœ¨åŸŸåæ§åˆ¶é¢æ¿ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ<strong>ä¸»æœºè®°å½•</strong>å¡« <strong>mail._domainkey</strong> ,<strong>è®°å½•ç±»å‹</strong>é€‰ <strong>TXT</strong> ,<strong>è®°å½•å€¼</strong>å¡« <strong>v&#x3D;DKIM1; k&#x3D;rsa; p&#x3D;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDU5nkxbS36hOa2FCJqotvahTbxb83CvLt5XqV4WAPzJQmfaA1eHyvOz9XiZgE8vWRgP2jJFlL+J4yEroB3YV&#x2F;8EBjAM8lFTi31DVgRsoHMwH6f3GuLAfcuVofymDfRxHxPzIlm7rgzfWwrGcPrIzt64NLuZG4yusTWp8MTfWZxvQIDAQAB</strong>ï¼Œå…¶ä»–ä¿æŒé»˜è®¤ï¼Œä¿å­˜å³å¯ã€‚</p><p>æœ€ç»ˆæ•ˆæœå¦‚å›¾</p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/dns_settings.png" alt="dns_settings.png"></p><h3 id="IP-åå‘è§£æçš„è®¾å®š"><a href="#IP-åå‘è§£æçš„è®¾å®š" class="headerlink" title="IP åå‘è§£æçš„è®¾å®š"></a>IP åå‘è§£æçš„è®¾å®š</h3><p>è¿™ä¸ªâ€¦â€¦æ™®é€šå®¶åº­å®½å¸¦ç”¨æˆ·å°±åˆ«æƒ³äº†ï¼Œä¼ä¸šå®½å¸¦å’Œå›½å†…äº‘ä¸»æœºç”¨æˆ·éœ€è¦ç½‘ç«™é€šè¿‡å¤‡æ¡ˆæ‰èƒ½è®¾ç½®ã€‚å¦‚æœç”¨å›½å¤–äº‘ä¸»æœºçš„è¯ï¼Œæœ‰äº›å¯ä»¥æ”¯æŒã€‚ä¸ºæ‚¨çš„åŸŸåé…ç½® IP åœ°å€åå‘è§£æå¯ä»¥å¤§å¹…é™ä½å¤–å‘é‚®ä»¶è¢«æ‹’æ”¶çš„å‡ ç‡ã€‚</p><h2 id="è¿‡æ»¤æ²Ÿé€š-Amavisd-new"><a href="#è¿‡æ»¤æ²Ÿé€š-Amavisd-new" class="headerlink" title="è¿‡æ»¤æ²Ÿé€š Amavisd-new"></a>è¿‡æ»¤æ²Ÿé€š Amavisd-new</h2><p><a href="https://blog.51cto.com/freeloda/1246350">å®‰è£…å¹¶é…ç½®ç—…æ¯’æ‰«æä¸åƒåœ¾é‚®ä»¶è¿‡æ»¤</a></p><h2 id="ç—…æ¯’æ‰«æ-ClamAV"><a href="#ç—…æ¯’æ‰«æ-ClamAV" class="headerlink" title="ç—…æ¯’æ‰«æ ClamAV"></a>ç—…æ¯’æ‰«æ ClamAV</h2><h2 id="åƒåœ¾é‚®ä»¶è¿‡æ»¤-SpamAssassin"><a href="#åƒåœ¾é‚®ä»¶è¿‡æ»¤-SpamAssassin" class="headerlink" title="åƒåœ¾é‚®ä»¶è¿‡æ»¤ SpamAssassin"></a>åƒåœ¾é‚®ä»¶è¿‡æ»¤ SpamAssassin</h2><h2 id="Policyd-ç™½åå•"><a href="#Policyd-ç™½åå•" class="headerlink" title="Policyd ç™½åå•"></a>Policyd ç™½åå•</h2><p><a href="https://wiki.policyd.org/download">å®˜ç½‘</a>ä¸‹è½½</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://download.policyd.org/v2.0.14/cluebringer-v2.0.14.tar.gz<br><br></code></pre></td></tr></table></figure><p>è§£å‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -zxvf cluebringer-v2.0.14.tar.gz<br><br></code></pre></td></tr></table></figure><p>æ•´åˆåˆå§‹åŒ– sql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ./cluebringer-v2.0.14/database<br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œshell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">for i in core.tsql access_control.tsql quotas.tsql amavis.tsql checkhelo.tsql checkspf.tsql greylisting.tsql<br>do<br>  ./convert-tsql mysql $i<br>done &gt; policyd.sql<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ vim æ›¿æ¢é”™è¯¯ SQL è¯­æ³•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">%s/TYPE=InnoDB/ENGINE=InnoDB/g<br><br></code></pre></td></tr></table></figure><p>å»ºåº“</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -u root -p -e <span class="hljs-string">&#x27;CREATE DATABASE policyd&#x27;</span><br><br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ•°æ®åº“</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -u root -p policyd &lt; policyd.sql<br><br></code></pre></td></tr></table></figure><p>å¤åˆ¶æ–‡ä»¶ cbp&#x2F; &amp; awitpt&#x2F;</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /usr/local/lib/cbpolicyd-2.0<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> -r cbp /usr/local/lib/cbpolicyd-2.0/<br><span class="hljs-built_in">cp</span> -r awitpt/awitpt /usr/local/lib/cbpolicyd-2.0/<br><br></code></pre></td></tr></table></figure><p>å¤åˆ¶æ–‡ä»¶ cbpolicyd å’Œ cbpadmin</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> cbpadmin /usr/local/bin/<br><span class="hljs-built_in">cp</span> cbpolicyd /usr/local/sbin/<br><br></code></pre></td></tr></table></figure><p>è®¾ç½®ç³»ç»Ÿç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /var/log/cbpolicyd<br><span class="hljs-built_in">mkdir</span> /var/run/cbpolicyd<br><br></code></pre></td></tr></table></figure><p>åœ¨ &#x2F;etc&#x2F;postfix&#x2F;main.cf ä¸­é…ç½®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># policyd</span><br><span class="hljs-attribute">smtpd_recipient_restrictions</span> = check_policy_service inetï¼š<span class="hljs-number">127.0.0.1</span>ï¼š<span class="hljs-number">10031</span>ï¼Œpermit_mynetworksï¼Œ...ï¼Œ...<br><br></code></pre></td></tr></table></figure><h2 id="æ—¥å¿—-Awstats"><a href="#æ—¥å¿—-Awstats" class="headerlink" title="æ—¥å¿— Awstats"></a>æ—¥å¿— Awstats</h2><h2 id="é˜²çˆ†-fail2ban"><a href="#é˜²çˆ†-fail2ban" class="headerlink" title="é˜²çˆ† fail2ban"></a>é˜²çˆ† fail2ban</h2><h3 id="å®‰è£…-3"><a href="#å®‰è£…-3" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install <br><br></code></pre></td></tr></table></figure><p>æ·»åŠ è¿‡æ»¤é…ç½® <code>/etc/fail2ban/filter.d/dovecot-pop3imap.conf</code></p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coq">[<span class="hljs-keyword">Definition</span>]<br>failregex = (?: pop3-login|<span class="hljs-type">imap</span>-login): .*(?:Authentication failure|<span class="hljs-type">Aborted</span> login \(auth failed|<span class="hljs-type">Aborted</span> login \(tried to use disabled|<span class="hljs-type">Disconnected</span> \(auth failed|<span class="hljs-type">Aborted</span> login \(\d+ authentication attempts).*rip=`&lt;HOST&gt;`<br><br></code></pre></td></tr></table></figure><p>æ·»åŠ é…ç½® <code>/etc/fail2ban/jail.conf</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[dovecot-pop3imap]</span><br><span class="hljs-attr">enabled</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">filter</span> = dovecot-pop3imap<br><span class="hljs-attr">action</span> = iptables-multiport[name=dovecot-pop3imap, port=<span class="hljs-string">&quot;pop3,imap&quot;</span>, protocol=tcp]<br><span class="hljs-attr">logpath</span> = /var/log/maillog<br><span class="hljs-attr">maxretry</span> = <span class="hljs-number">20</span><br><span class="hljs-attr">findtime</span> = <span class="hljs-number">1200</span><br><span class="hljs-attr">bantime</span> = <span class="hljs-number">1200</span><br><br></code></pre></td></tr></table></figure><h3 id="è¿è¡ŒæœåŠ¡"><a href="#è¿è¡ŒæœåŠ¡" class="headerlink" title="è¿è¡ŒæœåŠ¡"></a>è¿è¡ŒæœåŠ¡</h3><p>å¯åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">service fail2ban start<br><br>systemctl start fail2ban<br><br></code></pre></td></tr></table></figure><p>è‡ªå¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">chkconfig fail2ban on<br><br>systemctl <span class="hljs-built_in">enable</span> fail2ban<br><br></code></pre></td></tr></table></figure><h2 id="é…ç½®-Web-é‚®ç®±"><a href="#é…ç½®-Web-é‚®ç®±" class="headerlink" title="é…ç½® Web é‚®ç®±"></a>é…ç½® Web é‚®ç®±</h2><h3 id="å®‰è£…-Nginxã€PHP"><a href="#å®‰è£…-Nginxã€PHP" class="headerlink" title="å®‰è£… Nginxã€PHP"></a>å®‰è£… Nginxã€PHP</h3><p>Nginx</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install nginx<br><br></code></pre></td></tr></table></figure><p>PHP</p><p>æ£€æŸ¥å½“å‰ç‰ˆæœ¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum list installed | grep php<br><br></code></pre></td></tr></table></figure><p>ç¡®ä¿å¯ä»¥å¸è½½æ—§ç‰ˆæœ¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum remove php*<br><br></code></pre></td></tr></table></figure><p>æ·»åŠ ç¬¬ä¸‰æ–¹yumæº</p><p>CentOs 5.x</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -Uvh &lt;http://mirror.webtatic.com/yum/el5/latest.rpm<br><br></code></pre></td></tr></table></figure><p>CentOs 6.x</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -Uvh &lt;http://mirror.webtatic.com/yum/el6/latest.rpm<br><br></code></pre></td></tr></table></figure><p>CentOs 7.X</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -Uvh &lt;https://mirror.webtatic.com/yum/el7/epel-release.rpm&gt;<br>rpm -Uvh &lt;https://mirror.webtatic.com/yum/el7/webtatic-release.rpm&gt;<br><br></code></pre></td></tr></table></figure><p>å®‰è£…phpåŠå…¶ç»„ä»¶</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">yum install php56w-mysql php56w-fpm php56w-xml php56w-mbstring<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64 php70w-mysql.x86_64 php70w-pdo.x86_64 php70w-fpm.x86_64 php70w-xml.x86_64<br><br></code></pre></td></tr></table></figure><h3 id="ä¸‹è½½å¹¶å®‰è£…-Roundcube"><a href="#ä¸‹è½½å¹¶å®‰è£…-Roundcube" class="headerlink" title="ä¸‹è½½å¹¶å®‰è£… Roundcube"></a>ä¸‹è½½å¹¶å®‰è£… Roundcube</h3><p>ä¸‹è½½</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://github.com/roundcube/roundcubemail/releases/download/1.3.0/roundcubemail-1.3.0-complete.tar.gz<br><br></code></pre></td></tr></table></figure><p>è§£å‹ &amp; å®‰è£…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xf roundcubemail-1.3.0-complete.tar.gz &amp;&amp; <span class="hljs-built_in">mv</span> roundcubemail-1.3.0 /usr/share/roundcube &amp;&amp; <span class="hljs-built_in">chown</span> -R apache:apache /usr/share/roundcube<br><br></code></pre></td></tr></table></figure><h3 id="é…ç½®-Nginx-ã€PHP"><a href="#é…ç½®-Nginx-ã€PHP" class="headerlink" title="é…ç½® Nginx ã€PHP"></a>é…ç½® Nginx ã€PHP</h3><p>é…ç½® Nginx</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">vim /etc/nginx/conf.d/mail.conf<br><br></code></pre></td></tr></table></figure><p>è¯·æŒ‰å®é™…æƒ…å†µä»¥åŠæ³¨é‡Šæç¤º<strong>ä¿®æ”¹ä»¥ä¸‹å†…å®¹</strong>ï¼Œåœ¨å‘½ä»¤è¡Œçª—å£æŒ‰ä¸‹ i ï¼Œå°†å†…å®¹ç›´æ¥ç²˜è´´åˆ°å‘½ä»¤è¡Œçª—å£ä¸­ï¼Œå†æŒ‰ä¸‹ ESC ï¼Œæœ€åè¾“å…¥ :wq æŒ‰å›è½¦ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>  mail.example.com; <span class="hljs-comment"># æœ¬æœºåŸŸåå‰é¢åŠ ä¸Šmail. éœ€è¦ä¿®æ”¹</span><br>    <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-attribute">server_name</span>  mail.example.com; <span class="hljs-comment"># æœ¬æœºåŸŸåå‰é¢åŠ ä¸Šmail. éœ€è¦ä¿®æ”¹</span><br>    <span class="hljs-attribute">ssl_certificate</span> <span class="hljs-string">&quot;/etc/pki/tls/certs/cert.pem&quot;</span>; <span class="hljs-comment"># mail.example.com è¯ä¹¦æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹</span><br>    <span class="hljs-attribute">ssl_certificate_key</span> <span class="hljs-string">&quot;/etc/pki/tls/certs/key.pem&quot;</span>; <span class="hljs-comment"># mail.example.com è¯ä¹¦ç§é’¥æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹</span><br>    <span class="hljs-attribute">add_header</span> Strict-Transport-Security <span class="hljs-string">&quot;max-age=15552000; includeSubDomains&quot;</span>;<br>    <span class="hljs-section">location</span> / &#123;<br>     <span class="hljs-attribute">root</span>         /usr/share/roundcube;<br>     <span class="hljs-attribute">index</span>        index.php;     <br>    &#125;<br><span class="hljs-section">location</span> <span class="hljs-regexp">~ .php$</span> &#123;<br>        <span class="hljs-attribute">root</span>         /usr/share/roundcube;<br>        <span class="hljs-attribute">fastcgi_pass</span>   <span class="hljs-number">127.0.0.1:9000</span>;<br>        <span class="hljs-attribute">fastcgi_index</span>  index.php;<br>        <span class="hljs-attribute">fastcgi_param</span>  SCRIPT_FILENAME  <span class="hljs-variable">$document_root</span><span class="hljs-variable">$fastcgi_script_name</span>;<br>        <span class="hljs-attribute">include</span>        fastcgi_params;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>é…ç½® PHP</strong></p><p>è®¾ç½®æ—¶åŒº</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;date.timezone = Asia/Shanghai&quot;</span> &gt;&gt; /etc/php.ini <br><br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¼šè¯æ–‡ä»¶å¤¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /var/lib/php/session &amp;&amp; <span class="hljs-built_in">chown</span> apache:apache /var/lib/php/session<br><br></code></pre></td></tr></table></figure><h3 id="é…ç½®æ•°æ®åº“"><a href="#é…ç½®æ•°æ®åº“" class="headerlink" title="é…ç½®æ•°æ®åº“"></a>é…ç½®æ•°æ®åº“</h3><p>è¿›å…¥ MySQL å‘½ä»¤è¡Œç•Œé¢</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">mysql -u root -p<br><br>Enter password: #è¾“å…¥å¯†ç æŒ‰å›è½¦<br><br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç”¨äºè¯»å†™ Roundcube æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE USER &#x27;roundcube&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;roundcube&#x27;;<br><br></code></pre></td></tr></table></figure><p>åˆ›å»º Roundcube æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE roundcube;<br><br></code></pre></td></tr></table></figure><p>ä¸ºç”¨æˆ·æˆäºˆè¯»å†™æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">GRANT ALL ON roundcube.* TO &#x27;roundcube&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;roundcube&#x27;;<br><br></code></pre></td></tr></table></figure><p>åˆ·æ–°æƒé™è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">FLUSH PRIVILEGES;<br><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“è®¾ç½®å®Œæˆ</p><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><p>CentOS 6</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">service nginx <span class="hljs-literal">start</span><br>service php-fpm <span class="hljs-literal">start</span><br><br></code></pre></td></tr></table></figure><p>CentOS 7</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start nginx php-fpm<br><br></code></pre></td></tr></table></figure><p>å¦‚éœ€å¼€æœºå¯åŠ¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><p>CentOS 6</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">chkconfig</span> nginx <span class="hljs-literal">on</span><br>chkconfig php-fpm <span class="hljs-literal">on</span><br><br></code></pre></td></tr></table></figure><p>CentOS 7</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> nginx php-fpm<br><br></code></pre></td></tr></table></figure><h3 id="é…ç½®-Roundcube"><a href="#é…ç½®-Roundcube" class="headerlink" title="é…ç½® Roundcube"></a>é…ç½® Roundcube</h3><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <a href="https://mail.example.com/installer/?_step=1">https://mail.example.com/installer/?_step&#x3D;1</a> ï¼Œå›è½¦æ‰“å¼€ã€‚ç„¶åæŒ‰å›¾ç‰‡æç¤ºè¿›è¡Œé…ç½®ã€‚</p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/roundcube_01.png" alt="roundcube_01.png"></p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/roundcube_02.png" alt="roundcube_02.png"></p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/roundcube_03.png" alt="roundcube_03.png"></p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/roundcube_04.png" alt="roundcube_04.png"></p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/roundcube_05.png" alt="roundcube_05.png"></p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/roundcube_06.png" alt="roundcube_06.png"></p><p><img src="/../../static/image/%E8%87%AA%E9%80%89%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-CentOS/roundcube_07.png" alt="roundcube_07.png"></p><p>é…ç½®å®Œæˆåï¼Œå…³é—­æµè§ˆå™¨é¡µé¢ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä½¿å®‰è£…ç¨‹åºä¸å¯ç”¨ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">chmod -R 000 /usr/share/roundcube/installer/<br><br></code></pre></td></tr></table></figure><h3 id="ç™»å½•æµ‹è¯•"><a href="#ç™»å½•æµ‹è¯•" class="headerlink" title="ç™»å½•æµ‹è¯•"></a>ç™»å½•æµ‹è¯•</h3><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <a href="http://link.zhihu.com/?target=https://mail.example.com/">https://mail.example.com</a> ï¼Œç„¶åè¾“å…¥æ‚¨çš„ç”¨æˆ·åå¯†ç ç™»å½•ï¼Œæµ‹è¯•æ”¶å‘é‚®ä»¶</p><h3 id="æ—¥å¿—-2"><a href="#æ—¥å¿—-2" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/roundcube/</span>logs/*<br><br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•å·¥å…·"><a href="#æµ‹è¯•å·¥å…·" class="headerlink" title="æµ‹è¯•å·¥å…·"></a>æµ‹è¯•å·¥å…·</h2><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <a href="http://www.mail-tester.com/">http://www.mail-tester.com</a> ï¼Œå›è½¦æ‰“å¼€ã€‚å‘ä¸€å°é‚®ä»¶åˆ°å®ƒæŒ‡å®šçš„é‚®ç®±é‡Œã€‚ç„¶åè¿‡ä¸€åˆ†é’Ÿå·¦å³æŸ¥çœ‹ä¸‹ç»“æœï¼Œé‡ç‚¹æ£€æŸ¥ SPF è®°å½•ã€DMARC è®°å½•å’Œ DKIM ç­¾åæ˜¯ä¸æ˜¯æœ‰æ•ˆçš„ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://zhuanlan.zhihu.com/p/28816035">åœ¨ CentOS 7 ä¸Šæ­å»ºå±äºè‡ªå·±çš„ â€œå®Œç¾â€ é‚®ä»¶ç³»ç»Ÿ</a></p>]]></content>
    
    
    <categories>
      
      <category>Roundcube WebMail</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Roundcube WebMail</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå»ºé‚®ä»¶æœåŠ¡å™¨-å¼€æºé›†æˆæ–¹æ¡ˆiRedMail</title>
    <link href="/2019/03/22/iRedMail/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/"/>
    <url>/2019/03/22/iRedMail/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/</url>
    
    <content type="html"><![CDATA[<p>è‡ªå»ºé‚®ä»¶æœåŠ¡å™¨-å¼€æºé›†æˆæ–¹æ¡ˆiRedMail</p><span id="more"></span><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>ç³»ç»Ÿ CentOS 7</p><p>åŸŸå example.com</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><ol><li><p>è®¾ç½® hostname</p><p>RHEL&#x2F;CentOS 6ï¼Œ<code>/etc/sysconfig/network</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">HOSTNAME=mail<br></code></pre></td></tr></table></figure><p>CentOS 7</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname mail<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚å®Œæ•´åŸŸåæ˜¯ mail.example.comï¼Œåº”è¯¥è®¾ç½® mail</p><p>éªŒè¯ä¸»æœºå</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostname -f<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½® host</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>   mail.example.com mail localhost localhost.localdomain<br></code></pre></td></tr></table></figure><p>FQDN ä¸»æœºååˆ—åœ¨ç¬¬ä¸€ä¸ªï¼ŒçŸ­ä¸»æœºååˆ—åœ¨ç¬¬äºŒä¸ª</p></li><li><p>è®¾ç½® SELinux</p><p>æŸ¥çœ‹ç°çŠ¶æ€</p><p>iRedMail ä¸æ”¯æŒ SELinuxï¼Œæ‰€ä»¥éœ€è¦åœ¨ &#x2F;etc&#x2F;selinux&#x2F;config æ–‡ä»¶é‡Œç¦ç”¨å®ƒ</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">SELINUX</span><span class="hljs-operator">=</span>disabled<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸å¸Œæœ›ç¦ç”¨ SELinuxï¼Œå¯ä»¥è®¾ç½®ä¸ºè®©å®ƒæ‰“å°è­¦å‘Šä¿¡æ¯ä½†ä¸å¼ºåˆ¶é™åˆ¶</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">SELINUX</span><span class="hljs-operator">=</span>permissive<br></code></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ æœ€æ–°ç‰ˆ iRedMail å®‰è£…åŒ…</p></li><li><p>è§£å‹ iRedMail</p><p>å®‰è£…è§£å‹å·¥å…·</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install  bzip2<br></code></pre></td></tr></table></figure><p>è§£å‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /program<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar xjf iRedMail-x.y.z.tar.bz2<br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œå®‰è£…ç¨‹åº</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /root/iRedMail-x.y.z/<br>bash iRedMail.sh<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…è¿‡ç¨‹</p><p>ä»¥ä¸‹æ˜¯å®˜æ–¹å®‰è£…è¿‡ç¨‹</p><ul><li>æ¬¢è¿å’Œæ„Ÿè°¢ä½¿ç”¨</li></ul><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/welcome.png" alt="welcome.png"></p><ul><li>æŒ‡å®šç”¨äºå­˜å‚¨ç”¨æˆ·é‚®ç®±çš„è·¯å¾„ã€‚é»˜è®¤æ˜¯ <code>/var/vmail/</code>ã€‚</li></ul><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/mail_storage.png" alt="mail_storage.png"></p><ul><li>é€‰æ‹©ç”¨äºå­˜å‚¨é‚®ä»¶è´¦å·çš„æ•°æ®åº“ã€‚</li></ul><p>Note</p><p>å„ä¸ªæ•°æ®åº“ä¹‹é—´æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œå»ºè®®ä½¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„æ•°æ®åº“ï¼Œä¾¿äºåæœŸç»´æŠ¤ã€‚</p><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/backends.png" alt="backends.png"></p><ul><li>å¦‚æœé€‰æ‹© OpenLDAP æ•°æ®åº“ç”¨äºå­˜å‚¨é‚®ä»¶è´¦å·ï¼Œå®‰è£…ç¨‹åºä¼šè¦æ±‚ä½ è¾“å…¥ LDAP å‰ç¼€ï¼š</li></ul><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/ldap_suffix.png" alt="ldap_suffix.png"></p><p>MySQL&#x2F;MariaDB&#x2F;PostgreSQL ç”¨æˆ·</p><p>å¦‚æœé€‰æ‹© MySQL&#x2F;MariaDB&#x2F;PostgreSQL ç”¨äºå­˜å‚¨é‚®ä»¶è´¦å·, å®‰è£…ç¨‹åºä¼šä¸ºæ•°æ®åº“çš„ root ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªéšæœºçš„å¼ºå¯†ç ï¼Œå®‰è£…å®Œæˆåå¯ä»¥åœ¨ <code>iRedMail.tips</code> æ–‡ä»¶é‡Œæ‰¾åˆ°ã€‚</p><ul><li>æ·»åŠ ç¬¬ä¸€ä¸ªé‚®ä»¶åŸŸå</li></ul><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/first_domain.png" alt="first_domain.png"></p><p>è¿™é‡Œå¡« example.com</p><ul><li>è®¾ç½®é‚®ä»¶ç®¡ç†å‘˜çš„å¯†ç </li></ul><p>Note</p><p>è¯¥è´¦å·å³æ˜¯é‚®ä»¶ç®¡ç†å‘˜ï¼Œä¹Ÿæ˜¯æ™®é€šçš„é‚®ä»¶è´¦å·ï¼Œå¯ä»¥ç™»å½•ç®¡ç†åå°å’Œ webmailã€‚</p><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/admin_pw.png" alt="admin_pw.png"></p><ul><li>å¯é€‰çš„ç»„ä»¶</li></ul><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/optional_components.png" alt="optional_components.png"></p><p>å›ç­”å®Œä¸Šé¢çš„å‡ ä¸ªé—®é¢˜ä¹‹åï¼Œå®‰è£…ç¨‹åºç»™å‡ºæœ¬æ¬¡å®‰è£…çš„åŸºæœ¬ä¿¡æ¯å¹¶è¦æ±‚ç¡®è®¤æ˜¯å¦å®é™… æ‰§è¡Œå®‰è£…ï¼Œè¯·è¾“å…¥ <code>y</code> æˆ– <code>Y</code> å¹¶æŒ‰å›è½¦é”®ç¡®è®¤ï¼Œæˆ– <code>n</code>, <code>N</code> å¹¶æŒ‰å›è½¦é”®ä¸­æ­¢å®‰è£…ã€‚</p><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/review.png" alt="review.png"></p></li></ol><p>å®‰è£…å®Œæˆåä½ å¿…é¡»çŸ¥é“çš„å‡ ä¸ªé‡è¦äº‹é¡¹</p><ul><li>é‚®ä»¶æœåŠ¡å™¨æœ€è–„å¼±çš„ç¯èŠ‚æ˜¯ç”¨æˆ·çš„å¼±å¯†ç ï¼Œæ‰€ä»¥è¯·ä¸€å®šå¼ºåˆ¶ä½ çš„ç”¨æˆ·ä½¿ç”¨å¼ºåº¦é«˜çš„å¯†ç ã€‚</li><li>é˜…è¯» &#x2F;root&#x2F;iRedMail-x.y.z&#x2F;iRedMail.tips æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ï¼š<ul><li>å„ä¸ª web ç¨‹åºçš„è®¿é—®åœ°å€ï¼ˆURLï¼‰ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚</li><li>å„ä¸ªç»„ä»¶çš„é…ç½®æ–‡ä»¶è·¯å¾„ã€‚é™¤æ­¤ä¹‹å¤–è¿˜åº”è¯¥é˜…è¯»æ–‡æ¡£ï¼šLocations of configuration and log files of major components.</li><li>ä»¥åŠå…¶å®ƒä¸€äº›é‡è¦å’Œæ•æ„Ÿä¿¡æ¯</li></ul></li><li>è®¾ç½® DNS è®°å½•</li><li>å¦‚ä½•é…ç½®é‚®ä»¶å®¢æˆ·ç«¯ç¨‹åº</li><li>å¼ºçƒˆå»ºè®®è·å– SSL è¯ä¹¦ä»¥é¿å…æ¯æ¬¡è®¿é—® web ç¨‹åºæ—¶çƒ¦äººçš„è‡ªç­¾å SSL è¯ä¹¦è­¦å‘Šï¼Œ Letâ€™s Encrypt æä¾›å…è´¹çš„ SSL è¯ä¹¦ã€‚å¯æ ¹æ®è¯¥æ–‡æ¡£ é…ç½®è·å–çš„è¯ä¹¦ï¼šuse a SSL certificate.</li><li>å¦‚æœéœ€è¦æ‰¹é‡æ·»åŠ é‚®ä»¶è´¦å·ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹é’ˆå¯¹ä¸åŒæ•°æ®åº“çš„æ‰¹é‡å»ºè´¦å·çš„æ–‡æ¡£ï¼š OpenLDAPï¼Œ MySQL&#x2F;MariaDB&#x2F;PostgreSQLã€‚</li><li>å¦‚æœè¿™æ˜¯ä¸€å°ç¹å¿™çš„æœåŠ¡å™¨ï¼Œè¿™é‡Œæœ‰ä¸€äº›æå‡æ€§èƒ½çš„å»ºè®®ã€‚</li></ul><p>è®¿é—® webmail å’Œå…¶å®ƒ web ç¨‹åº<br>å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ URL è®¿é—®ç›¸å…³ç¨‹åºã€‚æ³¨æ„ï¼šè¯·å°† &lt;server&gt; æ›¿æ¢ä¸ºå®é™…çš„ æœåŠ¡å™¨åœ°å€ã€‚</p><ul><li>Roundcube webmail: <a href="https://mail.example.com/mail/">https://mail.example.com/mail/</a></li><li>SOGo Groupware: <a href="https://mail.example.com/SOGo">https://mail.example.com/SOGo</a></li><li>Web ç®¡ç†åå°: httpS:&#x2F;&#x2F;mail.example.com&#x2F;iredadmin&#x2F;</li><li>Awstats: httpS:&#x2F;&#x2F;mail.example.com&#x2F;awstats&#x2F;awstats.pl?config&#x3D;web (or <code>?config=smtp</code> for SMTP log)</li></ul><h1 id="DNS-è®¾ç½®"><a href="#DNS-è®¾ç½®" class="headerlink" title="DNS è®¾ç½®"></a>DNS è®¾ç½®</h1><p><img src="/../../static/image/%E8%87%AA%E5%BB%BA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BC%80%E6%BA%90%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88iRedMail/dns_settings.png" alt="dns_settings.png"></p><p>SPF</p><p>SPF è®°å½•æ˜¯ä¸€ç§åŸŸåæœåŠ¡ (DNS) è®°å½•ï¼Œå¯ç¡®å®šå…è®¸å“ªäº›é‚®ä»¶æœåŠ¡å™¨ä»£è¡¨æ‚¨çš„åŸŸæ¥å‘é€ç”µå­é‚®ä»¶</p><p>è¿™é‡Œè¯´å‡ ä¸ªå¸¸ç”¨çš„ï¼š</p><ol><li>aï¼šæ‰€æœ‰è¯¥åŸŸåçš„Aè®°å½•éƒ½ä¸ºé€šè¿‡ï¼Œaä¸æŒ‡å®šçš„æƒ…å†µä¸‹ä¸ºå½“å‰åŸŸå</li><li>ip4ï¼šæŒ‡å®šé€šè¿‡çš„IP</li><li>mxï¼šmxè®°å½•åŸŸåçš„Aè®°å½•IPå¯ä»¥å‘é‚®ä»¶</li><li>allï¼šç»“æŸæ ‡å¿—ï¼Œâ€œ-â€è¡¨ç¤ºåªå…è®¸è®¾ç½®çš„è®°å½•ä¸ºé€šè¿‡ï¼Œâ€œ~â€è¡¨ç¤ºå¤±è´¥ï¼Œé€šå¸¸ç”¨äºæµ‹è¯•ï¼Œâ€œ+â€è¡¨ç¤ºå¿½ç•¥SPF</li></ol><p>DKIM</p><p>centos6</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">amavisd showkeys<br></code></pre></td></tr></table></figure><p>centos7</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">amavisd -c /etc/amavisd/amavisd.conf showkeys<br></code></pre></td></tr></table></figure><p>å¤åˆ¶ç»“æœï¼Œæ·»åŠ åˆ°DNSï¼Œä¸»æœºè®°å½•ä¸º<code>dkim._domainkey</code>ï¼Œ<code>TXT</code>ç±»åˆ«</p><p>DMARC</p><p>DMARCåè®®æ˜¯æœ‰æ•ˆè§£å†³ä¿¡å¤´Fromä¼ªé€ è€Œè¯ç”Ÿçš„ä¸€ç§æ–°çš„é‚®ä»¶æ¥æºéªŒè¯æ‰‹æ®µï¼Œä¸ºé‚®ä»¶å‘ä»¶äººåœ°å€æä¾›å¼ºå¤§ä¿æŠ¤ï¼Œå¹¶åœ¨é‚®ä»¶æ”¶å‘åŒæ–¹ä¹‹é—´å»ºç«‹èµ·ä¸€ä¸ªæ•°æ®åé¦ˆæœºåˆ¶ã€‚</p><ul><li>pï¼šç”¨äºå‘ŠçŸ¥æ”¶ä»¶æ–¹ï¼Œå½“æ£€æµ‹åˆ°æŸé‚®ä»¶å­˜åœ¨ä¼ªé€ æˆ‘ï¼ˆå‘ä»¶äººï¼‰çš„æƒ…å†µï¼Œæ”¶ä»¶æ–¹è¦åšå‡ºä»€ä¹ˆå¤„ç†ï¼Œå¤„ç†æ–¹å¼ä»è½»åˆ°é‡ä¾æ¬¡ä¸ºï¼šnoneä¸ºä¸ä½œä»»ä½•å¤„ç†ï¼›quarantineä¸ºå°†é‚®ä»¶æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ï¼›rejectä¸ºæ‹’ç»è¯¥é‚®ä»¶ã€‚åˆæœŸå»ºè®®è®¾ç½®ä¸ºnoneã€‚</li><li>ruaï¼šç”¨äºåœ¨æ”¶ä»¶æ–¹æ£€æµ‹åï¼Œå°†ä¸€æ®µæ—¶é—´çš„æ±‡æ€»æŠ¥å‘Šï¼Œå‘é€åˆ°å“ªä¸ªé‚®ç®±åœ°å€ã€‚</li><li>rufï¼šç”¨äºå½“æ£€æµ‹åˆ°ä¼ªé€ é‚®ä»¶æ—¶ï¼Œæ”¶ä»¶æ–¹é¡»å°†è¯¥ä¼ªé€ ä¿¡æ¯çš„æŠ¥å‘Šå‘é€åˆ°å“ªä¸ªé‚®ç®±åœ°å€ã€‚</li></ul><p>ä¾‹å¦‚æˆ‘è®¾ç½®çš„æ˜¯v&#x3D;DMARC1;p&#x3D;reject;rua&#x3D;<a href="mailto:&#x78;&#x78;&#64;&#x6c;&#120;&#x78;&#46;&#x63;&#111;&#109;">xx@lxx.com</a>ï¼Œæ„æ€æ˜¯æ‹’ç»ä¼ªé€ é‚®ä»¶ï¼Œå¹¶ä¸”å°†ä¸€æ®µæ—¶é—´çš„æ±‡æ€»æŠ¥å‘Šå‘é€ç»™æˆ‘ã€‚</p><p>æ·»åŠ åˆ°DNS</p><p>æ·»åŠ TXTè®°å½•ï¼Œä¸»æœºåï¼š<code>_dmarc</code>ï¼Œè®°å½•å€¼ï¼š<code>v=DMARC1;p=reject;rua=xx@lxx.com</code></p><p>PTR</p><p>å°† mail.xx.com è®¾ç½®PTR</p><p>æ·»åŠ å¥½äº†ä»¥åå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dig -x  IP<br></code></pre></td></tr></table></figure><p>å¦‚æœçœ‹åˆ°äº†PTRè®°å½•ä¸ºä½ çš„åŸŸåé‚£å°±è¯´æ˜æˆåŠŸäº†ã€‚</p><p>æµ‹è¯•å·¥å…·</p><p><a href="http://www.mail-tester.com/">http://www.mail-tester.com/</a></p><p><strong>iRedmail ä¸»è¦ç»„ä»¶</strong></p><ul><li>Apache</li><li>Nginx </li><li>PHP</li><li>MySQL</li><li>OpenLDAP</li><li>Postfix</li><li>Dovecot</li><li>Amavisd</li><li>ClamAV</li><li>SpamAssassin</li><li>Policyd</li><li>Pysieved</li><li>Roundcube</li><li>Awstats 6.9</li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://docs.iredmail.org/install.iredmail.on.rhel-zh_CN.html">iRedMail doc</a></p><p><a href="lomu.me/post/SPF-DKIM-DMARC-PTR">é‚®ä»¶æœåŠ¡å™¨æ·»åŠ SPFã€DKIMã€DMARCã€PTRæé«˜é€è¾¾ç‡</a></p>]]></content>
    
    
    <categories>
      
      <category>iRedMail</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iRedMail</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®‰è£… GitLab æ•™ç¨‹</title>
    <link href="/2019/02/05/docker/Docker%20%E5%AE%89%E8%A3%85%20Gitlab/"/>
    <url>/2019/02/05/docker/Docker%20%E5%AE%89%E8%A3%85%20Gitlab/</url>
    
    <content type="html"><![CDATA[<p><a href="about.gitlab.com">GitLab</a> æ˜¯ç”±GitLab Inc.å¼€å‘ï¼Œä½¿ç”¨<a href="https://zh.wikipedia.org/wiki/MIT%E8%A8%B1%E5%8F%AF%E8%AD%89">MITè®¸å¯è¯</a>çš„åŸºäº<a href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91">ç½‘ç»œ</a>çš„<a href="https://zh.wikipedia.org/wiki/Git">Git</a><a href="https://zh.wikipedia.org/wiki/%E4%BB%93%E5%BA%93_(%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6)">ä»“åº“</a>ç®¡ç†å·¥å…·ï¼Œä¸”å…·æœ‰<a href="https://zh.wikipedia.org/wiki/Wiki">wiki</a>å’Œ<a href="https://zh.wikipedia.org/wiki/%E4%BA%8B%E5%8A%A1%E8%B7%9F%E8%B8%AA%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">issueè·Ÿè¸ª</a>åŠŸèƒ½ã€‚å¸¸ç”¨äºä¼ä¸šå†…éƒ¨ä»£ç ç®¡ç†ã€‚</p><span id="more"></span><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>æ“ä½œç³»ç»Ÿï¼šCentos7</p><p>SeLinuxï¼šå¼€å¯</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å¯åŠ¨å®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --detach \<br>  --publish 2443:443 --publish 2280:80 --publish 2222:22 \<br>  --name gitlab \<br>  --hostname 10.10.18.155 \<br>  --restart unless-stopped \<br>  --volume /program/gitlab/config:/etc/gitlab:Z \<br>  --volume /program/gitlab/logs:/var/log/gitlab:Z \<br>  --volume /program/gitlab/data:/var/opt/gitlab:Z \<br>  gitlab/gitlab-ce:latest<br></code></pre></td></tr></table></figure><h2 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h2><p>æŸ¥çœ‹ <code>GitLab</code> ç‰ˆæœ¬å·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it gitlab <span class="hljs-built_in">cat</span> /opt/gitlab/embedded/service/gitlab-rails/VERSION<br></code></pre></td></tr></table></figure><p><strong>1. Docker volume  æ–¹å¼</strong></p><p>æ³¨æ„ï¼šè¯¥æ–¹æ³•ç§»åŠ¨æ–‡ä»¶æ—¶ï¼Œä¸€å®šè¦ä¿æŒåŸæ–‡ä»¶æƒé™ï¼ï¼ï¼</p><p>å¤åˆ¶ volume</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> -rfp /program/gitlab /program/gitlab.bak<br></code></pre></td></tr></table></figure><p>å‹ç¼©&#x2F;æ‰“åŒ… volume</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -czvp -f /program/gitlab.tar.gz /program/gitlab.bak<br></code></pre></td></tr></table></figure><p>è§£å‹&#x2F;è§£åŒ… volume</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -xzvp -f /program/gitlab.tar.gz<br></code></pre></td></tr></table></figure><p><strong>2. GitLabå¤‡ä»½æ–¹å¼</strong></p><p>å¤‡ä»½æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> gitlab gitlab-rake gitlab:backup:create<br></code></pre></td></tr></table></figure><p>æ‹·è´åˆ°ç‰©ç†æœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">cp</span> gitlab:/xxx /program/<br></code></pre></td></tr></table></figure><p>è¿˜åŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it &lt;name of container&gt; gitlab-rake gitlab:backup:restore<br></code></pre></td></tr></table></figure><h2 id="ä¿®å¤å…‹éš†åœ°å€"><a href="#ä¿®å¤å…‹éš†åœ°å€" class="headerlink" title="ä¿®å¤å…‹éš†åœ°å€"></a>ä¿®å¤å…‹éš†åœ°å€</h2><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">vim</span> gitlab.rb<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹æ­£ç¡®çš„IP&#x2F;åœ°å€</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">external_url</span> <span class="hljs-string">&#x27;http://git.taigu.org&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><ol><li><p>æƒé™é—®é¢˜</p><p>æ‰§è¡Œä¿®å¤æŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo docker <span class="hljs-built_in">exec</span> -it gitlab update-permissions<br></code></pre></td></tr></table></figure></li><li><p><code>gitaly.pid</code>é”™è¯¯</p><p>åˆ é™¤ <code>gitlab/data/gitaly/gitaly.pid</code></p></li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.gitlab.com/omnibus/docker/">docker install gitlab</a></p><p><a href="https://docs.gitlab.com/ce/raketasks/backup_restore.html#restore-for-omnibus-installations">docker gitlab backup</a></p>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GitLab</tag>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®‰è£…æ•™ç¨‹</title>
    <link href="/2019/01/30/docker/docker%20%E5%AE%89%E8%A3%85/"/>
    <url>/2019/01/30/docker/docker%20%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<p><a href="www.docker.com">Docker</a> æ˜¯å¸¸ç”¨çš„è½¯ä»¶å®¹å™¨å¹³å°ï¼Œå¯å¿«é€Ÿåˆ›å»ºã€éƒ¨ç½²æœåŠ¡ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ã€‚</p><span id="more"></span><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>æ“ä½œç³»ç»Ÿï¼šCentos7</p><p>SeLinuxï¼šå¼€å¯</p><h2 id="å­˜å‚¨åº“å®‰è£…"><a href="#å­˜å‚¨åº“å®‰è£…" class="headerlink" title="å­˜å‚¨åº“å®‰è£…"></a>å­˜å‚¨åº“å®‰è£…</h2><p><strong>å¸è½½æ—§</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum remove \<br>  docker \<br>  docker-client \<br>  docker-client-latest \<br>  docker-common \<br>  docker-latest \<br>  docker-latest-logrotate \<br>  docker-logrotate \<br>  docker-engine<br></code></pre></td></tr></table></figure><p><strong>å®‰è£…éœ€è¦çš„åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install -y \<br>  yum-utils \<br>  device-mapper-persistent-data \<br>  lvm2<br></code></pre></td></tr></table></figure><p><strong>è®¾ç½®ç¨³å®šå­˜å‚¨åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum-config-manager \<br>  --add-repo \<br>  https://download.docker.com/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><p><strong>å®‰è£…æ–° Docker</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install docker-ce docker-ce-cli containerd.io<br></code></pre></td></tr></table></figure><p><strong>å›½å†…åŠ é€Ÿ</strong></p><p>é˜¿é‡Œäº‘æœç´¢ <code>å®¹å™¨é•œåƒåŠ é€Ÿ</code>ï¼Œè¿›å…¥ï¼Œæ‰¾åˆ° <code>é•œåƒåŠ é€Ÿå™¨</code>ï¼Œé€‰æ‹©ç›¸åº”çš„æ“ä½œç³»ç»Ÿï¼Œæ‰§è¡Œç›¸å…³æŒ‡ä»¤</p><p>ä¾‹å¦‚ï¼šCentos7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/docker<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim <span class="hljs-built_in">tee</span> /etc/docker/daemon.json<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;registry-mirrors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;https://xxxxxx.mirror.aliyuncs.com&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå·²ç»å¯åŠ¨ dockerï¼Œéœ€è¦é‡å¯æœåŠ¡ç”Ÿæ•ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><p><strong>é€‰æ‹©å¤§å®¹é‡åˆ†åŒº</strong></p><p>æŸ¥çœ‹åˆ†åŒºç©ºé—´ä½¿ç”¨æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">df</span> -h<br></code></pre></td></tr></table></figure><p>è®¾ç½® docker æ ¹ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/docker/daemon.json<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;graph&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/docker&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå·²ç»å¯åŠ¨ dockerï¼Œéœ€è¦é‡å¯æœåŠ¡ç”Ÿæ•ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><p><strong>å¯åŠ¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl start docker<br></code></pre></td></tr></table></figure><p><strong>è‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><p><strong>å…³é—­è‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl <span class="hljs-built_in">disable</span> docker<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/">docker</a></p>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo å¿«é€Ÿå¼€å§‹</title>
    <link href="/2019/01/29/hexo-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/"/>
    <url>/2019/01/29/hexo-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/</url>
    
    <content type="html"><![CDATA[<p><a href="hexo.io">hexo</a> æ˜¯å¸¸ç”¨çš„é™æ€ç½‘é¡µæ„å»ºå·¥å…·ï¼Œæ”¯æŒmarkdownï¼Œæ‹¥æœ‰ä¸°å¯Œçš„æ’ä»¶ã€‚å¸¸ç”¨äºæ„å»ºä¸ªäººåšå®¢ã€‚</p><span id="more"></span><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p><code>OS</code> window 10 1809</p><p><code>node</code> 10.13.0</p><p><code>npm</code> 6.6.0</p><p><code>PowerShell</code> 5.1.17763.134</p><p><code>hexo</code> 3.8.0</p><p><code>hexo-cli</code> 1.1.0</p><h2 id="å¼€å§‹æ„å»º"><a href="#å¼€å§‹æ„å»º" class="headerlink" title="å¼€å§‹æ„å»º"></a>å¼€å§‹æ„å»º</h2><p><code>shift+å³é”®</code> å¯åŠ¨ <code>PowerShell</code>ï¼Œåˆ›å»º hexo ç›®å½•ï¼ˆæ„å»ºå™¨é¡¹ç›®ï¼‰</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir hexo<br></code></pre></td></tr></table></figure><p>è¿›å…¥ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> hexo<br></code></pre></td></tr></table></figure><p>å…¨å±€å®‰è£… <code>hexo-cli</code>ï¼Œå¦‚æœè¿˜æ²¡æœ‰å®‰è£…<a href="nodejs.org">nodejs</a>å’Œ<a href="git-scm.com">git</a>ï¼Œè¯·å‚è€ƒ<a href="hexo.io/zh-cn/docs">hexoæ–‡æ¡£</a>ï¼Œæ­¤å¤„ä¸å†é‡å¤è®°å½•</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">npm install -g hexo-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ– hexo</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">hexo <span class="hljs-keyword">init</span><br></code></pre></td></tr></table></figure><p>å®‰è£…ä¾èµ–åŒ…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆé™æ€èµ„æº</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">hexo <span class="hljs-keyword">generate</span> æˆ– hexo g<br></code></pre></td></tr></table></figure><p>æœ¬åœ°å¯åŠ¨severæµ‹è¯•</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">hexo <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—® <a href="localhost:4000">localhost:4000</a></p><p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç®€å•çš„ä¸ªäººåšå®¢ç³»ç»Ÿå·²ç»å®Œæˆäº†ï¼</p><p>å‚è€ƒ <a href="https://hexo.io/zh-cn/docs/">hexo docs</a></p><h2 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h2><p>è¿™é‡Œä»¥ <a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/README.md">Next v6.0.x </a>ä¸ºä¾‹å­</p><p>ä¸‹è½½ä¸»é¢˜</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> hexo<br>git clone https://github.<span class="hljs-keyword">com</span>/theme-<span class="hljs-keyword">next</span>/hexo-theme-<span class="hljs-keyword">next</span> themes/<span class="hljs-keyword">next</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸»é¢˜ï¼Œä¿®æ”¹<code>./_config.yml</code>ä¸­çš„<code>theme</code>ä¸º<code>next</code></p><p>æ³¨æ„åŒºåˆ†<code>./themes/next/_config.yml</code></p><p>ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼Œä¸‹é¢æ›´æ¢ç§°å‘¼</p><p><code>./_config.yml</code>ç§°ä¸ºç³»ç»Ÿé…ç½®</p><p><code>./themes/next/_config.yml</code>ç§°ä¸ºä¸»é¢˜é…ç½®</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">theme:</span> <span class="hljs-keyword">next</span><br><br></code></pre></td></tr></table></figure><p>ä¿å­˜</p><p>æ¸…ç†ç¼“å­˜</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo clean</span><br><br></code></pre></td></tr></table></figure><p>é‡æ–°æ„å»º</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo g</span><br><br></code></pre></td></tr></table></figure><p>æœ¬åœ°å¯åŠ¨</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">hexo <span class="hljs-keyword">server</span><br><br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—® <a href="localhost:4000">localhost:4000</a></p><p>æˆåŠŸæ›´æ¢ä¸»é¢˜ï¼</p><h2 id="Hexo-ä¼˜åŒ–"><a href="#Hexo-ä¼˜åŒ–" class="headerlink" title="Hexo ä¼˜åŒ–"></a>Hexo ä¼˜åŒ–</h2><ol><li><p>åŸºæœ¬è®¾ç½®<a href="hexo.io/zh-cn/docs/configuration.html">å‚è€ƒ</a></p><p>title: xxxâ€™s blog<br>author: xxx<br>language: zh-CN<br>timezone: Asia&#x2F;Shanghai</p></li></ol><h2 id="ä¸»é¢˜ä¼˜åŒ–"><a href="#ä¸»é¢˜ä¼˜åŒ–" class="headerlink" title="ä¸»é¢˜ä¼˜åŒ–"></a>ä¸»é¢˜ä¼˜åŒ–</h2><ol><li><p>æ·»åŠ è¯„è®ºç³»ç»Ÿ</p><p>æ­¤å¤„ä½¿ç”¨ <a href="valine.js.org">valine</a></p><p>å‚è€ƒ <a href="valine.js.org/quickstart.html">å¿«é€Ÿç”³è¯·</a> ç”³è¯· <code>leancloud</code> è´¦å·ï¼Œå¹¶è·å– <code>APP ID</code> å’Œ <code>APP Key</code></p><p>æ‰“å¼€ä¸»é¢˜é…ç½®<code>./themes/next/_config.yml</code></p><p>å®šä½åˆ° <code>valine</code></p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">enable:</span> <span class="hljs-literal">true</span><br><span class="hljs-symbol">appid:</span> &lt;APP ID&gt;<br><span class="hljs-symbol">appkey:</span> &lt;APP <span class="hljs-keyword">Key</span>&gt;<br><br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®ä¾§è¾¹æ </p><p>åœ¨ä¸»é¢˜é…ç½®ä¸­ï¼Œæ‰¾åˆ°<code>sidebar</code></p><p>ä¾‹å¦‚ä¿®æ”¹æ˜¾ç¤ºæ–¹å¼ <code>display</code></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">#<span class="hljs-built_in">display</span>: post  é»˜è®¤<br>#<span class="hljs-built_in">display</span>: always  æ€»æ˜¯æ˜¾ç¤º<br><span class="hljs-built_in">display</span>: hide  å¼€å§‹éšè—<br>#<span class="hljs-built_in">display</span>: <span class="hljs-built_in">remove</span>  ä¸æ˜¾ç¤º<br><br></code></pre></td></tr></table></figure></li><li><p>å¯¼èˆªèœå•</p><p>åœ¨ä¸»é¢˜é…ç½®ä¸­ï¼Œæ‰¾åˆ°<code>menu</code></p><p>æ³¨é‡Š<code>tags</code>ç­‰ï¼Œè¯»è€…å¯ä»¥è‡ªç”±é€‰æ‹©</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">tags:</span> /tags/ || tags<br><br></code></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•æ‰§è¡ŒæŒ‡ä»¤</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> <span class="hljs-string">&quot;tags&quot;</span><br><br></code></pre></td></tr></table></figure><p>å¢åŠ å†…å®¹ï¼Œå…³é—­è¯„è®ºå’ŒæŒ‡å®šé¡µé¢ç±»å‹</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">comments:</span> <span class="hljs-literal">false</span><br><span class="hljs-symbol">type:</span> <span class="hljs-string">&quot;tags&quot;</span><br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼Œä¼šåˆ›å»ºæ–‡ä»¶å¤¹<code>./source/tags/</code>ï¼Œå¹¶åœ¨é‡Œé¢åˆå§‹åŒ–<code>tags</code>é¡µé¢çš„mdæ–‡ä»¶<code>index.md</code></p><p>é‡æ–°æ„å»ºåï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢å¤šäº†ä¸€ä¸ªå¯¼èˆªæ <code>tags</code></p> <figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs axapta">hexo clean<br>hexo g<br>hexo <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure></li><li><p>æ–‡ç« é˜…è¯»æ•°leancloud_visitors</p><p>åœ¨ä¸»é¢˜é…ç½®ä¸­ï¼Œæ‰¾åˆ°<code>leancloud_visitors</code></p><p>å¡«å†™ AppID å’Œ AppKey</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">appid:</span> &lt;APP ID&gt;<br><span class="hljs-symbol">appkey:</span> &lt;APP <span class="hljs-keyword">Key</span>&gt;<br><br></code></pre></td></tr></table></figure></li><li><p>ç¤¾äº¤</p><p>åœ¨ä¸»é¢˜é…ç½®ä¸­ï¼Œæ‰¾åˆ°<code>social</code></p><p>å¯ç”¨ <code>social</code></p><p>æ·»åŠ ç›¸åº”çš„ç¤¾äº¤å·¥å…·ä»¥åŠè´¦å·</p></li><li><p>Nextä¸»é¢˜å¼€å¯å­—æ•°ç»Ÿè®¡åŠé˜…è¯»æ—¶é•¿</p><p>å®‰è£… hexo-symbols-count-time</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">npm i hexo-symbols-<span class="hljs-built_in">count</span>-<span class="hljs-built_in">time</span> -D<br><br></code></pre></td></tr></table></figure><p>hexo é…ç½®æ–‡ä»¶å¢åŠ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">symbols_count_time:</span><br>  <span class="hljs-attr">symbols:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># æ–‡ç« å­—æ•°</span><br>  <span class="hljs-attr">time:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># é˜…è¯»æ—¶é•¿</span><br>  <span class="hljs-attr">total_symbols:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># æ‰€æœ‰æ–‡ç« æ€»å­—æ•°</span><br>  <span class="hljs-attr">total_time:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># æ‰€æœ‰æ–‡ç« é˜…è¯»ä¸­æ—¶é•¿</span><br><br></code></pre></td></tr></table></figure><p>Next ä¸»é¢˜é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">symbols_count_time:</span><br>  <span class="hljs-attr">separated_meta:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">item_text_post:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">item_text_total:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">awl:</span> <span class="hljs-number">4</span><br>  <span class="hljs-attr">wpm:</span> <span class="hljs-number">275</span><br><br></code></pre></td></tr></table></figure></li><li><p>æ°¸ä¹…è¿æ¥</p><p>å®‰è£…uuid</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">npm install hexo-<span class="hljs-built_in">uuid</span> <span class="hljs-comment">--save</span><br><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹hexoé…ç½®æ–‡ä»¶</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-symbol">permalink:</span> <span class="hljs-symbol">:year</span><span class="hljs-symbol">:month</span><span class="hljs-symbol">:day</span><span class="hljs-symbol">:uuid/</span><br><br></code></pre></td></tr></table></figure></li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="zhuanlan.zhihu.com/p/33616481">hexo+githubåšå®¢æ­å»ºä¹‹è·¯</a></p><p><a href="hexo.io">hexo.io</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Making a round picture with PowerPoint 2016</title>
    <link href="/2018/07/26/Making-a-round-picture-with-PowerPoint-2016/"/>
    <url>/2018/07/26/Making-a-round-picture-with-PowerPoint-2016/</url>
    
    <content type="html"><![CDATA[<p>Sometime we need to make a round image, but there are no tools like <a href="https://www.photoshop.com/">Photoshop</a> and <a href="https://www.gimp.org/">GIMP</a> on our computer. However, we donâ€™t want to install these tools. Is there an easy way? Yes, we can do it with <a href="https://products.office.com/en-us/powerpoint">PowerPoint 2016</a>. </p><span id="more"></span><h3 id="Open-your-PowerPoint-2016-and-insert-an-image"><a href="#Open-your-PowerPoint-2016-and-insert-an-image" class="headerlink" title="Open your PowerPoint 2016 and insert an image"></a>Open your PowerPoint 2016 and insert an image</h3><p>Making-a-round-picture-with-PowerPoint-2016<img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0001.png" alt="0001.png"></p><h3 id="Insert-a-circle"><a href="#Insert-a-circle" class="headerlink" title="Insert a circle"></a>Insert a circle</h3><p><img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0002.png" alt="0002.png"></p><h3 id="Adjust-style"><a href="#Adjust-style" class="headerlink" title="Adjust style"></a>Adjust style</h3><p><img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0003.png" alt="0003.png"></p><h3 id="Adjust-the-position-of-the-circle-the-result-is-as-follows"><a href="#Adjust-the-position-of-the-circle-the-result-is-as-follows" class="headerlink" title="Adjust the position of the circle, the result is as follows:"></a>Adjust the position of the circle, the result is as follows:</h3><p><img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0004.png" alt="0003.png"></p><h3 id="Next-merge-the-circle-and-the-image-select-the-circle-and-image-note-be-sure-to-select-the-image-first"><a href="#Next-merge-the-circle-and-the-image-select-the-circle-and-image-note-be-sure-to-select-the-image-first" class="headerlink" title="Next merge the circle and the image, select the circle and image (note: be sure to select the image first)"></a>Next merge the circle and the image, select the circle and image (note: be sure to select the image first)</h3><p><img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0005.png" alt="0003.png"></p><h3 id="Then-merge"><a href="#Then-merge" class="headerlink" title="Then merge"></a>Then merge</h3><p><img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0006.png" alt="0003.png"></p><h3 id="Ok-now-we-have-the-picture-we-want-We-can-save-it-to-use-it"><a href="#Ok-now-we-have-the-picture-we-want-We-can-save-it-to-use-it" class="headerlink" title="Ok, now we have the picture we want. We can save it to use it"></a>Ok, now we have the picture we want. We can save it to use it</h3><p><img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0007.png" alt="0003.png"><br><img src="/../static/image/Making-a-round-picture-with-PowerPoint-2016/0008.png" alt="0003.png"><br>In this way, we use <a href="https://products.office.com/en-us/powerpoint">PowerPoint 2016</a> to make a round image.</p>]]></content>
    
    
    
    <tags>
      
      <tag>PowerPoint2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
